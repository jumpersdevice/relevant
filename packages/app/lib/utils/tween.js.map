{"version":3,"sources":["../../src/utils/tween.js"],"names":["lerp","n","a","b","tweens","lastT","id","animationFrame","speed","add","tween","obj","easing","linear","keys","from","Object","to","forEach","prop","parseFloat","delay","start","done","after","then","fn","push","tick","skip","dt","update","t","requestAnimationFrame","length","Math","min","duration","ddt","val","round","units","finished","twn","shift","loop","filter","remove","cancelAnimationFrame","stop","reset","circ_out","sqrt","circ_in","circ_in_out","quad_in","quad_out","quad_in_out","cubic_bezier","mX1","mY1","mX2","mY2","A","aA1","aA2","B","C","CalcBezier","aT","aX"],"mappings":"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","sourcesContent":["/*\n  tween.add({\n    obj: el.style,\n    units: \"px\",\n    from: { left: 0 },\n    to: { left: 100 },\n    duration: 1000,\n    easing: easing.circ_out,\n    update: function(obj){\n      console.log(obj.left)\n    }\n    finished: function(){\n      console.log(\"done\")\n    }\n  })\n*/\n\nconst lerp = (n, a, b) => (b - a) * n + a;\n\nlet tweens = [];\n\nlet lastT = 0;\nlet id = 0;\nlet animationFrame = 0;\n\nconst speed = 1;\n\nexport const add = tween => {\n  tween.id = id++;\n  tween.obj = tween.obj || {};\n  if (tween.easing) {\n    if (typeof tween.easing === 'string') {\n      tween.easing = easing[tween.easing];\n    }\n  } else {\n    tween.easing = easing.linear;\n  }\n  if (!('from' in tween) && !('to' in tween)) {\n    tween.keys = [];\n  } else if (!('from' in tween)) {\n    tween.from = {};\n    tween.keys = Object.keys(tween.to);\n    tween.keys.forEach(prop => {\n      tween.from[prop] = parseFloat(tween.obj[prop]);\n    });\n  } else {\n    tween.keys = Object.keys(tween.from);\n  }\n  tween.delay = tween.delay || 0;\n  tween.start = lastT + tween.delay;\n  tween.done = false;\n  tween.after = tween.after || [];\n  tween.then = fn => {\n    tween.after.push(fn);\n    return tween;\n  };\n  tween.tick = 0;\n  tween.skip = tween.skip || 1;\n  tween.dt = 0;\n  tweens.push(tween);\n  return tween;\n};\n\nexport const update = t => {\n  let done = false;\n  animationFrame = requestAnimationFrame(update);\n  lastT = t * speed;\n  if (tweens.length === 0) return;\n  tweens.forEach(tween => {\n    const dt = Math.min(1.0, (t - tween.start) / tween.duration);\n    tween.tick++;\n    if (dt < 0 || (dt < 1 && tween.tick % tween.skip !== 0)) return;\n    const ddt = tween.easing(dt);\n    tween.dt = ddt;\n    tween.keys.forEach(prop => {\n      let val = lerp(ddt, tween.from[prop], tween.to[prop]);\n      if (tween.round) val = Math.round(val);\n      if (tween.units) val = Math.round(val) + tween.units;\n      tween.obj[prop] = val;\n    });\n    if (tween.update) {\n      tween.update(tween.obj, dt);\n    }\n    if (dt === 1) {\n      if (tween.finished) {\n        tween.finished(tween);\n      }\n      if (tween.after.length) {\n        const twn = tween.after.shift();\n        twn.obj = twn.obj || tween.obj;\n        twn.after = tween.after;\n        add(twn);\n      }\n      if (tween.loop) {\n        tween.start = t + tween.delay;\n      } else {\n        done = true;\n        tween.done = true;\n      }\n    }\n  });\n  if (done) {\n    tweens = tweens.filter(tween => !tween.done);\n  }\n};\n\nexport const remove = tween => {\n  if (tween) tweens = tweens.filter(t => t.id !== tween.id);\n};\n\nexport const start = () => {\n  if (animationFrame) cancelAnimationFrame(animationFrame);\n  animationFrame = requestAnimationFrame(update);\n};\n\nexport const stop = () => {\n  cancelAnimationFrame(animationFrame);\n};\n\nexport const reset = () => {\n  stop();\n  tweens = [];\n};\n\nexport const easing = {\n  linear: t => t,\n  circ_out: t => Math.sqrt(1 - (t -= 1) * t),\n  circ_in: t => -(Math.sqrt(1 - t * t) - 1),\n  circ_in_out: t => {\n    t *= 2;\n    return t < 1\n      ? -0.5 * (Math.sqrt(1 - t * t) - 1)\n      : 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1);\n  },\n  quad_in: n => n ** 2,\n  quad_out: n => n * (n - 2) * -1,\n  quad_in_out: n => {\n    n *= 2;\n    if (n < 1) {\n      return n ** 2 / 2;\n    }\n    return (-1 * (--n * (n - 2) - 1)) / 2;\n  },\n  cubic_bezier: (mX1, mY1, mX2, mY2) => {\n    function A(aA1, aA2) {\n      return 1.0 - 3.0 * aA2 + 3.0 * aA1;\n    }\n    function B(aA1, aA2) {\n      return 3.0 * aA2 - 6.0 * aA1;\n    }\n    function C(aA1) {\n      return 3.0 * aA1;\n    }\n\n    // Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.\n    function CalcBezier(aT, aA1, aA2) {\n      return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT;\n    }\n\n    // Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.\n    // function GetSlope(aT, aA1, aA2) {\n    //   return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1);\n    // }\n\n    // function GetTForX(aX) {\n    //   // Newton raphson iteration\n    //   let aGuessT = aX\n    //   for (let i = 0; i < 10; ++i) {\n    //     const currentSlope = GetSlope(aGuessT, mX1, mX2)\n    //     if (currentSlope == 0.0) return aGuessT\n    //     const currentX = CalcBezier(aGuessT, mX1, mX2) - aX\n    //     aGuessT -= currentX / currentSlope\n    //   }\n    //   return aGuessT\n    // }\n\n    return aX => {\n      if (mX1 === mY1 && mX2 === mY2) return aX; // linear\n      return CalcBezier(aX, mY1, mY2);\n    };\n  }\n};\n"],"file":"tween.js"}