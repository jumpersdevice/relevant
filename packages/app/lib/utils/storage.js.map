{"version":3,"sources":["../../src/utils/storage.js"],"names":["userDefaults","cookie","localStorage","process","env","WEB","require","RNSKBucket","Cookies","BROWSER","NODE_ENV","default","window","APP_GROUP_ID","token","local","get","key","Promise","resolve","reject","then","val","catch","err","path","remove","set","String","getToken","newToken","setToken","removeToken","console","log","isTimecodeExpired","date","days","now","Date","getTime","diff","Math","abs","Number","ONE_DAY","isDismissed","dismissed"],"mappings":"weAAA,GAAIA,CAAAA,YAAJ,CACA,GAAIC,CAAAA,MAAJ,CACA,GAAIC,CAAAA,YAAJ,CAEA,GAAIC,OAAO,CAACC,GAAR,CAAYC,GAAZ,GAAoB,MAAxB,CAAgC,CAC9BL,YAAY,CAAGM,OAAO,CAAC,0BAAD,CAAP,CAAoCC,UAAnD,CACD,CAFD,IAEO,CACL,GAAMC,CAAAA,OAAO,CACXL,OAAO,CAACC,GAAR,CAAYK,OAAZ,EAAuBN,OAAO,CAACC,GAAR,CAAYM,QAAZ,GAAyB,MAAhD,CACIJ,OAAO,CAAC,kBAAD,CAAP,CAA4BK,OADhC,CAEIL,OAAO,CAAC,kBAAD,CAHb,CAIAL,MAAM,CAAG,GAAIO,CAAAA,OAAJ,EAAT,CACA,GAAIL,OAAO,CAACC,GAAR,CAAYK,OAAhB,CAAyBP,YAAY,CAAGU,MAAM,CAACV,YAAtB,CAC1B,CAED,GAAMW,CAAAA,YAAY,CAAG,0BAArB,CAEA,GAAIC,CAAAA,KAAJ,CAEO,GAAMC,CAAAA,KAAK,CAAGb,YAAd,C,oBAEA,QAASc,CAAAA,GAAT,CAAaC,GAAb,CAAkB,CACvB,MAAO,IAAIC,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CACtC,GAAIpB,YAAJ,CAAkB,CAChB,MAAOA,CAAAA,YAAY,CAChBgB,GADI,CACAC,GADA,CACKJ,YADL,EAEJQ,IAFI,CAEC,SAAAC,GAAG,CAAI,CACX,GAAIA,GAAJ,CAAS,CACP,MAAOH,CAAAA,OAAO,CAACG,GAAD,CAAd,CACD,CACD,MAAOH,CAAAA,OAAO,CAAC,IAAD,CAAd,CACD,CAPI,EAQJI,KARI,CAQE,SAAAC,GAAG,QAAIJ,CAAAA,MAAM,CAACI,GAAD,CAAV,EARL,CAAP,CASD,CAED,GAAMF,CAAAA,GAAG,CAAGrB,MAAM,CAACe,GAAP,CAAWC,GAAX,CAAgB,CAAEQ,IAAI,CAAE,GAAR,CAAhB,CAAZ,CACA,GAAIH,GAAJ,CAAS,CACP,MAAOH,CAAAA,OAAO,CAACG,GAAD,CAAd,CACD,CACD,MAAOH,CAAAA,OAAO,CAAC,IAAD,CAAd,CACD,CAlBM,CAAP,CAmBD,CAEM,QAASO,CAAAA,MAAT,CAAgBT,GAAhB,CAAqB,CAC1B,GAAIjB,YAAJ,CAAkB,CAChB,MAAO,IAAIkB,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CAC5BnB,YAAY,CAAC0B,MAAb,CAAoBT,GAApB,CAAyBJ,YAAzB,EACAM,OAAO,GACR,CAHM,CAAP,CAID,CACD,MAAO,IAAID,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CAC5BlB,MAAM,CAACyB,MAAP,CAAcT,GAAd,CAAmB,CAAEQ,IAAI,CAAE,GAAR,CAAnB,EACAN,OAAO,GACR,CAHM,CAAP,CAID,CAEM,QAASQ,CAAAA,GAAT,CAAaV,GAAb,CAAkBK,GAAlB,CAAuB,CAC5B,GAAItB,YAAJ,CAAkB,CAChB,MAAO,IAAIkB,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CAC5BnB,YAAY,CAAC2B,GAAb,CAAiBV,GAAjB,CAAsBW,MAAM,CAACN,GAAD,CAA5B,CAAmCT,YAAnC,EACAM,OAAO,GACR,CAHM,CAAP,CAID,CACD,MAAO,IAAID,CAAAA,OAAJ,CAAY,SAAAC,OAAO,CAAI,CAC5BlB,MAAM,CAAC0B,GAAP,CAAWV,GAAX,CAAgBK,GAAhB,CAAqB,CAAEG,IAAI,CAAE,GAAR,CAArB,EACAN,OAAO,GACR,CAHM,CAAP,CAID,CAEM,QAASU,CAAAA,QAAT,EAAoB,CACzB,MAAO,IAAIX,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CACtC,GAAIN,KAAJ,CAAW,MAAOK,CAAAA,OAAO,CAACL,KAAD,CAAd,CAEX,GAAId,YAAJ,CAAkB,CAChB,MAAOA,CAAAA,YAAY,CAChBgB,GADI,CACA,OADA,CACSH,YADT,EAEJQ,IAFI,CAEC,SAAAS,QAAQ,CAAI,CAChB,GAAIA,QAAJ,CAAc,CACZhB,KAAK,CAAGgB,QAAR,CACA,MAAOX,CAAAA,OAAO,CAACL,KAAD,CAAd,CACD,CACD,MAAOK,CAAAA,OAAO,CAAC,IAAD,CAAd,CACD,CARI,EASJI,KATI,CASE,SAAAC,GAAG,QAAIJ,CAAAA,MAAM,CAACI,GAAD,CAAV,EATL,CAAP,CAUD,CAED,GAAMM,CAAAA,QAAQ,CAAG7B,MAAM,CAACe,GAAP,CAAW,OAAX,CAAoB,CAAES,IAAI,CAAE,GAAR,CAApB,CAAjB,CACA,GAAIK,QAAJ,CAAc,CACZhB,KAAK,CAAGgB,QAAR,CACA,MAAOX,CAAAA,OAAO,CAACL,KAAD,CAAd,CACD,CACD,MAAOK,CAAAA,OAAO,CAACL,KAAD,CAAd,CAED,CAvBM,CAAP,CAwBD,CAEM,GAAMiB,CAAAA,QAAQ,8EAAG,iBAAMD,QAAN,mHACtBhB,KAAK,CAAGgB,QAAR,CACAH,GAAG,CAAC,OAAD,CAAUG,QAAV,CAAH,CAFsB,sDAAH,kBAARC,CAAAA,QAAQ,4CAAd,C,0BAIA,GAAMC,CAAAA,WAAW,+EAAG,yIACzBlB,KAAK,CAAG,IAAR,CACAmB,OAAO,CAACC,GAAR,CAAY,iBAAZ,EACAR,MAAM,CAAC,OAAD,CAAN,CAHyB,wDAAH,kBAAXM,CAAAA,WAAW,2CAAjB,C,gCAOP,GAAMG,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,IAAD,CAAOC,IAAP,CAAgB,CACxC,GAAMC,CAAAA,GAAG,CAAG,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAAZ,CACA,GAAMC,CAAAA,IAAI,CAAGC,IAAI,CAACC,GAAL,CAASL,GAAG,CAAGM,MAAM,CAACR,IAAD,CAArB,CAAb,CACA,GAAMS,CAAAA,OAAO,CAAG,KAAO,EAAP,CAAY,EAAZ,CAAiB,EAAjC,CACA,MAAOJ,CAAAA,IAAI,CAAGJ,IAAI,CAAGQ,OAArB,CACD,CALD,CAOO,GAAMC,CAAAA,WAAW,+EAAG,kBAAO7B,GAAP,CAAYoB,IAAZ,6KAGLrB,CAAAA,GAAG,CAACC,GAAD,CAHE,QAGvB8B,SAHuB,mIAKhB,KALgB,YAOpBA,SAPoB,4DAQhB,KARgB,cAUrBZ,iBAAiB,CAACS,MAAM,CAACG,SAAD,CAAP,CAAoBV,IAApB,CAVI,2BAWvBX,MAAM,CAACT,GAAD,CAAN,CAXuB,iCAYhB,KAZgB,2CAclB,IAdkB,wEAAH,kBAAX6B,CAAAA,WAAW,kDAAjB,C","sourcesContent":["let userDefaults;\nlet cookie;\nlet localStorage;\n\nif (process.env.WEB !== 'true') {\n  userDefaults = require('react-native-swiss-knife').RNSKBucket;\n} else {\n  const Cookies =\n    process.env.BROWSER && process.env.NODE_ENV !== 'test'\n      ? require('universal-cookie').default\n      : require('universal-cookie');\n  cookie = new Cookies();\n  if (process.env.BROWSER) localStorage = window.localStorage;\n}\n\nconst APP_GROUP_ID = 'group.com.4real.relevant';\n\nlet token;\n\nexport const local = localStorage;\n\nexport function get(key) {\n  return new Promise((resolve, reject) => {\n    if (userDefaults) {\n      return userDefaults\n        .get(key, APP_GROUP_ID)\n        .then(val => {\n          if (val) {\n            return resolve(val);\n          }\n          return resolve(null);\n        })\n        .catch(err => reject(err));\n    }\n    // WEB\n    const val = cookie.get(key, { path: '/' });\n    if (val) {\n      return resolve(val);\n    }\n    return resolve(null);\n  });\n}\n\nexport function remove(key) {\n  if (userDefaults) {\n    return new Promise(resolve => {\n      userDefaults.remove(key, APP_GROUP_ID);\n      resolve();\n    });\n  }\n  return new Promise(resolve => {\n    cookie.remove(key, { path: '/' });\n    resolve();\n  });\n}\n\nexport function set(key, val) {\n  if (userDefaults) {\n    return new Promise(resolve => {\n      userDefaults.set(key, String(val), APP_GROUP_ID);\n      resolve();\n    });\n  }\n  return new Promise(resolve => {\n    cookie.set(key, val, { path: '/' });\n    resolve();\n  });\n}\n\nexport function getToken() {\n  return new Promise((resolve, reject) => {\n    if (token) return resolve(token);\n\n    if (userDefaults) {\n      return userDefaults\n        .get('token', APP_GROUP_ID)\n        .then(newToken => {\n          if (newToken) {\n            token = newToken;\n            return resolve(token);\n          }\n          return resolve(null);\n        })\n        .catch(err => reject(err));\n    }\n    // WEB\n    const newToken = cookie.get('token', { path: '/' });\n    if (newToken) {\n      token = newToken;\n      return resolve(token);\n    }\n    return resolve(token);\n    // reject(new Error('not logged in'));\n  });\n}\n\nexport const setToken = async newToken => {\n  token = newToken;\n  set('token', newToken);\n};\nexport const removeToken = async () => {\n  token = null;\n  console.log('REMOVING TOKEN!'); // eslint-disable-line\n  remove('token');\n};\n\n// Expects unix timecode\nconst isTimecodeExpired = (date, days) => {\n  const now = new Date().getTime();\n  const diff = Math.abs(now - Number(date));\n  const ONE_DAY = 1000 * 60 * 60 * 24;\n  return diff > days * ONE_DAY;\n};\n\nexport const isDismissed = async (key, days) => {\n  let dismissed;\n  try {\n    dismissed = await get(key);\n  } catch (err) {\n    return false;\n  }\n  if (!dismissed) {\n    return false;\n  }\n  if (isTimecodeExpired(Number(dismissed), days)) {\n    remove(key);\n    return false;\n  }\n  return true;\n};\n"],"file":"storage.js"}