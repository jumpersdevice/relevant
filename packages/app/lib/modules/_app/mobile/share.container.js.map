{"version":3,"sources":["../../../../src/modules/_app/mobile/share.container.js"],"names":["fullWidth","Dimensions","get","width","fullHeight","height","Modal","require","default","style","ShareStack","createPostUrl","screen","UrlComponent","params","title","left","next","share","createPostTags","Categories","shareAuth","Auth","initialRouteName","headerLayoutPreset","cardOverlayEnabled","cardShadowEnabled","defaultNavigationOptions","props","gesturesEnabled","gestureResponseDistance","horizontal","headerStyle","elevation","shadowOpacity","borderBottomColor","darkGrey","borderBottomWidth","StyleSheet","hairlineWidth","headerTitle","headerRight","headerLeft","TransitionPresets","SlideFromRightIOS","ShareAppContainer","ShareContainer","context","token","state","isOpen","type","value","data","closeModal","bind","AppState","addEventListener","handleAppStateChange","community","actions","setCommunity","storage","getToken","setState","replace","getUser","resp","auth","user","getCommunities","ShareExtension","url","words","text","getWords","find","word","post","URL_REGEX","test","setCreatePostState","postUrl","postBody","selection","createPreview","currentAppState","then","tk","close","RNExitApp","exitApp","backgroundColor","flex","onClose","alignItems","maxHeight","modalBody","navigatorRef","Component","PropTypes","object","create","borderRadius","flexGrow","marginTop","marginBottom","padding","overflow","paddingBottom","mapStateToProps","store","mapDispatchToProps","dispatch","authActions","postActions","navigationActions","createPostActions","communityActions"],"mappings":"6rCAAA,qDACA,gDAOA,6DACA,4BACA,uCACA,+FACA,iFAEA,8FACA,8FACA,4EACA,4EACA,2FAEA,+EAEA,iDACA,4DAEA,kFACA,gGAEA,gGACA,sHACA,kGACA,uCAEA,qCACA,8C,omDAGA,GAAMA,CAAAA,SAAS,CAAGC,2BAAWC,GAAX,CAAe,QAAf,EAAyBC,KAA3C,CACA,GAAMC,CAAAA,UAAU,CAAGH,2BAAWC,GAAX,CAAe,QAAf,EAAyBG,MAA5C,CAEAJ,2BAAWC,GAAX,CAAiB,iBAAO,CAAEC,KAAK,CAAEH,SAAT,CAAoBK,MAAM,CAAED,UAA5B,CAAP,EAAjB,CACA,GAAME,CAAAA,KAAK,CAAGC,OAAO,CAAC,uBAAD,CAAP,CAAiCC,OAA/C,CAEA,GAAIC,CAAAA,KAAJ,CAEO,GAAMC,CAAAA,UAAU,CAAG,+CACxB,CACEC,aAAa,CAAE,CACbC,MAAM,CAAE,mBAAUC,YAAV,CADK,CAEbC,MAAM,CAAE,CACNC,KAAK,CAAE,mBADD,CAENC,IAAI,CAAE,OAFA,CAGNC,IAAI,CAAE,MAHA,CAINC,KAAK,CAAE,IAJD,CAFK,CADjB,CAUEC,cAAc,CAAE,CACdP,MAAM,CAAE,mBAAUQ,mBAAV,CADM,CAEdN,MAAM,CAAE,CACNC,KAAK,CAAE,eADD,CAENG,KAAK,CAAE,IAFD,CAFM,CAVlB,CAiBEG,SAAS,CAAE,CACTT,MAAM,CAAE,mBAAUU,cAAV,CADC,CAETR,MAAM,CAAE,CACNE,IAAI,CAAE,OADA,CAENE,KAAK,CAAE,IAFD,CAFC,CAjBb,CADwB,CA0BxB,CACEK,gBAAgB,CAAE,eADpB,CAEEC,kBAAkB,CAAE,QAFtB,CAGEC,kBAAkB,CAAE,IAHtB,CAIEC,iBAAiB,CAAE,IAJrB,CAMEC,wBAAwB,CAAE,kCAAAC,KAAK,wBAC7BC,eAAe,CAAE,IADY,CAE7BC,uBAAuB,CAAE,CACvBC,UAAU,CAAE/B,SADW,CAFI,CAK7BgC,WAAW,CAAE,CACXC,SAAS,CAAE,CADA,CAEXC,aAAa,CAAE,CAFJ,CAGXC,iBAAiB,CAAEC,gBAHR,CAIXC,iBAAiB,CAAEC,2BAAWC,aAJnB,CAKXlC,MAAM,CAAE,EALG,CALgB,CAY7BmC,WAAW,CAAE,6BAAC,oBAAD,0BAAiBZ,KAAjB,mEAZgB,CAa7Ba,WAAW,CAAE,6BAAC,8BAAD,0BAA2Bb,KAA3B,mEAbgB,CAc7Bc,UAAU,CAAE,6BAAC,mBAAD,0BAAgBd,KAAhB,mEAdiB,EAe1Be,wCAAkBC,iBAfQ,GANjC,CA1BwB,CAAnB,C,8BAoDP,GAAMC,CAAAA,iBAAiB,CAAG,wCAAmBnC,UAAnB,CAA1B,C,GAEMoC,CAAAA,c,gHAUJ,wBAAYlB,KAAZ,CAAmBmB,OAAnB,CAA4B,6DAC1B,uBAAMnB,KAAN,CAAamB,OAAb,EAD0B,gFAJpB,CACNC,KAAK,CAAE,IADD,CAIoB,EAE1B,MAAKC,KAAL,CAAa,CACXC,MAAM,CAAE,IADG,CAEXC,IAAI,CAAE,EAFK,CAGXC,KAAK,CAAE,EAHI,CAIXC,IAAI,CAAE,EAJK,CAAb,CAMA,MAAKC,UAAL,CAAkB,MAAKA,UAAL,CAAgBC,IAAhB,4CAAlB,CACAC,yBAASC,gBAAT,CAA0B,QAA1B,CAAoC,MAAKC,oBAAL,CAA0BH,IAA1B,4CAApC,EAT0B,aAU3B,C,sXAISI,S,CAAY,U,CAClB,KAAK/B,KAAL,CAAWgC,OAAX,CAAmBC,YAAnB,CAAgCF,SAAhC,E,sBACoBG,gBAAQC,QAAR,E,QAAdf,K,eAEN,KAAKgB,QAAL,CAAc,CAAEhB,KAAK,CAALA,KAAF,CAAd,EACA,GAAI,CAACA,KAAL,CAAY,KAAKpB,KAAL,CAAWgC,OAAX,CAAmBK,OAAnB,CAA2B,WAA3B,EAEJL,O,CAAY,KAAKhC,K,CAAjBgC,O,wBACW,MAAKhC,KAAL,CAAWgC,OAAX,CAAmBM,OAAnB,E,SAAbC,I,eACEC,I,CAAS,KAAKxC,K,CAAdwC,I,MACJD,IAAI,EAAIC,IAAR,EAAgBA,IAAI,CAACC,IAArB,EAA6BD,IAAI,CAACC,IAAL,CAAUV,S,kDACnCC,CAAAA,OAAO,CAACU,cAAR,E,SACNV,OAAO,CAACC,YAAR,CAAqBO,IAAI,CAACC,IAAL,CAAUV,SAA/B,E,kHAOMC,Q,CAAY,KAAKhC,K,CAAjBgC,O,wBACWW,oCAAelB,IAAf,E,SAAbA,I,eACN,KAAKA,IAAL,CAAYA,IAAZ,CACA,KAAKW,QAAL,CAAc,CACZb,IAAI,CAAEE,IAAI,CAACF,IADC,CAEZC,KAAK,CAAEC,IAAI,CAACD,KAFA,CAGZC,IAAI,CAAJA,IAHY,CAAd,EAKImB,G,CAAMnB,IAAI,CAACmB,GAAL,EAAYnB,IAAI,CAACD,K,CAC3B,GAAIoB,GAAJ,CAAS,CACDC,KADC,CACOC,YAAKC,QAAL,CAAcH,GAAd,CADP,CAEPA,GAAG,CAAGC,KAAK,CAACG,IAAN,CAAW,SAAAC,IAAI,QAAIC,aAAKC,SAAL,CAAeC,IAAf,CAAoBH,IAApB,CAAJ,EAAf,CAAN,CACD,CACDjB,QAAO,CAACqB,kBAAR,CAA2B,CACzBC,OAAO,CAAEV,GAAG,EAAI,IADS,CAEzBW,QAAQ,CAAE9B,IAAI,CAAC+B,SAAL,EAAkB,CAACZ,GAAnB,CAAyBnB,IAAI,CAACD,KAA9B,CAAsC,EAFvB,CAGzBiC,aAAa,CAAE,EAHU,CAA3B,E,8UAUiBC,e,CAAiB,iBACpC,GAAIA,eAAe,GAAK,WAApB,EAAmC,CAAC,KAAKrC,KAAL,CAAWD,KAAnD,CAA0D,CACxDc,eAAQC,QAAR,GAAmBwB,IAAnB,CAAwB,SAAAC,EAAE,CAAI,CAC5B,MAAI,CAACxB,QAAL,CAAc,CAAEhB,KAAK,CAAEwC,EAAT,CAAd,EACA,GAAIA,EAAJ,CAAQ,MAAI,CAAC5D,KAAL,CAAWgC,OAAX,CAAmBK,OAAnB,CAA2B,eAA3B,EACT,CAHD,EAID,CACF,C,yCAES,CACRM,mCAAekB,KAAf,GAEAC,4BAAUC,OAAV,GACD,C,+CAEY,CACX,KAAK3B,QAAL,CAAc,CACZd,MAAM,CAAE,KADI,CAAd,EAGD,C,uCAEQ,CACP,MACE,8BAAC,KAAD,EACE,QAAQ,KADV,CAEE,KAAK,CAAE,CACL0C,eAAe,CAAE,aADZ,CAELC,IAAI,CAAE,CAFD,CAFT,CAME,WAAW,KANb,CAOE,iBAAiB,CAAE,CAPrB,CAQE,YAAY,CAAE,KARhB,CASE,QAAQ,CAAC,KATX,CAUE,KAAK,CAAC,QAVR,CAWE,MAAM,CAAE,KAAK5C,KAAL,CAAWC,MAXrB,CAYE,QAAQ,CAAE,KAAK4C,OAZjB,iEAcE,6BAAC,oCAAD,EACE,QAAQ,CAAE,SADZ,CAEE,KAAK,CAAE,CACLC,UAAU,CAAE,QADP,CAELF,IAAI,CAAE,CAFD,CAGLG,SAAS,CAAE5F,UAAU,CAAG,GAHnB,CAFT,iEAQE,6BAAC,oBAAD,EAAM,KAAK,CAAEK,KAAK,CAACwF,SAAnB,kEACE,6BAAC,iBAAD,EACE,GAAG,CAAE,aAAAC,YAAY,CAAI,CACnB,8BAAqBA,YAArB,EACD,CAHH,CAIE,WAAW,CAAE,CAAET,KAAK,CAAE,KAAKnC,UAAd,CAA0BpC,KAAK,CAAE,IAAjC,CAJf,kEADF,CARF,CAdF,CADF,CAkCD,C,4BA1H0BiF,gB,+BAAvBrD,c,aACe,CACjBc,OAAO,CAAEwC,mBAAUC,MADF,CAEjBjC,IAAI,CAAEgC,mBAAUC,MAFC,C,EA4HrB5F,KAAK,CAAG6B,2BAAWgE,MAAX,CAAkB,CACxBL,SAAS,CAAE,CACTM,YAAY,CAAE,EADL,CAETX,eAAe,CAAE,OAFR,CAGTY,QAAQ,CAAE,CAHD,CAITX,IAAI,CAAE,CAJG,CAKT1F,KAAK,CAAEH,SAAS,CAAG,IALV,CAMTyG,SAAS,CAAErG,UAAU,CAAG,IANf,CAOTsG,YAAY,CAAE,EAPL,CAQTC,OAAO,CAAE,CARA,CASTC,QAAQ,CAAE,QATD,CAUTC,aAAa,CAAE,CAVN,CADa,CAAlB,CAAR,CAeA,QAASC,CAAAA,eAAT,CAAyBC,KAAzB,CAAgC,CAC9B,MAAO,CACL3C,IAAI,CAAE2C,KAAK,CAAC3C,IADP,CAELT,SAAS,CAAEoD,KAAK,CAACpD,SAFZ,CAAP,CAID,CAED,QAASqD,CAAAA,kBAAT,CAA4BC,QAA5B,CAAsC,CACpC,MAAO,CACLrD,OAAO,CAAE,uGAEFsD,WAFE,EAGFC,WAHE,EAIFC,iBAJE,EAKFC,iBALE,EAMFC,gBANE,EAQPL,QARO,CADJ,CAAP,CAYD,C,aAEc,wBAAQH,eAAR,CAAyBE,kBAAzB,EAA6ClE,cAA7C,C","sourcesContent":["import React, { Component } from 'react';\nimport {\n  StyleSheet,\n  View,\n  KeyboardAvoidingView,\n  AppState,\n  Dimensions\n} from 'react-native';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport ShareExtension from 'react-native-share-extension';\nimport RNExitApp from 'react-native-exit-app';\n\nimport * as createPostActions from 'modules/createPost/createPost.actions';\nimport * as navigationActions from 'modules/navigation/navigation.actions';\nimport * as authActions from 'modules/auth/auth.actions';\nimport * as postActions from 'modules/post/post.actions';\nimport * as communityActions from 'modules/community/community.actions';\n\nimport Auth from 'modules/auth/mobile/auth.component';\n\nimport { createAppContainer } from 'react-navigation';\nimport { TransitionPresets, createStackNavigator } from 'react-navigation-stack';\n\nimport UrlComponent from 'modules/createPost/mobile/url.component';\nimport Categories from 'modules/createPost/mobile/categories.component';\n\nimport HeaderLeft from 'modules/navigation/mobile/headerLeft.component';\nimport CreatePostHeaderRight from 'modules/createPost/mobile/createPostHeaderRight.component';\nimport HeaderTitle from 'modules/navigation/mobile/headerTitle.component';\nimport { setTopLevelNavigator, withProps } from 'app/utils/nav';\n\nimport { text, storage, post } from 'app/utils';\nimport { darkGrey } from 'app/styles/global';\n\n// Nasty hack because for some reason Dimensions.get('window') returns 0,0\nconst fullWidth = Dimensions.get('screen').width;\nconst fullHeight = Dimensions.get('screen').height;\n// Modal animation depends on getting the width of the screen\nDimensions.get = () => ({ width: fullWidth, height: fullHeight });\nconst Modal = require('react-native-modalbox').default;\n\nlet style;\n\nexport const ShareStack = createStackNavigator(\n  {\n    createPostUrl: {\n      screen: withProps(UrlComponent),\n      params: {\n        title: 'Share On Relevant',\n        left: 'Close',\n        next: 'Next',\n        share: true\n      }\n    },\n    createPostTags: {\n      screen: withProps(Categories),\n      params: {\n        title: 'Post Category',\n        share: true\n      }\n    },\n    shareAuth: {\n      screen: withProps(Auth),\n      params: {\n        left: 'Close',\n        share: true\n      }\n    }\n  },\n  {\n    initialRouteName: 'createPostUrl',\n    headerLayoutPreset: 'center',\n    cardOverlayEnabled: true,\n    cardShadowEnabled: true,\n\n    defaultNavigationOptions: props => ({\n      gesturesEnabled: true,\n      gestureResponseDistance: {\n        horizontal: fullWidth\n      },\n      headerStyle: {\n        elevation: 0,\n        shadowOpacity: 0,\n        borderBottomColor: darkGrey,\n        borderBottomWidth: StyleSheet.hairlineWidth,\n        height: 45\n      },\n      headerTitle: <HeaderTitle {...props} />,\n      headerRight: <CreatePostHeaderRight {...props} />,\n      headerLeft: <HeaderLeft {...props} />,\n      ...TransitionPresets.SlideFromRightIOS\n    })\n  }\n);\n\nconst ShareAppContainer = createAppContainer(ShareStack);\n\nclass ShareContainer extends Component {\n  static propTypes = {\n    actions: PropTypes.object,\n    auth: PropTypes.object\n  };\n\n  state = {\n    token: null\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      isOpen: true,\n      type: '',\n      value: '',\n      data: {}\n    };\n    this.closeModal = this.closeModal.bind(this);\n    AppState.addEventListener('change', this.handleAppStateChange.bind(this));\n  }\n\n  async componentDidMount() {\n    try {\n      const community = 'relevant';\n      this.props.actions.setCommunity(community);\n      const token = await storage.getToken();\n\n      this.setState({ token });\n      if (!token) this.props.actions.replace('shareAuth');\n\n      const { actions } = this.props;\n      const resp = await this.props.actions.getUser();\n      const { auth } = this.props;\n      if (resp && auth && auth.user && auth.user.community) {\n        await actions.getCommunities();\n        actions.setCommunity(auth.user.community);\n      }\n    } catch (e) {\n      // console.log('e', e);\n    }\n\n    try {\n      const { actions } = this.props;\n      const data = await ShareExtension.data();\n      this.data = data;\n      this.setState({\n        type: data.type,\n        value: data.value,\n        data\n      });\n      let url = data.url || data.value;\n      if (url) {\n        const words = text.getWords(url);\n        url = words.find(word => post.URL_REGEX.test(word));\n      }\n      actions.setCreatePostState({\n        postUrl: url || null,\n        postBody: data.selection || !url ? data.value : '',\n        createPreview: {}\n      });\n    } catch (e) {\n      // console.log('share extension error', e);\n    }\n  }\n\n  handleAppStateChange(currentAppState) {\n    if (currentAppState === 'extension' && !this.state.token) {\n      storage.getToken().then(tk => {\n        this.setState({ token: tk });\n        if (tk) this.props.actions.replace('createPostUrl');\n      });\n    }\n  }\n\n  onClose() {\n    ShareExtension.close();\n    // Share extension fails to exit the React app, so if you try to open it two times in a row it fails\n    RNExitApp.exitApp();\n  }\n\n  closeModal() {\n    this.setState({\n      isOpen: false\n    });\n  }\n\n  render() {\n    return (\n      <Modal\n        backdrop\n        style={{\n          backgroundColor: 'transparent',\n          flex: 1\n        }}\n        coverScreen\n        keyboardTopOffset={0}\n        swipeToClose={false}\n        position=\"top\"\n        entry=\"bottom\"\n        isOpen={this.state.isOpen}\n        onClosed={this.onClose}\n      >\n        <KeyboardAvoidingView\n          behavior={'padding'}\n          style={{\n            alignItems: 'center',\n            flex: 1,\n            maxHeight: fullHeight * 0.9\n          }}\n        >\n          <View style={style.modalBody}>\n            <ShareAppContainer\n              ref={navigatorRef => {\n                setTopLevelNavigator(navigatorRef);\n              }}\n              screenProps={{ close: this.closeModal, share: true }}\n            />\n          </View>\n        </KeyboardAvoidingView>\n      </Modal>\n    );\n  }\n}\n\nstyle = StyleSheet.create({\n  modalBody: {\n    borderRadius: 10,\n    backgroundColor: 'white',\n    flexGrow: 1,\n    flex: 1,\n    width: fullWidth * 0.95,\n    marginTop: fullHeight * 0.05,\n    marginBottom: 30,\n    padding: 0,\n    overflow: 'hidden',\n    paddingBottom: 0\n  }\n});\n\nfunction mapStateToProps(store) {\n  return {\n    auth: store.auth,\n    community: store.community\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        ...authActions,\n        ...postActions,\n        ...navigationActions,\n        ...createPostActions,\n        ...communityActions\n      },\n      dispatch\n    )\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ShareContainer);\n"],"file":"share.container.js"}