{"version":3,"sources":["../../../../src/modules/_app/web/app.js"],"names":["PriceProvider","UpvoteAnimation","DownvoteAnimation","AnimationContainer","styled","div","process","env","BROWSER","require","App","props","authType","location","history","TwitterCT","init","ReactGA","initialize","pageView","pageview","pathname","search","listen","loc","actions","setWidth","window","innerWidth","debouncedSetWidth","now","Date","getTime","backgroundTime","reloadAllTabs","auth","navigation","screenSize","user","role","showModal","webOnboard","onboarding","invitecode","redeemInvite","event","category","action","set","userId","_id","getEarnings","community","replace","updateCommunity","NODE_ENV","initAnalytics","getUser","handleUserLogin","parsed","queryString","parse","setInviteCode","isAuthenticated","match","push","updateWidth","addEventListener","reloadTabs","route","routes","newCommunity","length","BANNED_COMMUNITY_SLUGS","includes","setCommunity","prevProps","scrollTo","PrevUserId","userToSocket","globalModal","filter","Component","PropTypes","object","oneOfType","string","mapStateToProps","state","modal","mapDispatchToProps","dispatch","navigationActions","authActions","getCommunities"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport PropTypes from 'prop-types';\n\nimport loadable from '@loadable/component';\n\nimport AwesomeDebouncePromise from 'awesome-debounce-promise';\nimport routes from 'modules/_app/web/routes'; // eslint-disable-line\nimport queryString from 'query-string';\nimport get from 'lodash/get';\nimport { renderRoutes, matchRoutes } from 'react-router-config';\nimport { getCommunities } from 'modules/community/community.actions';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { withRouter } from 'react-router-dom';\nimport { getEarnings } from 'modules/wallet/earnings.actions';\nimport * as navigationActions from 'modules/navigation/navigation.actions';\nimport * as authActions from 'modules/auth/auth.actions';\nimport ModalContainer from 'modules/ui/modals/modal.container';\nimport { GlobalStyle } from 'app/styles';\nimport { BANNED_COMMUNITY_SLUGS } from '@r3l/common';\nimport SmartBanner from 'react-smartbanner';\nimport ReactGA from 'react-ga';\nimport { TwitterCT } from 'app/utils/social';\nimport { TextTooltip } from 'modules/tooltip/web/tooltip.component';\nimport { ToastContainer } from 'react-toastify';\nimport { ContractProvider } from 'modules/contract/contract.provider';\nimport styled from 'styled-components';\n\nconst PriceProvider = loadable(() => import('modules/wallet/price.context'));\n\nconst UpvoteAnimation = loadable(() =>\n  import('modules/animation/upvoteAnimation.component')\n);\nconst DownvoteAnimation = loadable(() =>\n  import('modules/animation/downvoteAnimation.component')\n);\n\nconst AnimationContainer = styled.div`\n  pointer-events: none;\n  top: '0',\n  left: '0',\n  zIndex: '10000'\n`;\n\n// const DEV_MODE = process.env.NODE_ENV === 'development';\n\nif (process.env.BROWSER === true) {\n  require('app/styles/fonts.css');\n  require('react-toastify/dist/ReactToastify.css');\n  require('react-smartbanner/dist/main.css');\n}\n\nclass App extends Component {\n  static propTypes = {\n    auth: PropTypes.object,\n    actions: PropTypes.object,\n    match: PropTypes.object,\n    location: PropTypes.object,\n    user: PropTypes.object,\n    history: PropTypes.object,\n    route: PropTypes.object,\n    globalModal: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n    navigation: PropTypes.object\n  };\n\n  constructor(props) {\n    super(props);\n    const { history } = props;\n    history.listen(loc => this.updateCommunity(loc));\n  }\n\n  state = {\n    authType: null\n  };\n\n  componentDidMount() {\n    const { actions, auth, location, history } = this.props;\n\n    if (process.env.NODE_ENV !== 'development') {\n      this.initAnalytics({ location, history });\n    }\n\n    // actions.getCommunities();\n    actions.getUser();\n\n    if (auth.user) this.handleUserLogin();\n\n    const parsed = queryString.parse(location.search);\n    if (parsed.invitecode) {\n      actions.setInviteCode(parsed.invitecode);\n      if (auth.isAuthenticated) {\n        actions.redeemInvite(parsed.invitecode);\n      } else if (!location.pathname.match('resetPassword')) {\n        history.push({\n          pathname: '/user/signup',\n          search: `${location.search}&redirect=${location.pathname}`\n        });\n      }\n    }\n    this.updateWidth();\n    window.addEventListener('resize', this.updateWidth);\n    // TODO do this after a timeout\n    window.addEventListener('blur', () => {\n      this.backgroundTime = new Date().getTime();\n    });\n\n    // TODO do this after a timeout\n    window.addEventListener('focus', () => this.reloadTabs());\n  }\n\n  updateCommunity(location) {\n    const { actions, auth } = this.props;\n\n    const route = matchRoutes(routes, location.pathname);\n    const newCommunity = get(route, `[${route.length - 1}].match.params.community`);\n\n    if (\n      newCommunity &&\n      newCommunity !== auth.community &&\n      !BANNED_COMMUNITY_SLUGS.includes(newCommunity)\n    ) {\n      actions.setCommunity(newCommunity);\n    }\n  }\n\n  initAnalytics = ({ location, history }) => {\n    TwitterCT.init('o1p7u');\n    ReactGA.initialize('UA-51795165-6');\n\n    TwitterCT.pageView();\n    ReactGA.pageview(location.pathname + location.search);\n\n    history.listen(loc => {\n      TwitterCT.pageView();\n      ReactGA.pageview(loc.pathname + loc.search);\n    });\n  };\n\n  setWidth = () => {\n    this.props.actions.setWidth(window.innerWidth);\n  };\n\n  debouncedSetWidth = AwesomeDebouncePromise(this.setWidth, 100);\n\n  updateWidth = () => {\n    this.debouncedSetWidth();\n  };\n\n  reloadTabs = () => {\n    const now = new Date().getTime();\n    if (now - this.backgroundTime > 10 * 60 * 1000) {\n      this.props.actions.reloadAllTabs();\n    }\n  };\n\n  handleUserLogin = () => {\n    const { auth, actions, navigation, location, history } = this.props;\n    const { screenSize } = navigation;\n\n    if (auth.user.role === 'temp') {\n      return actions.showModal('setHandle');\n    }\n    if (!auth.user.webOnboard.onboarding) {\n      actions.showModal('onboarding');\n      actions.webOnboard('onboarding');\n    }\n    if (auth.invitecode) {\n      actions.redeemInvite(auth.invitecode);\n      ReactGA.event({\n        category: 'User',\n        action: 'Redeemed Invite'\n      });\n    }\n    ReactGA.set({ userId: auth.user._id });\n    actions.getEarnings('pending');\n\n    if (!auth.community && location.pathname === '/') {\n      history.replace('/communities');\n    }\n\n    if (screenSize) return null;\n    return null;\n  };\n\n  componentDidUpdate(prevProps) {\n    const { actions, auth, location } = this.props;\n\n    if (location.pathname !== prevProps.location.pathname) {\n      window.scrollTo(0, 0);\n    }\n\n    const userId = auth.user ? auth.user._id : null;\n    const PrevUserId = prevProps.auth.user ? prevProps.auth.user._id : null;\n\n    if (userId !== PrevUserId) {\n      actions.userToSocket(userId);\n    }\n\n    if (!prevProps.auth.user && auth.user) {\n      this.handleUserLogin();\n    }\n\n    if (\n      prevProps.auth.user &&\n      auth.user &&\n      prevProps.auth.user.role === 'temp' &&\n      auth.user.role !== 'temp'\n    ) {\n      this.handleUserLogin();\n    }\n  }\n\n  render() {\n    const { globalModal, navigation } = this.props;\n    const { screenSize } = navigation;\n    return (\n      <div>\n        <GlobalStyle />\n        <SmartBanner\n          daysHidden={0}\n          daysReminder={0}\n          title={'Relevant Communities'}\n          position={'top'}\n          // force={'ios'}\n        />\n        <TextTooltip\n          globalEventOff=\"click\"\n          type={'dark'}\n          scrollHide\n          id=\"mainTooltip\"\n          multiline\n        />\n        {/*        <CustomTooltip id=\"tooltip\" multiline />\n         */}\n        <AnimationContainer>\n          <UpvoteAnimation />\n          <DownvoteAnimation />\n        </AnimationContainer>\n\n        <ContractProvider>\n          <PriceProvider>\n            <Fragment>\n              <ModalContainer />\n              <ToastContainer />\n              <div style={globalModal && !screenSize ? { filter: 'blur(2px)' } : {}}>\n                {renderRoutes(this.props.route.routes)}\n              </div>\n            </Fragment>\n          </PriceProvider>\n        </ContractProvider>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  user: state.auth.user,\n  auth: state.auth,\n  navigation: state.navigation,\n  globalModal: state.navigation.modal\n});\n\nconst mapDispatchToProps = dispatch => ({\n  actions: bindActionCreators(\n    {\n      ...navigationActions,\n      ...authActions,\n      getCommunities,\n      getEarnings\n    },\n    dispatch\n  )\n});\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(App));\n"],"file":"app.js"}