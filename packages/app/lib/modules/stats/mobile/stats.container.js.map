{"version":3,"sources":["../../../../src/modules/stats/mobile/stats.container.js"],"names":["styles","StatsContainer","props","context","state","refreshing","loading","renderItem","bind","renderHeader","load","next","auth","stats","setState","error","refresh","list","scrollToOffset","offset","end","Date","start","relStart","setUTCHours","setDate","getDate","actions","getChart","getRelChart","getStats","user","filler","nextUpdate","fromNow","relChart","statNumber","alignSelf","marginTop","break","smallInfo","color","level","item","index","emptyList","libre","fontSize","textAlign","georgia","emptyText","quarterLetterSpacing","relevance","darkGrey","Platform","OS","c","flex","toString","backgroundColor","Component","PropTypes","object","number","bool","localStyles","StyleSheet","create","container","rowTitle","paddingRight","fontFamily","paddingVertical","label","blue","fontWeight","padding","alignItems","borderBottomWidth","hairlineWidth","globalStyles","mapStateToProps","tags","navigation","mapDispatchToProps","dispatch","authActions","navigationActions"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { StyleSheet, Text, View, RefreshControl, FlatList, Platform } from 'react-native';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { globalStyles, blue, darkGrey } from 'app/styles/global';\nimport * as navigationActions from 'modules/navigation/navigation.actions';\nimport * as authActions from 'modules/auth/auth.actions';\nimport CustomSpinner from 'modules/ui/mobile/CustomSpinner.component';\nimport ErrorComponent from 'modules/ui/mobile/error.component';\nimport EmptyList from 'modules/ui/mobile/emptyList.component';\nimport Level from './level.component';\nimport StatCategory from './statCat.component';\nimport Chart from './chart.component';\n\nlet styles;\n\nclass StatsContainer extends Component {\n  static propTypes = {\n    auth: PropTypes.object,\n    refresh: PropTypes.number,\n    actions: PropTypes.object,\n    error: PropTypes.bool\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      refreshing: false,\n      loading: true\n    };\n    this.renderItem = this.renderItem.bind(this);\n    this.renderHeader = this.renderHeader.bind(this);\n    this.load = this.load.bind(this);\n  }\n\n  componentWillMount() {\n    this.load();\n  }\n\n  // componentWillUpdate(next) {\n  componentWillReceiveProps(next) {\n    if (next.auth.stats !== this.props.auth.stats) {\n      this.setState({ refreshing: false });\n      this.setState({ loading: false });\n    }\n    if (next.error) {\n      this.setState({ refreshing: false });\n      this.setState({ loading: false });\n    }\n    if (this.props.refresh !== next.refresh && this.list) {\n      this.list.scrollToOffset({ offset: 0 });\n    }\n  }\n\n  load() {\n    this.end = new Date();\n    this.start = new Date();\n    this.relStart = new Date();\n\n    // this.end.setUTCHours(0, 0, 0, 0);\n    this.start.setUTCHours(0, 0, 0, 0);\n    this.relStart.setUTCHours(0, 0, 0, 0);\n    this.relStart.setDate(this.start.getDate() - 28);\n    this.start.setDate(this.start.getDate() - 14);\n    this.props.actions.getChart(this.start, this.end);\n    this.props.actions.getRelChart(this.start, this.end);\n    this.props.actions.getStats(this.props.auth.user);\n  }\n\n  renderHeader() {\n    if (this.filler) return this.filler;\n    const nextUpdate = moment(this.props.auth.nextUpdate).fromNow(true);\n    const relChart = (\n      <Chart\n        start={this.relStart}\n        end={this.end}\n        type={'smooth'}\n        dataKey={'aggregateRelevance'}\n        data={this.props.auth.relChart}\n        renderHeader={() => (\n          <Text style={[styles.statNumber, { alignSelf: 'center', marginTop: 45 }]}>\n            Relevance\n          </Text>\n        )}\n        renderFooter={() => <View style={styles.break} />}\n      />\n    );\n\n    return (\n      <View>\n        <View style={styles.nextUpdate}>\n          <Text style={[styles.smallInfo, { color: 'white' }]}>\n            {nextUpdate} until next update\n          </Text>\n        </View>\n\n        <Level level={this.props.auth.user.level} />\n\n        <StatCategory\n          index={0}\n          stats={this.props.auth.user}\n          actions={this.props.actions}\n        />\n\n        <View style={styles.break} />\n\n        {relChart}\n        {/* chart */}\n      </View>\n    );\n  }\n\n  renderItem({ item, index }) {\n    return (\n      <View>\n        <StatCategory index={index + 1} stats={item} actions={this.props.actions} />\n        <View style={styles.break} />\n      </View>\n    );\n  }\n\n  render() {\n    const { auth } = this.props;\n    const stats = auth.stats || [];\n    const { user } = auth;\n    this.filler = null;\n\n    if (this.props.error && !this.props.auth.user) {\n      return (\n        <ErrorComponent\n          error={this.props.error}\n          parent={'stats'}\n          reloadFunction={this.load}\n        />\n      );\n    }\n\n    if (this.state.loading) {\n      return <CustomSpinner visible />;\n    }\n\n    if (!this.props.auth.user.level) {\n      const nextUpdate = moment(this.props.auth.nextUpdate).fromNow(true);\n      this.filler = (\n        <EmptyList visible style={styles.emptyList}>\n          <Text style={[styles.libre, { fontSize: 40, textAlign: 'center' }]}>\n            You will see your stats here soon\n          </Text>\n          <Text style={[styles.georgia, styles.emptyText, styles.quarterLetterSpacing]}>\n            {nextUpdate} until next update\n          </Text>\n        </EmptyList>\n      );\n    }\n\n    if (user.relevance < 5) {\n      this.filler = (\n        <EmptyList visible style={styles.emptyList}>\n          <Text\n            style={[styles.libre, styles.darkGrey, { fontSize: 40, textAlign: 'center' }]}\n          >\n            Earn 5 relevant points to see your stats!\n          </Text>\n          <Text\n            style={[\n              styles.georgia,\n              styles.darkGrey,\n              styles.emptyText,\n              styles.quarterLetterSpacing\n            ]}\n          >\n            Tip: {Platform.OS === 'android' ? '😎' : '🤓'} You can earn relevance by being\n            one of the first to upvote a quality post\n          </Text>\n        </EmptyList>\n      );\n    }\n\n    return (\n      <FlatList\n        ref={c => (this.list = c)}\n        style={{ flex: 1 }}\n        keyExtractor={(item, index) => index.toString()}\n        extraData={{ ...this.props, ...this.state }}\n        data={stats}\n        ListHeaderComponent={this.renderHeader}\n        renderItem={item => (!this.filler ? this.renderItem(item) : null)}\n        refreshControl={\n          <RefreshControl\n            style={[{ backgroundColor: 'hsl(238,20%,95%)' }]}\n            refreshing={this.state.refreshing && !this.props.error}\n            onRefresh={() => {\n              this.setState({ refreshing: true });\n              this.load();\n            }}\n          />\n        }\n      />\n    );\n  }\n}\n\nconst localStyles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  rowTitle: {\n    fontSize: 17,\n    paddingRight: 5,\n    backgroundColor: 'transparent',\n    fontFamily: 'System',\n    paddingVertical: 20,\n    alignSelf: 'center',\n    color: darkGrey\n  },\n\n  label: {\n    backgroundColor: blue,\n    fontWeight: 'bold',\n    textAlign: 'center',\n    padding: 15,\n    color: 'white'\n  },\n  nextUpdate: {\n    padding: 10,\n    alignItems: 'center',\n    backgroundColor: blue,\n    borderBottomWidth: StyleSheet.hairlineWidth\n  }\n});\n\nstyles = { ...globalStyles, ...localStyles };\n\nfunction mapStateToProps(state) {\n  return {\n    tags: state.tags,\n    auth: state.auth,\n    refresh: state.navigation.stats.refresh,\n    error: state.error.stats\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        ...authActions,\n        ...navigationActions\n      },\n      dispatch\n    )\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(StatsContainer);\n"],"file":"stats.container.js"}