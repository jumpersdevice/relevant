{"version":3,"sources":["../../../../src/modules/stats/mobile/chart.component.js"],"names":["Chart","props","context","state","refreshing","load","bind","data","chartData","length","type","next","lenght","end","Date","start","setUTCHours","setDate","getDate","actions","getStats","auth","user","getChart","dataKey","current","min","max","entry","find","el","date","getTime","value","aggregateRelevance","totalSamples","Math","push","v","name","utcOffset","format","y","x","ceil","floor","tickCount","abs","chartOptions","axisY","labelFunction","val","round","scale","axisX","chart","fillOpacity","renderHeader","renderFooter","Component","PropTypes","array","string","object","func"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { View } from 'react-native';\nimport PropTypes from 'prop-types';\nimport { Bar, StockLine } from 'react-native-pathjs-charts';\nimport moment from 'moment';\nimport chartOptions from './chartOptions';\n\nexport default class Chart extends Component {\n  static propTypes = {\n    data: PropTypes.array,\n    type: PropTypes.string,\n    actions: PropTypes.object,\n    auth: PropTypes.object,\n    renderHeader: PropTypes.func,\n    renderFooter: PropTypes.func\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      refreshing: false\n    };\n\n    this.load = this.load.bind(this);\n    this.data = [];\n    this.chartData = this.chartData.bind(this);\n  }\n\n  componentWillMount() {\n    if (this.props.data) {\n      if (this.props.data.length < 2 && this.props.type === 'smooth') {\n        return;\n      }\n      this.data = [];\n      this.chartData(this.props);\n    }\n  }\n\n  componentWillReceiveProps(next) {\n    if (next.data !== this.props.data && next.data.length) {\n      if (next.data) {\n        if (next.data.lenght < 2 && this.props.type === 'smooth') return;\n        this.data = [];\n        this.chartData(next);\n      }\n    }\n  }\n\n  load() {\n    this.end = new Date();\n    this.start = new Date();\n    this.end.setUTCHours(0, 0, 0, 0);\n    this.start.setUTCHours(0, 0, 0, 0);\n    this.start.setDate(this.start.getDate() - 14);\n    this.props.actions.getStats(this.props.auth.user);\n    this.props.actions.getChart(this.start, this.end);\n  }\n\n  chartData(props) {\n    const { type, data, start, end, dataKey } = props;\n    const current = new Date(start);\n    let min;\n    let max;\n    this.data = [];\n\n    while (current < end) {\n      const entry = data.find(el => new Date(el.date).getTime() === current.getTime());\n      let value;\n      if (type === 'bar') {\n        value = entry ? entry[dataKey] : 0;\n      } else {\n        value = entry ? entry.aggregateRelevance / entry.totalSamples : 0;\n      }\n\n      min = min || value;\n      max = max || value;\n      min = Math.min(min, value);\n      max = Math.max(max, value);\n\n      if (type === 'bar') {\n        this.data.push({\n          v: value,\n          name: moment(current)\n            .utcOffset(0)\n            .format('M/D', 'utc')\n        });\n      } else if (entry) {\n        this.data.push({\n          y: value,\n          x: current.getTime()\n        });\n      }\n      current.setDate(current.getDate() + 1);\n    }\n    max = Math.ceil(max);\n    min = Math.floor(min);\n\n    let tickCount = Math.min(min < 0 ? max - min + 1 : max + 1, 6);\n    if (max - min < 1) tickCount = 6;\n\n    if (typeof max !== 'number' || Math.abs(max) < 1) max = 1;\n    if (typeof min !== 'number' || Math.abs(min) < 1) min = -1;\n\n    this.chartOptions = {\n      ...chartOptions,\n      min: min || 0,\n      max: max || 1,\n      axisY: {\n        ...chartOptions.axisY,\n        tickCount,\n        labelFunction: val => (max - min > 1 ? Math.round(val) : val),\n        scale: 10,\n        min,\n        max\n      },\n      axisX: {\n        ...chartOptions.axisX,\n        labelFunction: val =>\n          moment(new Date(val))\n            .utcOffset(0)\n            .format('M/D', 'utc')\n      }\n    };\n  }\n\n  render() {\n    const { type } = this.props;\n    let chart;\n\n    if (type === 'bar' && this.data.length > 1) {\n      chart = (\n        <View>\n          <Bar data={[this.data]} options={this.chartOptions} accessorKey={'v'} />\n        </View>\n      );\n    } else if (type === 'smooth' && this.data.length > 1) {\n      chart = (\n        <View>\n          <StockLine\n            regionStyling={{ fillOpacity: 0 }}\n            data={[this.data]}\n            options={this.chartOptions}\n            xKey={'x'}\n            yKey={'y'}\n          />\n        </View>\n      );\n    } else {\n      return null;\n    }\n    return (\n      <View>\n        {this.props.renderHeader()}\n        {chart}\n        {this.props.renderFooter()}\n      </View>\n    );\n  }\n}\n"],"file":"chart.component.js"}