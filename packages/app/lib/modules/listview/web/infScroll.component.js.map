{"version":3,"sources":["../../../../src/modules/listview/web/infScroll.component.js"],"names":["InfScroll","props","scrollListener","bind","attachScrollListener","pageLoaded","pageStart","data","length","loadMore","detachScrollListener","loader","defaultLoader","scrollEl","window","useWindow","scrollComponent","parentNode","removeEventListener","useCapture","hasMore","addEventListener","initialLoad","el","offset","scrollTop","pageYOffset","undefined","document","documentElement","body","isReverse","calculateTopPosition","offsetHeight","innerHeight","scrollHeight","clientHeight","Number","threshold","offsetTop","offsetParent","children","element","ref","node","React","createElement","Component","PropTypes","array","propTypes","string","bool","func","isRequired","number","oneOfType","object","defaultProps"],"mappings":"yhCAAA,qDACA,6D,stBAEqBA,CAAAA,S,sGAKnB,mBAAYC,KAAZ,CAAmB,wDACjB,uBAAMA,KAAN,EAEA,MAAKC,cAAL,CAAsB,MAAKA,cAAL,CAAoBC,IAApB,4CAAtB,CACA,MAAKC,oBAAL,CAA4B,MAAKA,oBAAL,CAA0BD,IAA1B,4CAA5B,CAJiB,aAKlB,C,gGAEmB,CAClB,KAAKE,UAAL,CAAkB,KAAKJ,KAAL,CAAWK,SAA7B,CACA,KAAKF,oBAAL,GACA,KAAKG,IAAL,CAAY,KAAKN,KAAL,CAAWM,IAAvB,CACA,GAAI,CAAC,KAAKA,IAAN,EAAc,CAAC,KAAKA,IAAL,CAAUC,MAA7B,CAAqC,CACnC,KAAKP,KAAL,CAAWQ,QAAX,CAAoB,KAAKJ,UAAzB,EACD,CACF,C,+DAEoB,CACnB,GAAI,KAAKE,IAAL,CAAUC,MAAV,GAAqB,KAAKP,KAAL,CAAWM,IAAX,CAAgBC,MAAzC,CAAiD,CAC/C,KAAKJ,oBAAL,GACA,KAAKG,IAAL,CAAY,KAAKN,KAAL,CAAWM,IAAvB,CACD,CACD,GAAI,CAAC,KAAKN,KAAL,CAAWM,IAAX,CAAgBC,MAAjB,CAA0B,KAAKD,IAAL,CAAUC,MAAxC,CAAgD,CAC9C,KAAKH,UAAL,CAAkB,KAAKJ,KAAL,CAAWK,SAA7B,CACD,CACF,C,mEAEsB,CACrB,KAAKI,oBAAL,GACD,C,0DAGgBC,M,CAAQ,CACvB,KAAKC,aAAL,CAAqBD,MAArB,CACD,C,mEAEsB,CACrB,GAAIE,CAAAA,QAAQ,CAAGC,MAAf,CACA,GAAI,KAAKb,KAAL,CAAWc,SAAX,GAAyB,KAA7B,CAAoC,CAClCF,QAAQ,CAAG,KAAKG,eAAL,CAAqBC,UAAhC,CACD,CAEDJ,QAAQ,CAACK,mBAAT,CAA6B,QAA7B,CAAuC,KAAKhB,cAA5C,CAA4D,KAAKD,KAAL,CAAWkB,UAAvE,EACAN,QAAQ,CAACK,mBAAT,CAA6B,QAA7B,CAAuC,KAAKhB,cAA5C,CAA4D,KAAKD,KAAL,CAAWkB,UAAvE,EACD,C,mEAEsB,CACrB,GAAI,CAAC,KAAKlB,KAAL,CAAWmB,OAAhB,CAAyB,CACvB,OACD,CAED,GAAIP,CAAAA,QAAQ,CAAGC,MAAf,CACA,GAAI,KAAKb,KAAL,CAAWc,SAAX,GAAyB,KAA7B,CAAoC,CAClCF,QAAQ,CAAG,KAAKG,eAAL,CAAqBC,UAAhC,CACD,CAEDJ,QAAQ,CAACQ,gBAAT,CAA0B,QAA1B,CAAoC,KAAKnB,cAAzC,CAAyD,KAAKD,KAAL,CAAWkB,UAApE,EACAN,QAAQ,CAACQ,gBAAT,CAA0B,QAA1B,CAAoC,KAAKnB,cAAzC,CAAyD,KAAKD,KAAL,CAAWkB,UAApE,EAEA,GAAI,KAAKlB,KAAL,CAAWqB,WAAf,CAA4B,CAC1B,KAAKpB,cAAL,GACD,CACF,C,uDAEgB,CACf,GAAI,CAAC,KAAKD,KAAL,CAAWM,IAAZ,EAAoB,CAAC,KAAKN,KAAL,CAAWM,IAAX,CAAgBC,MAAzC,CAAiD,OACjD,GAAMe,CAAAA,EAAE,CAAG,KAAKP,eAAhB,CACA,GAAMH,CAAAA,QAAQ,CAAGC,MAAjB,CAEA,GAAIU,CAAAA,MAAJ,CACA,GAAI,KAAKvB,KAAL,CAAWc,SAAf,CAA0B,CACxB,GAAMU,CAAAA,SAAS,CACbZ,QAAQ,CAACa,WAAT,GAAyBC,SAAzB,CACId,QAAQ,CAACa,WADb,CAEI,CAACE,QAAQ,CAACC,eAAT,EAA4BD,QAAQ,CAACE,IAAT,CAAcb,UAA1C,EAAwDW,QAAQ,CAACE,IAAlE,EACGL,SAJT,CAKA,GAAI,KAAKxB,KAAL,CAAW8B,SAAf,CAA0B,CACxBP,MAAM,CAAGC,SAAT,CACD,CAFD,IAEO,CACLD,MAAM,CACJ,KAAKQ,oBAAL,CAA0BT,EAA1B,GACCA,EAAE,CAACU,YAAH,CAAkBR,SAAlB,CAA8BX,MAAM,CAACoB,WADtC,CADF,CAGD,CACF,CAbD,IAaO,IAAI,KAAKjC,KAAL,CAAW8B,SAAf,CAA0B,CAC/BP,MAAM,CAAGD,EAAE,CAACN,UAAH,CAAcQ,SAAvB,CACD,CAFM,IAEA,CACLD,MAAM,CAAGD,EAAE,CAACY,YAAH,CAAkBZ,EAAE,CAACN,UAAH,CAAcQ,SAAhC,CAA4CF,EAAE,CAACN,UAAH,CAAcmB,YAAnE,CACD,CAED,GAAIZ,MAAM,CAAGa,MAAM,CAAC,KAAKpC,KAAL,CAAWqC,SAAZ,CAAnB,CAA2C,CACzC,KAAK5B,oBAAL,GAEA,GAAI,MAAO,MAAKT,KAAL,CAAWQ,QAAlB,GAA+B,UAAnC,CAA+C,CAC7C,KAAKR,KAAL,CAAWQ,QAAX,CAAqB,KAAKJ,UAAL,EAAmB,CAAxC,EACD,CACF,CACF,C,kEAEoBkB,E,CAAI,CACvB,GAAI,CAACA,EAAL,CAAS,CACP,MAAO,EAAP,CACD,CACD,MAAOA,CAAAA,EAAE,CAACgB,SAAH,CAAe,KAAKP,oBAAL,CAA0BT,EAAE,CAACiB,YAA7B,CAAtB,CACD,C,uCAEQ,iCAeH,KAAKvC,KAfF,CAELwC,QAFK,aAELA,QAFK,CAGLC,OAHK,aAGLA,OAHK,CAILtB,OAJK,aAILA,OAJK,CAKLE,WALK,aAKLA,WALK,CAMLS,SANK,aAMLA,SANK,CAOLpB,MAPK,aAOLA,MAPK,CAQLF,QARK,aAQLA,QARK,CASLH,SATK,aASLA,SATK,CAULgC,SAVK,aAULA,SAVK,CAWLnB,UAXK,aAWLA,UAXK,CAYLJ,SAZK,aAYLA,SAZK,CAaLR,IAbK,aAaLA,IAbK,CAcFN,KAdE,2LAiBPA,KAAK,CAAC0C,GAAN,CAAY,SAAAC,IAAI,CAAI,CAClB,MAAI,CAAC5B,eAAL,CAAuB4B,IAAvB,CACD,CAFD,CAaA,MAAOC,gBAAMC,aAAN,CACLJ,OADK,CAELzC,KAFK,CAGLwC,QAHK,CAILrB,OAAO,GAAKT,MAAM,EAAI,KAAKC,aAApB,CAJF,CAAP,CAMD,C,uBAjJoCmC,gB,yDAAlB/C,S,aACA,CACjBO,IAAI,CAAEyC,mBAAUC,KADC,C,EAmJrBjD,SAAS,CAACkD,SAAV,CAAsB,CACpBR,OAAO,CAAEM,mBAAUG,MADC,CAEpB/B,OAAO,CAAE4B,mBAAUI,IAFC,CAGpB9B,WAAW,CAAE0B,mBAAUI,IAHH,CAIpBrB,SAAS,CAAEiB,mBAAUI,IAJD,CAKpB3C,QAAQ,CAAEuC,mBAAUK,IAAV,CAAeC,UALL,CAMpBhD,SAAS,CAAE0C,mBAAUO,MAND,CAOpBjB,SAAS,CAAEU,mBAAUO,MAPD,CAQpBpC,UAAU,CAAE6B,mBAAUI,IARF,CASpBrC,SAAS,CAAEiC,mBAAUI,IATD,CAUpBX,QAAQ,CAAEO,mBAAUQ,SAAV,CAAoB,CAACR,mBAAUS,MAAX,CAAmBT,mBAAUC,KAA7B,CAApB,EAAyDK,UAV/C,CAWpB3C,MAAM,CAAEqC,mBAAUS,MAXE,CAAtB,CAcAzD,SAAS,CAAC0D,YAAV,CAAyB,CACvBhB,OAAO,CAAE,KADc,CAEvBtB,OAAO,CAAE,KAFc,CAGvBE,WAAW,CAAE,IAHU,CAIvBhB,SAAS,CAAE,CAJY,CAKvBgC,SAAS,CAAE,GALY,CAMvBvB,SAAS,CAAE,IANY,CAOvBgB,SAAS,CAAE,KAPY,CAQvBZ,UAAU,CAAE,KARW,CASvBR,MAAM,CAAE,IATe,CAAzB","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nexport default class InfScroll extends Component {\n  static propTypes = {\n    data: PropTypes.array\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.scrollListener = this.scrollListener.bind(this);\n    this.attachScrollListener = this.attachScrollListener.bind(this);\n  }\n\n  componentDidMount() {\n    this.pageLoaded = this.props.pageStart;\n    this.attachScrollListener();\n    this.data = this.props.data;\n    if (!this.data || !this.data.length) {\n      this.props.loadMore(this.pageLoaded);\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.data.length !== this.props.data.length) {\n      this.attachScrollListener();\n      this.data = this.props.data;\n    }\n    if (!this.props.data.length < this.data.length) {\n      this.pageLoaded = this.props.pageStart;\n    }\n  }\n\n  componentWillUnmount() {\n    this.detachScrollListener();\n  }\n\n  // Set a defaut loader for all your `InfiniteScroll` components\n  setDefaultLoader(loader) {\n    this.defaultLoader = loader;\n  }\n\n  detachScrollListener() {\n    let scrollEl = window;\n    if (this.props.useWindow === false) {\n      scrollEl = this.scrollComponent.parentNode;\n    }\n\n    scrollEl.removeEventListener('scroll', this.scrollListener, this.props.useCapture);\n    scrollEl.removeEventListener('resize', this.scrollListener, this.props.useCapture);\n  }\n\n  attachScrollListener() {\n    if (!this.props.hasMore) {\n      return;\n    }\n\n    let scrollEl = window;\n    if (this.props.useWindow === false) {\n      scrollEl = this.scrollComponent.parentNode;\n    }\n\n    scrollEl.addEventListener('scroll', this.scrollListener, this.props.useCapture);\n    scrollEl.addEventListener('resize', this.scrollListener, this.props.useCapture);\n\n    if (this.props.initialLoad) {\n      this.scrollListener();\n    }\n  }\n\n  scrollListener() {\n    if (!this.props.data || !this.props.data.length) return;\n    const el = this.scrollComponent;\n    const scrollEl = window;\n\n    let offset;\n    if (this.props.useWindow) {\n      const scrollTop =\n        scrollEl.pageYOffset !== undefined\n          ? scrollEl.pageYOffset\n          : (document.documentElement || document.body.parentNode || document.body)\n              .scrollTop;\n      if (this.props.isReverse) {\n        offset = scrollTop;\n      } else {\n        offset =\n          this.calculateTopPosition(el) +\n          (el.offsetHeight - scrollTop - window.innerHeight);\n      }\n    } else if (this.props.isReverse) {\n      offset = el.parentNode.scrollTop;\n    } else {\n      offset = el.scrollHeight - el.parentNode.scrollTop - el.parentNode.clientHeight;\n    }\n\n    if (offset < Number(this.props.threshold)) {\n      this.detachScrollListener();\n      // Call loadMore after detachScrollListener to allow for non-async loadMore functions\n      if (typeof this.props.loadMore === 'function') {\n        this.props.loadMore((this.pageLoaded += 1));\n      }\n    }\n  }\n\n  calculateTopPosition(el) {\n    if (!el) {\n      return 0;\n    }\n    return el.offsetTop + this.calculateTopPosition(el.offsetParent);\n  }\n\n  render() {\n    const {\n      children,\n      element,\n      hasMore,\n      initialLoad,\n      isReverse,\n      loader,\n      loadMore,\n      pageStart,\n      threshold,\n      useCapture,\n      useWindow,\n      data,\n      ...props\n    } = this.props;\n\n    props.ref = node => {\n      this.scrollComponent = node;\n    };\n\n    // This breaks activity ref above!\n    // TODO: get loading to work\n    // if (!data) {\n    //   return <div>...Loading</div>;\n    // }\n    // if (!data.length) {\n    //   return <div>Nothing here</div>;\n    // }\n\n    return React.createElement(\n      element,\n      props,\n      children,\n      hasMore && (loader || this.defaultLoader)\n    );\n  }\n}\n\nInfScroll.propTypes = {\n  element: PropTypes.string,\n  hasMore: PropTypes.bool,\n  initialLoad: PropTypes.bool,\n  isReverse: PropTypes.bool,\n  loadMore: PropTypes.func.isRequired,\n  pageStart: PropTypes.number,\n  threshold: PropTypes.number,\n  useCapture: PropTypes.bool,\n  useWindow: PropTypes.bool,\n  children: PropTypes.oneOfType([PropTypes.object, PropTypes.array]).isRequired,\n  loader: PropTypes.object\n};\n\nInfScroll.defaultProps = {\n  element: 'div',\n  hasMore: false,\n  initialLoad: true,\n  pageStart: 0,\n  threshold: 250, // footer height?\n  useWindow: true,\n  isReverse: false,\n  useCapture: false,\n  loader: null\n};\n"],"file":"infScroll.component.js"}