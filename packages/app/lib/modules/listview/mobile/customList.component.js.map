{"version":3,"sources":["../../../../src/modules/listview/mobile/customList.component.js"],"names":["styles","CustomListView","props","context","state","reloading","reload","bind","loadMore","lastReload","List","sections","SectionList","FlatList","data","length","Date","getTime","active","load","view","setState","loading","prev","error","needsReload","JSON","stringify","clearTimeout","stateTimeout","setTimeout","next","onReload","loaded","scrollableTab","headerData","type","parent","children","YOffset","stickyHeaderIndices","renderRow","renderHeader","onScroll","spinnerEl","listStyle","commonList","vis","hiddenList","emptyEl","listEl","c","listview","header","section","item","index","toString","top","y","paddingTop","Platform","OS","backgroundColor","flex","width","fullWidth","e","hideReload","Component","PropTypes","array","bool","number","func","object","string","localStyles","StyleSheet","create","flexDirection","justifyContent","height","position","globalStyles"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {\n  FlatList,\n  SectionList,\n  RefreshControl,\n  View,\n  StyleSheet,\n  Platform\n} from 'react-native';\nimport PropTypes from 'prop-types';\nimport { globalStyles, fullWidth } from 'app/styles/global';\nimport CustomSpinner from 'modules/ui/mobile/CustomSpinner.component';\nimport EmptyList from 'modules/ui/mobile/emptyList.component';\nimport ErrorComponent from 'modules/ui/mobile/error.component';\n\nlet styles;\n\nexport default class CustomListView extends Component {\n  static propTypes = {\n    data: PropTypes.array,\n    active: PropTypes.bool,\n    view: PropTypes.number,\n    load: PropTypes.func,\n    onReload: PropTypes.func,\n    loaded: PropTypes.bool,\n    headerData: PropTypes.object,\n    parent: PropTypes.string,\n    error: PropTypes.bool,\n    scrollableTab: PropTypes.bool,\n    YOffset: PropTypes.number,\n    stickyHeaderIndices: PropTypes.array,\n    onScroll: PropTypes.func,\n    renderHeader: PropTypes.func,\n    renderRow: PropTypes.func,\n    children: PropTypes.object,\n    type: PropTypes.string,\n    sections: PropTypes.array,\n    needsReload: PropTypes.number\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      reloading: false\n    };\n    this.reload = this.reload.bind(this);\n    this.loadMore = this.loadMore.bind(this);\n    this.lastReload = 0;\n    this.List = props.sections ? SectionList : FlatList;\n  }\n\n  componentDidMount() {\n    if (this.props.data && this.props.data.length) {\n      this.lastReload = new Date().getTime();\n    } else if (this.props.active) {\n      this.props.load(this.props.view, 0);\n      this.setState({ loading: true });\n      this.lastReload = new Date().getTime();\n    }\n  }\n\n  componentDidUpdate(prev) {\n    const { data, error, active, needsReload, load, view } = this.props;\n    const { reloading, loading } = this.state;\n    if (JSON.stringify(data) !== JSON.stringify(prev.data) || error) {\n      reloading && this.setState({ reloading: false });\n      loading && this.setState({ loading: false });\n    }\n    if (reloading) {\n      clearTimeout(this.stateTimeout);\n      this.stateTimeout = setTimeout(\n        () => this.setState({ reloading: false, loading: false }),\n        100\n      );\n    }\n\n    if (active && needsReload > this.lastReload && !loading) {\n      load(view, 0);\n      this.lastReload = new Date().getTime();\n    }\n  }\n\n  shouldComponentUpdate(next) {\n    if (!this.props.active && !next.active) return false;\n    return true;\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.stateTimeout);\n  }\n\n  reload() {\n    if (this.state.loading || this.state.reloading) return;\n    this.setState({ reloading: true });\n    this.lastReload = new Date().getTime();\n    this.props.load(this.props.view, 0);\n    if (this.props.onReload) this.props.onReload();\n  }\n\n  loadMore() {\n    if (this.props.loaded && !this.props.data.length) return;\n    if (!this.props.active) return;\n    if (this.state.loading || this.state.reloading) return;\n    this.setState({ loading: true });\n    let length = 0;\n    if (this.props.data) length = this.props.data.length;\n    this.props.load(this.props.view, length);\n  }\n\n  render() {\n    const {\n      active,\n      data,\n      scrollableTab,\n      headerData,\n      sections,\n      type = 'data',\n      loaded,\n      parent,\n      error,\n      children,\n      YOffset,\n      load,\n      stickyHeaderIndices,\n      renderRow,\n      renderHeader,\n      onScroll,\n      view\n    } = this.props;\n    const { reloading } = this.state;\n\n    const spinnerEl = !loaded && (\n      <CustomSpinner visible={!data.length && active && !headerData} />\n    );\n\n    const listStyle =\n      active || scrollableTab\n        ? [styles.commonList, styles.vis]\n        : [styles.commonList, styles.hiddenList];\n\n    const emptyEl =\n      loaded && !data.length ? (\n        <EmptyList visible emoji={'😶'} type={type} YOffset={YOffset}>\n          {children}\n        </EmptyList>\n      ) : null;\n\n    const { List } = this;\n\n    const listEl = (\n      <List\n        ref={c => {\n          this.listview = c;\n        }}\n        sections={sections}\n        enableEmptySections\n        scrollToOverflowEnabled={true}\n        // removeClippedSubviews\n        stickySectionHeadersEnabled\n        initialNumToRender={5}\n        maxToRenderPerBatch={10}\n        windowSize={10}\n        // pageSize={1}\n        // initialListSize={3}\n        scrollEventThrottle={10}\n        renderSectionHeader={({ section: { header } }) => header}\n        automaticallyAdjustContentInsets={false}\n        stickyHeaderIndices={stickyHeaderIndices}\n        data={data}\n        renderItem={({ item, index }) => renderRow(item, view, index)}\n        keyExtractor={(item, index) => index.toString()}\n        contentInset={{ top: YOffset || 0 }}\n        contentOffset={{ y: -YOffset || 0 }}\n        ListHeaderComponent={renderHeader}\n        contentContainerStyle={{\n          paddingTop: Platform.OS === 'android' ? this.props.YOffset : 0,\n          backgroundColor: 'white'\n        }}\n        style={{\n          flex: 0.5,\n          width: fullWidth,\n          backgroundColor: 'white'\n        }}\n        keyboardShouldPersistTaps={'always'}\n        keyboardDismissMode={'on-drag'}\n        onScroll={e => {\n          if (onScroll) {\n            onScroll(e, view || 0);\n          }\n        }}\n        onEndReached={this.loadMore}\n        onEndReachedThreshold={0.3}\n        ListFooterComponent={() => emptyEl}\n        refreshControl={\n          <RefreshControl\n            style={[\n              { backgroundColor: 'hsl(238,20%,95%)' },\n              data.length ? null : styles.hideReload\n            ]}\n            refreshing={reloading && !error}\n            onRefresh={this.reload}\n            tintColor=\"#000000\"\n            colors={['#000000', '#000000', '#000000']}\n            progressBackgroundColor=\"#ffffff\"\n          />\n        }\n      />\n    );\n\n    if (error && !data.length && !headerData) {\n      return (\n        <ErrorComponent\n          parent={parent}\n          error={error}\n          reloadFunction={() => load(view, 0)}\n        />\n      );\n    }\n\n    return (\n      <View style={listStyle}>\n        {listEl}\n        {spinnerEl}\n      </View>\n    );\n  }\n}\n\nconst localStyles = StyleSheet.create({\n  hideReload: {\n    backgroundColor: 'white'\n  },\n  vis: {\n    flex: 1,\n    width: fullWidth,\n    flexDirection: 'column',\n    justifyContent: 'flex-start'\n  },\n  hiddenList: {\n    flex: 0,\n    height: 0,\n    width: 0,\n    position: 'absolute'\n  }\n});\n\nstyles = { ...localStyles, ...globalStyles };\n"],"file":"customList.component.js"}