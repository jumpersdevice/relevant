{"version":3,"sources":["../../../../src/modules/ui/mobile/bottomSheet.js"],"names":["USE_NATIVE_DRIVER","windowHeight","Dimensions","get","height","BottomSheet","propTypes","children","PropTypes","node","close","func","setHeight","showBg","setShowBg","SnapPointsFromTop","Math","round","masterdrawer","drawer","scroll","React","createRef","START","END","length","lastSnap","setSnap","lastScrollYValue","Animated","Value","lastScrollY","onRegisterLastScroll","event","nativeEvent","contentOffset","y","useNativeDriver","addListener","value","dragY","onGestureEvent","translationY","multiply","reverseLastScrollY","translateYOffset","translateY","add","interpolate","inputRange","outputRange","onHandlerStateChange","oldState","State","ACTIVE","velocityY","dragToss","endOffsetY","destSnapPoint","forEach","snapPoint","distFromSnap","abs","extractOffset","setValue","flattenOffset","closeModal","animateView","offset","callback","StyleSheet","absoluteFillObject","backgroundColor","transform","flex","paddingBottom","IphoneX","paddingVertical","paddingHorizontal","e","layout","spring","velocity","tension","friction","toValue","start","finished"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport {\n  Animated,\n  View,\n  StyleSheet,\n  Dimensions,\n  TouchableWithoutFeedback\n} from 'react-native';\nimport PropTypes from 'prop-types';\nimport {\n  PanGestureHandler,\n  NativeViewGestureHandler,\n  State,\n  TapGestureHandler\n} from 'react-native-gesture-handler';\nimport { IphoneX } from 'app/styles/global';\n\nconst USE_NATIVE_DRIVER = true;\n\nconst windowHeight = Dimensions.get('window').height;\n\nBottomSheet.propTypes = {\n  children: PropTypes.node,\n  close: PropTypes.func\n};\n\nexport function BottomSheet({ children, close }) {\n  const [height, setHeight] = useState(0);\n  const [showBg, setShowBg] = useState(true);\n  const SnapPointsFromTop =\n    Math.round(height) <= Math.round(windowHeight)\n      ? [windowHeight - height, windowHeight]\n      : [50, windowHeight * 0.4, windowHeight];\n\n  const masterdrawer = useRef();\n  const drawer = useRef();\n\n  const scroll = React.createRef();\n\n  const START = SnapPointsFromTop[0];\n  const END = SnapPointsFromTop[SnapPointsFromTop.length - 1];\n  const [lastSnap, setSnap] = useState(END);\n\n  let lastScrollYValue = 0;\n  const [lastScrollY] = useState(new Animated.Value(0));\n  const onRegisterLastScroll = Animated.event(\n    [{ nativeEvent: { contentOffset: { y: lastScrollY } } }],\n    { useNativeDriver: USE_NATIVE_DRIVER }\n  );\n  lastScrollY.addListener(({ value }) => {\n    lastScrollYValue = value;\n  });\n\n  const [dragY] = useState(new Animated.Value(0));\n\n  const onGestureEvent = Animated.event([{ nativeEvent: { translationY: dragY } }], {\n    useNativeDriver: USE_NATIVE_DRIVER\n  });\n\n  const [reverseLastScrollY] = useState(\n    Animated.multiply(new Animated.Value(-1), lastScrollY)\n  );\n\n  const [translateYOffset] = useState(new Animated.Value(END));\n\n  const translateY = Animated.add(\n    translateYOffset,\n    Animated.add(dragY, reverseLastScrollY)\n  ).interpolate({\n    inputRange: [START, END],\n    outputRange: [START, END]\n    // extrapolate: 'clamp'\n  });\n\n  const onHandlerStateChange = ({ nativeEvent }) => {\n    // eslint-disable-next-line\n    if (nativeEvent.oldState === State.ACTIVE) {\n      const { velocityY } = nativeEvent;\n      let { translationY } = nativeEvent;\n      translationY -= lastScrollYValue;\n      const dragToss = 0.1;\n      const endOffsetY = lastSnap + translationY + dragToss * velocityY;\n\n      let destSnapPoint = SnapPointsFromTop[0];\n      SnapPointsFromTop.forEach(snapPoint => {\n        const distFromSnap = Math.abs(snapPoint - endOffsetY);\n        if (distFromSnap < Math.abs(destSnapPoint - endOffsetY)) {\n          destSnapPoint = snapPoint;\n        }\n      });\n      setSnap(destSnapPoint);\n      // Sets the offset value to the base value,\n      // and resets the base value to zero. The final output of the value is unchanged.\n      translateYOffset.extractOffset();\n      translateYOffset.setValue(translationY);\n      // Merges the offset value into the base value\n      // and resets the offset to zero. The final output of the value is unchanged.\n      translateYOffset.flattenOffset();\n      dragY.setValue(0);\n      if (destSnapPoint === END) return closeModal(velocityY);\n      return animateView({ offset: translateYOffset, velocityY, destSnapPoint });\n    }\n    return null;\n  };\n\n  function closeModal({ velocityY = 0 }) {\n    setShowBg(false);\n    animateView({\n      offset: translateYOffset,\n      velocityY,\n      destSnapPoint: END,\n      callback: close\n    });\n  }\n\n  useEffect(() => {\n    if (height === 0) return;\n    setSnap(START);\n    animateView({\n      offset: translateYOffset,\n      velocityY: 0,\n      destSnapPoint: START\n    });\n  }, [START, translateYOffset, height]);\n\n  return (\n    <TapGestureHandler\n      maxDurationMs={100000}\n      ref={masterdrawer}\n      maxDeltaY={lastSnap - SnapPointsFromTop[0]}\n      style={[StyleSheet.absoluteFillObject]}\n    >\n      <View\n        style={[\n          StyleSheet.absoluteFillObject,\n          showBg && { backgroundColor: 'hsla(0,0%,0%,.4)' }\n        ]}\n        pointerEvents={'box-none'}\n      >\n        <Animated.View\n          style={[\n            StyleSheet.absoluteFillObject,\n            {\n              transform: [{ translateY }]\n            }\n          ]}\n        >\n          <PanGestureHandler\n            ref={drawer}\n            simultaneousHandlers={[scroll, masterdrawer]}\n            shouldCancelWhenOutside={false}\n            onGestureEvent={onGestureEvent}\n            onHandlerStateChange={onHandlerStateChange}\n          >\n            <Animated.View style={{ flex: 1 }}>\n              <NativeViewGestureHandler\n                ref={scroll}\n                waitFor={masterdrawer}\n                simultaneousHandlers={drawer}\n              >\n                <Animated.ScrollView\n                  style={[\n                    {\n                      flex: 1,\n                      backgroundColor: 'white',\n                      paddingBottom: IphoneX ? 33 : 0\n                    }\n                  ]}\n                  bounces={false}\n                  onScrollBeginDrag={onRegisterLastScroll}\n                  scrollEventThrottle={1}\n                >\n                  <TouchableWithoutFeedback>\n                    <View\n                      style={[\n                        {\n                          paddingVertical: 48,\n                          paddingHorizontal: 32\n                        }\n                      ]}\n                      onLayout={e =>\n                        setHeight(e.nativeEvent.layout.height + (IphoneX ? 33 : 0))\n                      }\n                      flex={1}\n                    >\n                      {children}\n                    </View>\n                  </TouchableWithoutFeedback>\n                </Animated.ScrollView>\n              </NativeViewGestureHandler>\n            </Animated.View>\n          </PanGestureHandler>\n        </Animated.View>\n      </View>\n    </TapGestureHandler>\n  );\n}\n\nfunction animateView({ offset, velocityY, destSnapPoint, callback }) {\n  Animated.spring(offset, {\n    velocity: velocityY,\n    tension: 86,\n    friction: 10,\n    toValue: destSnapPoint,\n    useNativeDriver: USE_NATIVE_DRIVER\n  }).start(({ finished }) => {\n    finished && callback && callback();\n  });\n}\n"],"file":"bottomSheet.js"}