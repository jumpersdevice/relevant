{"version":3,"sources":["../../../../src/modules/community/web/communityMembers.component.js"],"names":["ScrollContainer","View","CommunityMembers","props","context","searchResults","searchValue","val","community","actions","searchMembers","active","e","setState","target","value","debouncedSearchMembers","results","page","length","hasMore","pageSize","getCommunityMembers","slug","skip","limit","user","title","role","getTitle","close","_id","embeddedUser","relevance","pagerank","ready","load","TITLES","admin","state","members","communityMembers","activeCommunityMembers","handleChange","p","map","memberId","renderRow","Component","PropTypes","object","func","mapStateToProps","routing","mapDispatchToProps","dispatch","joinCommunity"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport {\n  joinCommunity,\n  searchMembers,\n  getCommunityMembers\n} from 'modules/community/community.actions';\nimport AvatarBox from 'modules/user/avatarbox.component';\nimport AwesomeDebouncePromise from 'awesome-debounce-promise';\nimport InfScroll from 'modules/listview/web/infScroll.component';\nimport { Input } from 'modules/styled/web';\nimport { View, SecondaryText } from 'modules/styled/uni';\nimport styled from 'styled-components/primitives';\n\nconst ScrollContainer = styled(View)`\n  overflow: auto;\n`;\n\nclass CommunityMembers extends Component {\n  static propTypes = {\n    community: PropTypes.object,\n    actions: PropTypes.object,\n    close: PropTypes.func\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.pageSize = 20;\n    this.hasMore = true;\n    this.ready = false;\n    this.role = null;\n  }\n\n  state = {\n    searchResults: [],\n    searchValue: ''\n  };\n\n  componentDidMount() {\n    this.load(0, 0);\n  }\n\n  searchMembers = async val => {\n    const { community } = this.props;\n    return this.props.actions.searchMembers(val, community.active);\n  };\n\n  debouncedSearchMembers = AwesomeDebouncePromise(this.searchMembers, 100);\n\n  handleChange = async e => {\n    this.setState({\n      searchValue: e.target.value\n    });\n    const results = await this.debouncedSearchMembers(e.target.value);\n    this.setState({\n      searchResults: results\n    });\n  };\n\n  load = (page, length) => {\n    this.hasMore = page * this.pageSize <= length;\n    if (this.hasMore) {\n      const { community } = this.props;\n      this.props.actions.getCommunityMembers({\n        slug: community.active,\n        skip: length,\n        limit: this.pageSize\n      });\n    }\n  };\n\n  getTitle(role) {\n    const TITLES = {\n      admin: 'Admins',\n      user: 'Members'\n    };\n    return TITLES[role];\n  }\n\n  renderRow = user => {\n    const title = this.role === user.role ? null : this.getTitle(user.role);\n    this.role = user.role;\n    const { close } = this.props;\n    return (\n      <React.Fragment key={user._id}>\n        {title ? <SecondaryText m={'2 0'}>{title}</SecondaryText> : null}\n        <View fdirection=\"row\" m={['2 0']}>\n          <AvatarBox\n            user={{\n              ...user.embeddedUser,\n              relevance: {\n                pagerank: user.pagerank\n              }\n            }}\n            navigationCallback={close}\n            showRelevance\n            condensedView={false}\n          />\n        </View>\n      </React.Fragment>\n    );\n  };\n\n  render() {\n    const { community } = this.props;\n    const { searchResults, searchValue } = this.state;\n    const { active, members, communityMembers } = community;\n    const activeCommunityMembers = communityMembers[active] || [];\n    return (\n      <View fdirection=\"column\">\n        <Input\n          placeholder=\"Search\"\n          onChange={this.handleChange}\n          value={searchValue}\n          type=\"search\"\n        />\n\n        <ScrollContainer h={40} mt={2}>\n          {!searchValue ? (\n            <InfScroll\n              data={activeCommunityMembers}\n              loadMore={p => this.load(p, activeCommunityMembers.length)}\n              hasMore={this.hasMore}\n              useWindow={false}\n            >\n              {activeCommunityMembers.map(memberId => {\n                const user = members[memberId];\n                return this.renderRow(user);\n              })}\n            </InfScroll>\n          ) : (\n            searchResults.map(user => this.renderRow(user))\n          )}\n        </ScrollContainer>\n      </View>\n    );\n  }\n}\nconst mapStateToProps = state => ({\n  routing: state.routing,\n  community: state.community\n});\n\nconst mapDispatchToProps = dispatch => ({\n  actions: bindActionCreators(\n    {\n      joinCommunity,\n      searchMembers,\n      getCommunityMembers\n    },\n    dispatch\n  )\n});\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(CommunityMembers));\n"],"file":"communityMembers.component.js"}