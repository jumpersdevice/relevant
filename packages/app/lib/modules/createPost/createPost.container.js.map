{"version":3,"sources":["../../../src/modules/createPost/createPost.container.js"],"names":["PLACEHOLDER_URL","PLACEHOLDER_TEXT","MD_PLACEHOLDER","CreatePostContainer","propTypes","close","PropTypes","func","dispatch","user","state","auth","postData","createPost","community","textArea","authError","title","channel","postBody","urlPreview","linkPreview","selectedTags","allTags","postUrl","loadingPreview","postTags","disableUrl","setState","topics","prevUrl","createPreview","clearUrl","shouldDisableUrl","url","enableUrl","prevDisableUrl","handleBodyChange","target","value","current","focus","handleBlur","tags","mentions","mergedTags","Set","e","newBody","newUrl","isPaste","length","doneTypingUrl","lastIndex","shouldUpdateUrl","addUrlToState","addTextFromLink","text","stripHTML","description","showPasteButton","placeholder","renderTags","suggestedTags","component","defaultPost","PostPreview","object","bool","screenSize","navigation","colors","blue","textAlign","PasteTextButton","preventDefault"],"mappings":"odAAA,qDACA,6DACA,uCACA,gDACA,kCACA,kCACA,kCACA,8EACA,4EACA,oCACA,sCACA,2DACA,wCACA,4FACA,0DACA,wDACA,+B,q5BAEA,GAAMA,CAAAA,eAAe,CAAG,sCAAxB,CACA,GAAMC,CAAAA,gBAAgB,CACpB,4EADF,CAGA,GAAMC,CAAAA,cAAc,CAClB,4GADF,CAGAC,mBAAmB,CAACC,SAApB,CAAgC,CAC9BC,KAAK,CAAEC,mBAAUC,IADa,CAAhC,CAIe,QAASJ,CAAAA,mBAAT,MAAwC,IAATE,CAAAA,KAAS,MAATA,KAAS,CACrD,GAAMG,CAAAA,QAAQ,CAAG,6BAAjB,CACA,GAAMC,CAAAA,IAAI,CAAG,4BAAY,SAAAC,KAAK,QAAIA,CAAAA,KAAK,CAACC,IAAN,CAAWF,IAAf,EAAjB,CAAb,CACA,GAAMG,CAAAA,QAAQ,CAAG,4BAAY,SAAAF,KAAK,QAAIA,CAAAA,KAAK,CAACG,UAAV,EAAjB,CAAjB,CACA,GAAMC,CAAAA,SAAS,CAAG,6BAAlB,CACA,GAAMC,CAAAA,QAAQ,CAAG,mBAAjB,CAEA,GAAMC,CAAAA,SAAS,CAAG,8BAAlB,CAPqD,GAUnDC,CAAAA,KAVmD,CAqBjDL,QArBiD,CAUnDK,KAVmD,CAWnDC,OAXmD,CAqBjDN,QArBiD,CAWnDM,OAXmD,CAYnDC,QAZmD,CAqBjDP,QArBiD,CAYnDO,QAZmD,CAanDC,UAbmD,CAqBjDR,QArBiD,CAanDQ,UAbmD,CAcnDC,WAdmD,CAqBjDT,QArBiD,CAcnDS,WAdmD,CAenDC,YAfmD,CAqBjDV,QArBiD,CAenDU,YAfmD,CAgBnDC,OAhBmD,CAqBjDX,QArBiD,CAgBnDW,OAhBmD,CAiBnDC,OAjBmD,CAqBjDZ,QArBiD,CAiBnDY,OAjBmD,CAkBnDC,cAlBmD,CAqBjDb,QArBiD,CAkBnDa,cAlBmD,CAmBnDC,QAnBmD,CAqBjDd,QArBiD,CAmBnDc,QAnBmD,CAoBnDC,UApBmD,CAqBjDf,QArBiD,CAoBnDe,UApBmD,CAuBrD,GAAMC,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAlB,KAAK,CAAI,CACxBF,QAAQ,CACN,kEACKI,QADL,EAEKF,KAFL,EADM,CAAR,CAMD,CAPD,CAUA,qBAAU,UAAM,CACdkB,QAAQ,CAAC,CAAEL,OAAO,CAAET,SAAS,CAACe,MAArB,CAAD,CAAR,CACD,CAFD,CAEG,CAACf,SAAS,CAACe,MAAX,CAFH,EAKA,GAAMC,CAAAA,OAAO,CAAG,uBAAYN,OAAZ,CAAhB,CACA,GAAMO,CAAAA,aAAa,CAAG,uBAAWH,QAAX,CAAtB,CAEA,GAAMI,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,EAA6B,IAA5BC,CAAAA,gBAA4B,2DAAT,IAAS,CAC5CL,QAAQ,CAAC,CACPM,GAAG,CAAE,IADE,CAEPV,OAAO,CAAE,IAFF,CAGPJ,UAAU,CAAE,IAHL,CAIPK,cAAc,CAAE,KAJT,CAKPC,QAAQ,CAAE,EALH,CAMPC,UAAU,CAAEM,gBAAgB,EAAI,IANzB,CAAD,CAAR,CAQD,CATD,CAWA,qBAAU,UAAM,CACd,GAAMA,CAAAA,gBAAgB,CAAG,KAAzB,CACA,GAAI,CAACT,OAAD,EAAYJ,UAAhB,CAA4BY,QAAQ,CAACC,gBAAD,CAAR,CAA5B,IACK,IAAIT,OAAO,EAAIM,OAAO,GAAKN,OAAvB,EAAkC,CAACC,cAAnC,EAAqD,CAACE,UAA1D,CAAsE,CACzEI,aAAa,CAAC,CAAEP,OAAO,CAAPA,OAAF,CAAWL,QAAQ,CAARA,QAAX,CAAD,CAAb,CACD,CACF,CAND,CAMG,CAACK,OAAD,CANH,EAQA,GAAMW,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,SAAMP,CAAAA,QAAQ,CAAC,CAAED,UAAU,CAAE,KAAd,CAAD,CAAd,EAAlB,CAEA,GAAMS,CAAAA,cAAc,CAAG,uBAAYT,UAAZ,CAAvB,CAEA,qBAAU,UAAM,CACdS,cAAc,EACZ,CAACT,UADH,EAEEU,gBAAgB,CAAC,CAAEC,MAAM,CAAE,CAAEC,KAAK,CAAEpB,QAAT,CAAV,CAAD,CAFlB,EAGEJ,QAAQ,CAACyB,OAAT,CAAiBC,KAAjB,EAHF,CAID,CALD,CAKG,CAACd,UAAD,CALH,EAOA,GAAMe,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,kBACI,sBAAYvB,QAAZ,CADJ,CACfwB,IADe,cACfA,IADe,CACTC,QADS,cACTA,QADS,CAEvB,GAAMC,CAAAA,UAAU,iCAAO,GAAIC,CAAAA,GAAJ,2CAAYxB,YAAZ,kCAA6BqB,IAA7B,GAAP,CAAhB,CACAf,QAAQ,CAAC,CACPgB,QAAQ,CAARA,QADO,CAEPtB,YAAY,CAAEuB,UAFP,CAAD,CAAR,CAID,CAPD,CASA,GAAMR,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAAAU,CAAC,CAAI,CAC5B,GAAMC,CAAAA,OAAO,CAAGD,CAAC,CAACT,MAAF,CAASC,KAAzB,CAD4B,kBAGZ,sBAAYS,OAAZ,CAHY,CAGpBd,GAHoB,eAGpBA,GAHoB,CAI5B,GAAMe,CAAAA,MAAM,CAAGf,GAAG,EAAIA,GAAG,CAACA,GAA1B,CAGA,GAAMgB,CAAAA,OAAO,CAAGF,OAAO,CAACG,MAAR,CAAiBhC,QAAQ,CAAG,CAA5C,CACA,GAAMiC,CAAAA,aAAa,CAAGlB,GAAG,EAAIA,GAAG,CAACmB,SAAJ,GAAkBL,OAAO,CAACG,MAAvD,CACA,GAAMG,CAAAA,eAAe,CAAGF,aAAa,EAAIF,OAAzC,CAEA,GAAMK,CAAAA,aAAa,CAAG,CAAC5B,UAAD,EAAe2B,eAAf,EAAkC,CAAE9B,OAAO,CAAEyB,MAAX,CAAxD,CAEArB,QAAQ,gBACNT,QAAQ,CAAE6B,OADJ,EAEHO,aAFG,EAAR,CAID,CAjBD,CAmBA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,SACtBnB,CAAAA,gBAAgB,CAAC,CACfC,MAAM,CAAE,CAAEC,KAAK,WAAKpB,QAAL,iBAAoBsC,YAAKC,SAAL,CAAetC,UAAU,CAACuC,WAA1B,CAApB,MAAP,CADO,CAAD,CADM,EAAxB,CAKA,GAAMC,CAAAA,eAAe,CAAGxC,UAAU,EAAIA,UAAU,CAACuC,WAAjD,CACA,GAAME,CAAAA,WAAW,CAAGzC,UAAU,CAAGnB,gBAAH,CAAsBD,eAApD,CACA,GAAM8D,CAAAA,UAAU,CAAG3C,QAAQ,EAAIK,OAA/B,CAEA,GAAMuC,CAAAA,aAAa,iCAAO,GAAIjB,CAAAA,GAAJ,2CAAYvB,OAAZ,kCAAwBG,QAAxB,GAAP,CAAnB,CAEA,GAAIV,SAAJ,CAAe,MAAOA,CAAAA,SAAS,CAACgD,SAAjB,CAEf,MACE,8BAAC,SAAD,kEACE,6BAAC,SAAD,EAAM,OAAO,CAAC,MAAd,CAAqB,UAAU,CAAC,KAAhC,CAAsC,KAAK,CAAC,QAA5C,iEACE,6BAAC,kBAAD,EAAW,IAAI,CAAEvD,IAAjB,CAAuB,IAAI,CAAE,CAA7B,iEADF,CADF,CAIGS,OAAO,EACN,6BAAC,UAAD,EACE,QAAQ,CAAE,kBAAA6B,CAAC,QAAInB,CAAAA,QAAQ,CAAC,CAAEX,KAAK,CAAE8B,CAAC,CAACT,MAAF,CAASC,KAAlB,CAAD,CAAZ,EADb,CAEE,KAAK,CAAEtB,KAFT,CAGE,IAAI,CAAC,OAHP,CAIE,EAAE,CAAE,CAJN,CAKE,IAAI,CAAC,MALP,CAME,WAAW,CAAC,OANd,iEALJ,CAeE,6BAAC,SAAD,EAAM,EAAE,CAAE,CAAV,iEACE,6BAAC,4BAAD,EACE,KAAK,CAAEE,QADT,CAEE,QAAQ,CAAEkB,gBAFZ,CAGE,WAAW,CAAEvB,SAAS,CAACmD,WAAV,GAA0B,MAA1B,CAAmC/D,cAAnC,CAAoD2D,WAHnE,CAIE,WAAW,KAJb,CAKE,QAAQ,CAAE9C,QALZ,CAME,SAAS,CAAE,EANb,CAOE,MAAM,CAAE2B,UAPV,CAQE,QAAQ,CAAEA,UARZ,iEADF,CAWGkB,eAAe,EAAI,6BAAC,eAAD,EAAiB,eAAe,CAAEJ,eAAlC,kEAXtB,CAfF,CA6BE,6BAAC,QAAD,EAAK,EAAE,CAAE,CAAT,iEA7BF,CA8BE,6BAAC,WAAD,EACE,QAAQ,CAAExB,QADZ,CAEE,UAAU,CAAEZ,UAFd,CAGE,WAAW,CAAEC,WAHf,CAIE,WAAW,CAAE6C,WAJf,CAKE,SAAS,CAAE/B,SALb,CAME,UAAU,CAAER,UANd,iEA9BF,CAuCGmC,UAAU,EACT,6BAAC,aAAD,EACE,QAAQ,CAAElC,QADZ,CAEE,YAAY,CAAEN,YAAY,EAAI,EAFhC,CAGE,OAAO,CAAEyC,aAAa,EAAI,EAH5B,iEAxCJ,CA+CE,6BAAC,eAAD,EAAQ,KAAK,CAAE1D,KAAf,iEA/CF,CADF,CAmDD,CAED6D,WAAW,CAAC9D,SAAZ,CAAwB,CACtBgB,UAAU,CAAEd,mBAAU6D,MADA,CAEtB9C,WAAW,CAAEf,mBAAU6D,MAFD,CAGtBnC,QAAQ,CAAE1B,mBAAUC,IAHE,CAItB4B,SAAS,CAAE7B,mBAAUC,IAJC,CAKtBoB,UAAU,CAAErB,mBAAU8D,IALA,CAAxB,CAQA,QAASF,CAAAA,WAAT,OAAmF,IAA5D9C,CAAAA,UAA4D,OAA5DA,UAA4D,CAAhDC,WAAgD,OAAhDA,WAAgD,CAAnCW,QAAmC,OAAnCA,QAAmC,CAAzBL,UAAyB,OAAzBA,UAAyB,CAAbQ,SAAa,OAAbA,SAAa,CACjF,GAAMkC,CAAAA,UAAU,CAAG,4BAAY,SAAA3D,KAAK,QAAIA,CAAAA,KAAK,CAAC4D,UAAN,CAAiBD,UAArB,EAAjB,CAAnB,CAEA,GAAI1C,UAAJ,CACE,MACE,8BAAC,SAAD,EAAM,UAAU,CAAC,KAAjB,CAAuB,KAAK,CAAE,QAA9B,iEACE,sCACE,OAAO,CAAE,CAACA,UADZ,CAEE,IAAI,CAAC,UAFP,CAGE,IAAI,CAAE,SAHR,CAIE,QAAQ,CAAEQ,SAJZ,iEADF,CAOE,6BAAC,aAAD,EAAU,EAAE,CAAE,GAAd,oFAPF,CADF,CAYF,GAAI,CAACf,UAAL,CAAiB,MAAO,KAAP,CAEjB,MACE,8BAAC,eAAD,kEACE,6BAAC,iBAAD,EAAU,OAAO,CAAE,CAAC,CAACiD,UAArB,CAAiC,IAAI,CAAEjD,UAAvC,CAAmD,IAAI,CAAEC,WAAzD,iEADF,CAEE,6BAAC,cAAD,EAAW,OAAO,CAAEW,QAApB,CAA8B,CAAC,CAAEuC,eAAOC,IAAxC,CAA8C,KAAK,CAAE,CAAEC,SAAS,CAAE,OAAb,CAArD,uFAFF,CADF,CAQD,CAEDC,eAAe,CAACtE,SAAhB,CAA4B,CAC1BoD,eAAe,CAAElD,mBAAUC,IADD,CAA5B,CAIA,QAASmE,CAAAA,eAAT,OAA8C,IAAnBlB,CAAAA,eAAmB,OAAnBA,eAAmB,CAC5C,MACE,8BAAC,iBAAD,EAAc,KAAK,CAAE,mBAAO,CAAP,CAArB,CAAgC,MAAM,CAAE,mBAAO,GAAP,CAAxC,iEACE,6BAAC,cAAD,EACE,CAAC,CAAEe,eAAOC,IADZ,CAEE,OAAO,CAAE,iBAAAzB,CAAC,CAAI,CACZA,CAAC,CAAC4B,cAAF,GACAnB,eAAe,GAChB,CALH,6FADF,CADF,CAaD","sourcesContent":["import React, { Fragment, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { setCreatePostState } from 'modules/createPost/createPost.actions';\nimport { text } from 'app/utils';\nimport { View, SmallText, AbsoluteView, BodyText, Box } from 'modules/styled/uni';\nimport { Input } from 'modules/styled/web';\nimport AvatarBox from 'modules/user/avatarbox.component';\nimport PostInfo from 'modules/post/postinfo.component';\nimport { colors, sizing } from 'styles';\nimport { getTextData } from 'utils/text';\nimport { useCommunity } from 'modules/community/community.selectors';\nimport { usePrevious } from 'utils/hooks';\nimport TextAreaWithMention from 'modules/text/web/textAreaWithMention';\nimport TagsInput from './tags.input';\nimport Footer from './footer';\nimport { usePreview, useCommunityAuth } from './hooks';\n\nconst PLACEHOLDER_URL = \"What's relevant?  Paste article URL.\";\nconst PLACEHOLDER_TEXT =\n  'Add your commentary, opinion, summary or a relevant quote from the article';\n\nconst MD_PLACEHOLDER =\n  'Add text or paste a url here.\\n\\nYou can use Markdown:\\n# Title\\n**bold**\\n`inline code`\\n```code block```';\n\nCreatePostContainer.propTypes = {\n  close: PropTypes.func\n};\n\nexport default function CreatePostContainer({ close }) {\n  const dispatch = useDispatch();\n  const user = useSelector(state => state.auth.user);\n  const postData = useSelector(state => state.createPost);\n  const community = useCommunity();\n  const textArea = useRef();\n\n  const authError = useCommunityAuth();\n\n  const {\n    title,\n    channel,\n    postBody,\n    urlPreview,\n    linkPreview,\n    selectedTags,\n    allTags,\n    postUrl,\n    loadingPreview,\n    postTags,\n    disableUrl\n  } = postData;\n\n  const setState = state => {\n    dispatch(\n      setCreatePostState({\n        ...postData,\n        ...state\n      })\n    );\n  };\n\n  // set our suggested topic from the community\n  useEffect(() => {\n    setState({ allTags: community.topics });\n  }, [community.topics]); // eslint-disable-line\n\n  // create url preview\n  const prevUrl = usePrevious(postUrl);\n  const createPreview = usePreview(setState);\n\n  const clearUrl = (shouldDisableUrl = true) => {\n    setState({\n      url: null,\n      postUrl: null,\n      urlPreview: null,\n      loadingPreview: false,\n      postTags: [],\n      disableUrl: shouldDisableUrl && true\n    });\n  };\n\n  useEffect(() => {\n    const shouldDisableUrl = false;\n    if (!postUrl && urlPreview) clearUrl(shouldDisableUrl);\n    else if (postUrl && prevUrl !== postUrl && !loadingPreview && !disableUrl) {\n      createPreview({ postUrl, postBody });\n    }\n  }, [postUrl]); // eslint-disable-line\n\n  const enableUrl = () => setState({ disableUrl: false });\n\n  const prevDisableUrl = usePrevious(disableUrl);\n  // process body on next tick once we enable url\n  useEffect(() => {\n    prevDisableUrl &&\n      !disableUrl &&\n      handleBodyChange({ target: { value: postBody } }) &&\n      textArea.current.focus();\n  }, [disableUrl]); // eslint-disable-line\n\n  const handleBlur = () => {\n    const { tags, mentions } = getTextData(postBody);\n    const mergedTags = [...new Set([...selectedTags, ...tags])];\n    setState({\n      mentions,\n      selectedTags: mergedTags\n    });\n  };\n\n  const handleBodyChange = e => {\n    const newBody = e.target.value;\n    // TODO this may be expensive to do on every render we can skip some of it...\n    const { url } = getTextData(newBody);\n    const newUrl = url && url.url;\n\n    // don't process url until we see a blank space or user pastes it\n    const isPaste = newBody.length > postBody + 4;\n    const doneTypingUrl = url && url.lastIndex !== newBody.length;\n    const shouldUpdateUrl = doneTypingUrl || isPaste;\n\n    const addUrlToState = !disableUrl && shouldUpdateUrl && { postUrl: newUrl };\n\n    setState({\n      postBody: newBody,\n      ...addUrlToState\n    });\n  };\n\n  const addTextFromLink = () =>\n    handleBodyChange({\n      target: { value: `${postBody}\\n>\"${text.stripHTML(urlPreview.description)}\"` }\n    });\n\n  const showPasteButton = urlPreview && urlPreview.description;\n  const placeholder = urlPreview ? PLACEHOLDER_TEXT : PLACEHOLDER_URL;\n  const renderTags = postBody || postUrl;\n\n  const suggestedTags = [...new Set([...allTags, ...postTags])];\n\n  if (authError) return authError.component;\n\n  return (\n    <View>\n      <View display=\"flex\" fdirection=\"row\" align=\"center\">\n        <AvatarBox user={user} size={4} />\n      </View>\n      {channel && (\n        <Input\n          onChange={e => setState({ title: e.target.value })}\n          value={title}\n          name=\"title\"\n          mt={2}\n          type=\"text\"\n          placeholder=\"Title\"\n        />\n      )}\n\n      <View mt={2}>\n        <TextAreaWithMention\n          value={postBody}\n          onChange={handleBodyChange}\n          placeholder={community.defaultPost === 'text' ? MD_PLACEHOLDER : placeholder}\n          withPreview\n          textArea={textArea}\n          minheight={22}\n          onBlur={handleBlur}\n          onSubmit={handleBlur}\n        />\n        {showPasteButton && <PasteTextButton addTextFromLink={addTextFromLink} />}\n      </View>\n\n      <Box mt={1} />\n      <PostPreview\n        clearUrl={clearUrl}\n        urlPreview={urlPreview}\n        linkPreview={linkPreview}\n        PostPreview={PostPreview}\n        enableUrl={enableUrl}\n        disableUrl={disableUrl}\n      />\n\n      {renderTags && (\n        <TagsInput\n          setState={setState}\n          selectedTags={selectedTags || []}\n          allTags={suggestedTags || []}\n        />\n      )}\n\n      <Footer close={close} />\n    </View>\n  );\n}\n\nPostPreview.propTypes = {\n  urlPreview: PropTypes.object,\n  linkPreview: PropTypes.object,\n  clearUrl: PropTypes.func,\n  enableUrl: PropTypes.func,\n  disableUrl: PropTypes.bool\n};\n\nfunction PostPreview({ urlPreview, linkPreview, clearUrl, disableUrl, enableUrl }) {\n  const screenSize = useSelector(state => state.navigation.screenSize);\n\n  if (disableUrl)\n    return (\n      <View fdirection=\"row\" align={'center'}>\n        <input\n          checked={!disableUrl}\n          type=\"checkbox\"\n          name={'preivew'}\n          onChange={enableUrl}\n        />\n        <BodyText ml={0.5}>Add Link Preview</BodyText>\n      </View>\n    );\n\n  if (!urlPreview) return null;\n\n  return (\n    <Fragment>\n      <PostInfo preview={!!screenSize} post={urlPreview} link={linkPreview} />\n      <SmallText onPress={clearUrl} c={colors.blue} style={{ textAlign: 'right' }}>\n        Remove Link Preview\n      </SmallText>\n    </Fragment>\n  );\n}\n\nPasteTextButton.propTypes = {\n  addTextFromLink: PropTypes.func\n};\n\nfunction PasteTextButton({ addTextFromLink }) {\n  return (\n    <AbsoluteView right={sizing(2)} bottom={sizing(3.5)}>\n      <SmallText\n        c={colors.blue}\n        onPress={e => {\n          e.preventDefault();\n          addTextFromLink();\n        }}\n      >\n        Paste article description\n      </SmallText>\n    </AbsoluteView>\n  );\n}\n"],"file":"createPost.container.js"}