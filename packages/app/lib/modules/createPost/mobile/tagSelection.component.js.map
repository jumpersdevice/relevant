{"version":3,"sources":["../../../../src/modules/createPost/mobile/tagSelection.component.js"],"names":["Input","TextInput","colors","white","layout","universalBorder","p","isFocused","blue","styles","TagSelection","props","context","createPost","bodyTags","map","tag","_id","bodyTag","tags","keywords","selectedTags","Set","state","input","inputFocused","communityTags","toggleTag","bind","inputTags","topicTags","setState","prevProps","selectedTopic","updateSelected","children","topic","main","length","filter","findIndex","t","toLowerCase","actions","setCreatePostState","allTags","words","split","word","replace","el","Alert","alert","index","indexInput","splice","push","forceUpdate","updateTags","flexDirection","processInput","c","onBlur","onFocus","grey","color","black","Keyboard","dismiss","break","Component","PropTypes","object","array","localStyles","StyleSheet","create","topicInput","height","padding","backgroundColor","borderBottomWidth","hairlineWidth","borderBottomColor","globalStyles"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { TextInput, Alert, StyleSheet, Keyboard } from 'react-native';\nimport { View } from 'modules/styled/uni';\nimport PropTypes from 'prop-types';\nimport { globalStyles } from 'app/styles/global';\nimport Tags from 'modules/tag/mobile/tags.component';\nimport styled from 'styled-components/primitives';\nimport { colors, sizing, layout } from 'app/styles';\n\nconst Input = styled(TextInput)`\n  padding: ${sizing(1.5)};\n  background-color: ${colors.white};\n  ${layout.universalBorder()}\n  ${p => (p.isFocused ? `border-color: ${colors.blue};}` : null)}\n  margin-bottom: ${sizing(2)}\n`;\n\nlet styles;\n\nclass TagSelection extends Component {\n  static propTypes = {\n    createPost: PropTypes.object,\n    actions: PropTypes.object,\n    communityTags: PropTypes.array\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      input: '',\n      inputFocused: false,\n      communityTags: []\n    };\n\n    this.toggleTag = this.toggleTag.bind(this);\n\n    this.selectedTags = [];\n    this.inputTags = [];\n    this.tags = [];\n    this.topicTags = [];\n    this.bodyTags = [];\n  }\n\n  onFocus() {\n    this.setState({ inputFocused: true });\n  }\n\n  onBlur() {\n    this.setState({ inputFocused: false });\n  }\n\n  componentDidMount() {\n    this.setState({\n      communityTags: this.props.communityTags.map(tag => ({ _id: tag }))\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.communityTags !== this.props.communityTags) {\n      this.setState({\n        communityTags: this.props.communityTags.map(tag => ({ _id: tag }))\n      });\n    }\n  }\n\n  updateTags = () => {\n    const props = this.props.createPost;\n    if (props) {\n      this.bodyTags = props.bodyTags.map(tag => ({ _id: tag, bodyTag: true }));\n      this.tags = props.keywords.map(tag => ({ _id: tag }));\n      this.selectedTags = [...new Set([...this.bodyTags, ...this.selectedTags])];\n    }\n  };\n\n  setTopicTags(selectedTopic, updateSelected) {\n    this.selectedTopic = selectedTopic;\n    if (!this.selectedTopic) return;\n    let children = this.selectedTopic.children || [];\n    children = children.map(topic => ({ _id: topic }));\n\n    let main = this.selectedTopic.main || [];\n    main = main.map(topic => ({ _id: topic }));\n    if (!main.length) main = [this.selectedTopic];\n\n    this.topicTags = [...main, ...children];\n\n    if (updateSelected) {\n      const bodyTags = this.bodyTags.filter(\n        tag => main.findIndex(t => tag._id === t._id) === -1\n      );\n      this.selectedTags = [...new Set([...main, ...bodyTags])];\n    }\n  }\n\n  processInput(input) {\n    this.setState({ input: input.toLowerCase() });\n    if (input === '') {\n      this.inputTags = [];\n      this.props.actions.setCreatePostState({\n        allTags: [...this.inputTags, ...this.selectedTags]\n      });\n    }\n    const words = input.split(' ');\n    const tags = words\n      .map(word => {\n        word = word\n          .replace('#', '')\n          .replace(/(,|\\.|!|\\?)\\s*$/, '')\n          .toLowerCase();\n        if (word === '') return null;\n        return { _id: word };\n      })\n      .filter(el => el !== null);\n    if (this.selectedTags.length + tags.length >= 7) {\n      return Alert.alert('👋 too many topics!');\n    }\n    this.inputTags = tags;\n    this.props.actions.setCreatePostState({\n      allTags: [...this.inputTags, ...this.selectedTags]\n    });\n    return null;\n  }\n\n  toggleTag(tag) {\n    const index = this.selectedTags.findIndex(t => t._id === tag);\n    const indexInput = this.inputTags.findIndex(t => t._id === tag);\n    if (tag.bodyTag) {\n      return Alert.alert(\n        'text tag',\n        'You can remove this topic by going back and editing the text'\n      );\n    }\n    if (index > -1) {\n      this.selectedTags.splice(index, 1);\n      const bodyTags = this.bodyTags.filter(t => tag !== t._id);\n      this.bodyTags = bodyTags;\n      this.props.actions.setCreatePostState({ bodyTags: bodyTags.map(t => t._id) });\n    } else if (indexInput === -1) {\n      if (this.selectedTags.length + this.inputTags.length >= 7) {\n        return Alert.alert('👋 too many topics!');\n      }\n      this.selectedTags.push({ _id: tag });\n    }\n\n    this.props.actions.setCreatePostState({\n      allTags: [...this.inputTags, ...this.selectedTags],\n      selectedTags: this.selectedTags\n    });\n    this.forceUpdate();\n    return null;\n  }\n\n  render() {\n    const { selectedTopic } = this;\n    this.updateTags();\n    const selectedTags = [...this.selectedTags, ...this.inputTags];\n    let tags = [\n      ...new Set([\n        ...this.inputTags,\n        ...this.state.communityTags,\n        ...this.tags,\n        ...this.bodyTags\n      ])\n    ];\n\n    tags = [...new Set(tags.map(t => t._id))];\n    // hide current category\n    if (selectedTopic) {\n      tags = tags.filter(tag => tag !== selectedTopic._id);\n    }\n\n    return (\n      <View p={2} pt={3} style={{ flexDirection: 'column' }}>\n        <Input\n          autoCapitalize={'none'}\n          autoCorrect={false}\n          underlineColorAndroid={'transparent'}\n          onChangeText={input => this.processInput(input)}\n          ref={c => {\n            this.input = c;\n          }}\n          onBlur={() => this.onBlur()}\n          onFocus={() => this.onFocus()}\n          value={this.state.input}\n          multiline={false}\n          isFocused={this.state.inputFocused}\n          placeholderTextColor={colors.grey}\n          style={{ color: colors.black }}\n          placeholder={'Select additional topics or create your own'}\n          onSubmitEditing={Keyboard.dismiss}\n        />\n        <View style={styles.break} />\n        <Tags toggleTag={this.toggleTag} tags={{ tags, selectedTags }} />\n        <View style={styles.break} />\n      </View>\n    );\n  }\n}\n\nconst localStyles = StyleSheet.create({\n  topicInput: {\n    height: 45,\n    padding: 10,\n    backgroundColor: 'white'\n  },\n  break: {\n    borderBottomWidth: StyleSheet.hairlineWidth,\n    borderBottomColor: '#F0F0F0'\n  }\n});\n\nstyles = { ...globalStyles, ...localStyles };\n\nexport default TagSelection;\n"],"file":"tagSelection.component.js"}