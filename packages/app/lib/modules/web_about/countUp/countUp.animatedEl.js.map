{"version":3,"sources":["../../../../src/modules/web_about/countUp/countUp.animatedEl.js"],"names":["randfloat","n","Math","random","randint","floor","CountUpMarqueeContainer","View","CountUpMarquee","index","React","createRef","Array","from","length","up","big","clearTimeout","timeout","window","removeEventListener","animate","addEventListener","props","active","firingRate","setTimeout","add","setState","parallax","speed","mode","type","onFinished","width","container","current","offsetWidth","height","offsetHeight","duration","y","elScore","modIndex","thumbs","el","elHeight","arrowTypes","arrowType","targetY","startX","tween1","tween","scale","to","update","style","transform","easing","cubic_bezier","finished","tween2","x","circ_in","tY","toFixed","forEach","join","onMeasure","pause","map","ref","i","PureComponent","PropTypes","string","bool","number","func","score"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { View } from 'modules/styled/web';\nimport styled from 'styled-components';\nimport { sizing } from 'app/styles';\nimport { tween } from 'app/utils';\n\nimport { Thumb, Arrow, Coin } from './countUp.images';\n\nconst randfloat = n => Math.random() * n;\nconst randint = n => Math.floor(Math.random() * n);\n\nconst CountUpMarqueeContainer = styled(View)`\n  flex: 1;\n  overflow: hidden;\n  max-width: ${sizing(30)};\n`;\n\n// const LeftGradient = styled(View)`\n//   background: linear-gradient(0.25turn, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));\n//   width: 80%;\n//   height: 100%;\n//   position: absolute;\n//   top: 0;\n//   left: 0;\n// `;\n\nexport default class CountUpMarquee extends PureComponent {\n  state = {\n    index: 0\n  };\n\n  static propTypes = {\n    type: PropTypes.string,\n    active: PropTypes.bool,\n    firingRate: PropTypes.number,\n    parallax: PropTypes.number,\n    speed: PropTypes.number,\n    onMeasure: PropTypes.func,\n    onFinished: PropTypes.func,\n    score: PropTypes.number,\n    mode: PropTypes.bool,\n    height: PropTypes.number\n  };\n\n  container = React.createRef();\n\n  index = 0;\n\n  thumbs = Array.from({ length: 20 }, React.createRef);\n\n  arrowTypes = Array.from({ length: 20 }, () => ({\n    up: Math.random() > 0.5,\n    big: Math.random() > 0.2\n  }));\n\n  componentDidMount() {\n    this.animate(0);\n    this.thumbs.forEach(el => {\n      el.current.style.transform = 'translate3D(' + [10, 0, 0].join('px,') + 'px)';\n    });\n    this.props.onMeasure(\n      this.container.current.offsetWidth,\n      this.container.current.offsetHeight\n    );\n    window.addEventListener('blur', this.pause);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('blur', this.pause);\n    window.removeEventListener('focus', this.animate);\n    clearTimeout(this.timeout);\n  }\n\n  pause = () => {\n    clearTimeout(this.timeout);\n    window.removeEventListener('focus', this.animate);\n    window.addEventListener('focus', this.animate);\n  };\n\n  animate = ({ index = 0 }) => {\n    const { active, firingRate } = this.props;\n    if (active) {\n      this.timeout = setTimeout(() => this.animate({ index: index + 1 }), firingRate);\n      this.add(index);\n      this.setState({ index });\n    } else {\n      this.timeout = setTimeout(() => this.animate({ index }), 100);\n    }\n  };\n\n  add = index => {\n    const { parallax, speed, mode, type, onFinished } = this.props;\n    const width = this.container.current.offsetWidth;\n    const height = this.container.current.offsetHeight;\n\n    const duration = width * speed;\n\n    let y;\n    let elScore = 1;\n\n    const modIndex = index % this.thumbs.length;\n    const el = this.thumbs[modIndex];\n    let elHeight = el.current.offsetHeight;\n    this.arrowTypes[modIndex] = {};\n    const arrowType = this.arrowTypes[modIndex];\n    let targetY;\n    let startX = 0;\n\n    switch (type) {\n      case 'relevant':\n        if (mode) {\n          arrowType.big = Math.random() < 0.7;\n          arrowType.up = arrowType.big ? Math.random() < 0.9 : Math.random() < 0.2;\n        } else {\n          arrowType.big = Math.random() < 0.3;\n          arrowType.up = arrowType.big ? Math.random() < 0.1 : Math.random() < 0.8;\n        }\n\n        elScore = arrowType.big ? randint(10) + 10 : 1;\n        if (!arrowType.up) elScore *= -1;\n\n        elHeight = arrowType.big ? 70 : 25;\n        startX = randfloat(20);\n\n        y = randint(height - elHeight);\n        targetY = arrowType.up ? 0 : height - elHeight;\n        break;\n      case 'thumb':\n        targetY = (height - elHeight) / 2;\n        y = randint(height - elHeight);\n        break;\n      default:\n        y = (height - elHeight) / 2;\n        targetY = y;\n        break;\n    }\n\n    if (!el || !el.current || !y) return;\n\n    const tween1 = () =>\n      tween.add({\n        from: { scale: 0 },\n        to: { scale: 1 },\n        duration: 200,\n        update: ({ scale }) => {\n          el.current.style.transform = `translate3D(${-width +\n            startX}px, ${y}px, 0) scale(${scale}) `;\n        },\n        easing: tween.easing.cubic_bezier(0.83, 0.42, 0, 1.24),\n        finished: () => tween2()\n      });\n\n    const tween2 = () =>\n      tween.add({\n        from: { x: -width + startX, y },\n        to: { x: 0, y: targetY },\n        duration: duration + randfloat(parallax),\n        easing: tween.easing.circ_in,\n        update: ({ x, y: tY }) => {\n          el.current.style.transform = `translate3D(${x.toFixed(1)}px, ${tY || y}px, 0)`;\n        },\n        finished: () => {\n          el.current.style.transform = `translate3D(${50}px, ${y}px, 0)`;\n          if (onFinished) onFinished(elScore);\n        }\n      });\n    tween1();\n  };\n\n  render() {\n    const { type, height } = this.props;\n    let thumbs;\n    switch (type) {\n      case 'thumb':\n        thumbs = this.thumbs.map((ref, i) => <Thumb ref={ref} key={i} />);\n        break;\n      case 'coin':\n        thumbs = this.thumbs.map((ref, i) => <Coin ref={ref} key={i} />);\n        break;\n      default:\n        thumbs = this.thumbs.map((ref, i) => (\n          <Arrow ref={ref} key={i} {...this.arrowTypes[i]} />\n        ));\n        break;\n    }\n    return (\n      <CountUpMarqueeContainer h={height} ref={this.container}>\n        {thumbs}\n        {/* <LeftGradient /> */}\n      </CountUpMarqueeContainer>\n    );\n  }\n}\n"],"file":"countUp.animatedEl.js"}