{"version":3,"sources":["../../../src/modules/web_about/post.marquee.js"],"names":["MarqueeContainer","View","BG_COLORS","colors","black","white","Marquee","cancelAnimationFrame","lastFrame","window","removeEventListener","animate","addEventListener","i","now","Date","elapsed","lastTime","x","rows","map","row","w","offsetWidth","newX","rowSpeed","rX","Math","round","style","transform","requestAnimationFrame","key","props","posts","communityState","links","topPosts","filter","post","title","color","community","communities","data","avgRank","currentShares","postCount","tick","pagerank","maxLength","toUpperCase","icon","metaPost","domain","tickerString","red","green","_id","bg","tickers","renderTicker","tickersDouble","c","actions","getTopPosts","pause","N","Array","from","keys","renderRow","Component","PropTypes","number","object","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport styled from 'styled-components';\nimport { View, Text, NumericalValue, Image } from 'modules/styled/web';\nimport { colors } from 'app/styles';\nimport { getTopPosts } from 'modules/post/post.actions';\nimport ULink from 'modules/navigation/ULink.component';\nimport { getTitle, getFavIcon, getPostUrl } from 'app/utils/post';\nimport { abbreviateNumber } from 'app/utils/numbers';\n\nconst MarqueeContainer = styled(View)`\n  white-space: nowrap;\n  width: 100vw;\n  overflow: hidden;\n  z-index: 10;\n  position: fixed;\n  top: 0;\n`;\n\nconst BG_COLORS = [colors.black, colors.white];\n\nclass Marquee extends Component {\n  static propTypes = {\n    rows: PropTypes.number,\n    actions: PropTypes.object,\n    posts: PropTypes.object,\n    communityState: PropTypes.object\n  };\n\n  static defaultProps = {\n    rows: 1\n  };\n\n  x = [];\n\n  rows = [];\n\n  componentDidMount() {\n    this.props.actions.getTopPosts();\n    this.animate();\n    window.addEventListener('blur', this.pause);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('blur', this.pause);\n    window.removeEventListener('focus', this.animate);\n    cancelAnimationFrame(this.lastFrame);\n  }\n\n  pause = () => {\n    cancelAnimationFrame(this.lastFrame);\n    window.removeEventListener('focus', this.animate);\n    window.addEventListener('focus', this.animate);\n  };\n\n  rowSpeed = i => {\n    switch (i % 3) {\n      case 0:\n        return 0.6;\n      case 1:\n        return 0.85;\n      case 2:\n        return 0.75;\n      default:\n        return 0.6;\n    }\n  };\n\n  animate = () => {\n    const now = new Date();\n    const elapsed = this.lastTime ? (now - this.lastTime) / 10 : 0;\n\n    this.x = this.rows.map((row, i) => {\n      const w = row.offsetWidth / 2;\n      let newX = (this.x[i] || i) - elapsed * this.rowSpeed(i);\n      if (newX <= -w) newX += w;\n      const rX = Math.round(newX * 1000) / 1000;\n      row.style.transform = `translate3d(${rX}px, 0, 0)`;\n      return rX;\n    });\n\n    this.lastTime = now;\n    this.lastFrame = requestAnimationFrame(this.animate);\n  };\n\n  renderTicker = (row, key) => {\n    const { posts, rows, communityState } = this.props;\n    const links = posts.topPosts.filter(post => post.title);\n\n    return links.map((post, i) => {\n      if (i % rows !== row) return null;\n      const color = BG_COLORS[(row + 1) % 2];\n      const community = communityState.communities[post.data.community];\n      if (!community) return null;\n      const avgRank = community.currentShares / community.postCount;\n      const tick = post.data.pagerank - avgRank;\n      const title = getTitle({ post, maxLength: 60 }).toUpperCase();\n      const icon = getFavIcon(post.metaPost.domain);\n\n      const tickerString = (\n        <React.Fragment>\n          <Image bg={colors.white} w={2} h={2} mr={1} src={icon} resizeMode={'contain'} />\n          <Text mr={0.5} c={color}>\n            {title}\n          </Text>\n          <Text mr={0.5} c={tick < 0 ? colors.red : colors.green}>\n            {tick >= 0 ? '▲' : '▼'}\n          </Text>\n          <Text c={color}>{abbreviateNumber(tick)}%</Text>\n        </React.Fragment>\n      );\n\n      return (\n        <ULink\n          m={'1 4'}\n          key={`${post._id}${key}`}\n          to={getPostUrl(post.data.community, post)}\n        >\n          <NumericalValue>{tickerString}</NumericalValue>\n        </ULink>\n      );\n    });\n  };\n\n  renderRow = row => {\n    const bg = BG_COLORS[row % 2];\n\n    const tickers = this.renderTicker(row, 1);\n    const tickersDouble = this.renderTicker(row, 2);\n\n    return (\n      <View fdirection=\"row\" flex={1} bg={bg} key={`row${row}`}>\n        <Text ref={c => (this.rows[row] = c)}>\n          {tickers}\n          {tickersDouble}\n        </Text>\n      </View>\n    );\n  };\n\n  render() {\n    const { rows: N } = this.props;\n    const rows = Array.from(Array(N).keys());\n    return (\n      <MarqueeContainer fdirection=\"column\">{rows.map(this.renderRow)}</MarqueeContainer>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    posts: state.posts,\n    communityState: state.community\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        getTopPosts\n      },\n      dispatch\n    )\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Marquee);\n"],"file":"post.marquee.js"}