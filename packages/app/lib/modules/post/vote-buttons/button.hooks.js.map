{"version":3,"sources":["../../../../src/modules/post/vote-buttons/button.hooks.js"],"names":["alert","Analytics","ReactGA","process","env","WEB","require","analytics","default","useCastVote","post","user","canBet","dispatch","processingVote","setProcessingVote","displayBetPrompt","hasAuth","e","vote","amount","preventDefault","stopPropagation","type","isManualBet","showBetModal","postId","_id","res","undoInvest","runAnalytics","message","useVoteAnimation","investButton","horizontal","newVote","state","investments","voteSuccess","rankChange","computeRankChange","el","params","stakedTokens","setTimeout","startRank","data","pagerank","total","Math","round","logEvent","event","category","action"],"mappings":"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","sourcesContent":["import { useState, useCallback, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Alert } from 'app/utils/alert';\nimport { showModal } from 'modules/navigation/navigation.actions';\nimport { useAuth } from 'modules/auth/hooks';\nimport launchAnimation from './launchAnimation';\nimport { vote as voteAction, updatePostVote } from '../invest.actions';\n\nconst { alert } = Alert();\n\nlet Analytics;\nlet ReactGA;\nif (process.env.WEB !== 'true') {\n  Analytics = require('react-native-firebase').analytics();\n} else {\n  ReactGA = require('react-ga').default;\n}\n\nexport function useCastVote({\n  post,\n  user,\n  canBet\n  // community\n}) {\n  const dispatch = useDispatch();\n  const [processingVote, setProcessingVote] = useState(false);\n  // const displayBetPrompt = showBetPrompt({ post, community, user });\n  const displayBetPrompt = false;\n  const hasAuth = useAuth();\n\n  return useCallback(\n    async (e, vote, amount) => {\n      try {\n        e.preventDefault();\n        e.stopPropagation();\n        if (processingVote) return;\n\n        if (!hasAuth()) return;\n\n        const type = amount > 0 ? 'upvote' : 'downvote';\n\n        if (vote && vote.isManualBet && type === 'upvote' && canBet) {\n          showBetModal({ dispatch, postId: post._id });\n          return;\n        }\n\n        setProcessingVote(true);\n        const res = await dispatch(\n          voteAction({ amount, post, user, vote, displayBetPrompt })\n        );\n        setProcessingVote(false);\n        if (!res || res.undoInvest) return;\n\n        type === 'upvote' && canBet && showBetModal({ dispatch, postId: post._id });\n        runAnalytics(type);\n      } catch (err) {\n        setProcessingVote(false);\n        alert(err.message);\n      }\n    },\n    [processingVote, hasAuth, dispatch, post, user, displayBetPrompt, canBet]\n  );\n}\n\nexport function useVoteAnimation({ post, investButton, horizontal }) {\n  const dispatch = useDispatch();\n  const newVote = useSelector(state => state.investments.voteSuccess);\n\n  useEffect(() => {\n    if (!newVote || !newVote._id) return;\n    const postId = newVote.post._id || newVote.post;\n    if (postId !== post._id) return;\n\n    const rankChange = computeRankChange({ post, rankChange: newVote.rankChange });\n    const type = newVote.amount >= 0 ? 'upvote' : 'downvote';\n\n    const el = investButton;\n    const params = { amount: rankChange, horizontal };\n    if (newVote.isManualBet && newVote.stakedTokens > 0) {\n      params.amount = 0;\n      launchAnimation({ type: 'bet', params, el, dispatch });\n    } else {\n      launchAnimation({ type, params, el, dispatch });\n    }\n    // clear new vote\n    dispatch(updatePostVote());\n  }, [newVote]); // eslint-disable-line\n}\n\n// function showBetPrompt({ post, community, user }) {\n//   if (!post) return false;\n//   const now = new Date();\n//   const bettingEnabled = community && community.betEnabled;\n//   const manualBet = user && user.notificationSettings.bet.manual;\n//   return (\n//     !manualBet &&\n//     bettingEnabled &&\n//     post.data &&\n//     post.data.eligibleForReward &&\n//     now.getTime() < new Date(post.data.payoutTime).getTime()\n//   );\n// }\n\nfunction showBetModal({ dispatch, postId }) {\n  setTimeout(() => dispatch(showModal('investModal', { postId })), 1000);\n}\n\nfunction computeRankChange({ post, rankChange }) {\n  const startRank = post.data ? post.data.pagerank : 0;\n  const total = startRank + rankChange + 1;\n  return Math.round(total) - Math.round(startRank);\n}\n\nfunction runAnalytics(type) {\n  Analytics && Analytics.logEvent(type);\n  ReactGA &&\n    ReactGA.event({\n      category: 'User',\n      action: `${type}ed a post`\n    });\n}\n"],"file":"button.hooks.js"}