{"version":3,"sources":["../../../../src/modules/post/mobile/singlePost.component.js"],"names":["INPUT_OFFSET","IphoneX","SinglePostComponent","props","setTimeout","params","navigation","state","comment","comments","length","id","_id","index","findIndex","c","scrollToComment","openComment","input","textInput","focus","forceUpdate","postId","nestingLevel","posts","children","childComments","forEach","push","getChildren","inputHeight","editing","reloading","top","suggestionHeight","loaded","gotData","renderRow","bind","dataSource","loadMoreComments","longFormat","total","renderHeader","toggleEditing","reload","scrollToBottom","renderUserSuggestions","renderRelated","requestAnimationFrame","setState","activeComment","prev","post","scrollView","onLoad","clearTimeout","stateTimeout","actions","getComments","scrollToIndex","viewPosition","activeIndex","scrollToOffset","offset","scrollTimeout","scrollToEnd","Math","max","headerHeight","scrollHeight","getSelectedPost","relatedEl","related","map","r","commentary","title","paddingHorizontal","goToPost","domain","link","e","nativeEvent","layout","height","item","auth","users","setupReply","_comment","focusInput","user","embeddedUser","parentEl","search","position","left","right","flex","maxHeight","backgroundColor","borderTopWidth","borderTopColor","paddingTop","setMention","commentIndex","Platform","OS","StatusBar","currentHeight","i","Keyboard","dismiss","handle","scrollToTop","Component","PropTypes","string","postComments","array","object","error","bool","admin"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {\n  RefreshControl,\n  KeyboardAvoidingView,\n  Platform,\n  StatusBar,\n  FlatList,\n  Keyboard\n} from 'react-native';\nimport PropTypes from 'prop-types';\nimport { IphoneX } from 'app/styles/global';\nimport Comment from 'modules/comment/mobile/comment.component';\nimport CommentInput from 'modules/comment/mobile/commentInput.component';\nimport UserSearchComponent from 'modules/createPost/mobile/userSearch.component';\nimport UrlPreview from 'modules/createPost/mobile/urlPreview.component';\nimport { View, MobileDivider, Divider } from 'modules/styled/uni';\nimport ButtonContainer from 'modules/post/mobile/postButtons.container';\nimport Post from './post.component';\n\nconst INPUT_OFFSET = IphoneX ? 33 + 55 : 55;\n\nclass SinglePostComponent extends Component {\n  static propTypes = {\n    postId: PropTypes.string,\n    postComments: PropTypes.array,\n    posts: PropTypes.object,\n    post: PropTypes.object,\n    error: PropTypes.bool,\n    actions: PropTypes.object,\n    related: PropTypes.array,\n    link: PropTypes.object,\n    users: PropTypes.object,\n    comments: PropTypes.object,\n    navigation: PropTypes.object,\n    auth: PropTypes.object,\n    admin: PropTypes.object,\n    comment: PropTypes.object\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      inputHeight: 0,\n      editing: false,\n      reloading: false,\n      top: 0,\n      suggestionHeight: 0,\n      loaded: false,\n      gotData: false\n    };\n    this.id = null;\n    this.comments = null;\n    this.renderRow = this.renderRow.bind(this);\n    this.dataSource = null;\n    this.loadMoreComments = this.loadMoreComments.bind(this);\n    this.longFormat = false;\n    this.total = null;\n    this.renderHeader = this.renderHeader.bind(this);\n    this.toggleEditing = this.toggleEditing.bind(this);\n    this.reload = this.reload.bind(this);\n    this.scrollToComment = this.scrollToComment.bind(this);\n    this.scrollToBottom = this.scrollToBottom.bind(this);\n    this.renderUserSuggestions = this.renderUserSuggestions.bind(this);\n    this.renderRelated = this.renderRelated.bind(this);\n  }\n\n  comments = [];\n\n  nestingLevel = {};\n\n  componentDidMount() {\n    const { params } = this.props.navigation.state;\n    this.id = this.props.postId;\n    this.getChildren(this.id);\n\n    requestAnimationFrame(() => {\n      this.setState({ loaded: true });\n    });\n\n    if (params.comment) {\n      this.setState({ activeComment: params.comment });\n    }\n  }\n\n  onLoad = () => {\n    setTimeout(() => {\n      const { params } = this.props.navigation.state;\n      if (params.comment && this.comments.length) {\n        const id = params.comment._id || params.comment;\n        const index = this.comments.findIndex(c => c && id === c._id);\n        this.scrollToComment(index);\n      }\n      if (params && params.openComment) {\n        this.input.textInput.focus();\n      }\n      this.forceUpdate();\n    }, 1000);\n  };\n\n  getChildren = (id = this.props.postId, nestingLevel = 0) => {\n    if (nestingLevel === 0) this.comments = [];\n    const { comments, posts } = this.props;\n    const children = comments.childComments[id] || [];\n    children.forEach(c => {\n      this.nestingLevel[c] = nestingLevel;\n      this.comments.push(posts.posts[c]);\n      this.getChildren(c, nestingLevel + 1);\n    });\n  };\n\n  componentDidUpdate(prev) {\n    const { post } = this.props;\n    if (this.comments.length && !this.state.gotData && this.scrollView) {\n      this.onLoad();\n      this.setState({ gotData: true });\n    }\n\n    if (post !== prev.post) {\n      clearTimeout(this.stateTimeout);\n      this.stateTimeout = setTimeout(() => this.setState({ reloading: false }), 1000);\n    }\n  }\n\n  loadMoreComments() {\n    let length = 0;\n    if (this.comments) {\n      length = this.comments.length || 0;\n    }\n    this.props.actions.getComments(this.id, length, 10);\n  }\n\n  toggleEditing(editing) {\n    this.setState({ editing });\n  }\n\n  scrollToComment(index) {\n    if (typeof index !== 'number' || index < 0 || !this.scrollView) return;\n    this.scrollView.scrollToIndex({ viewPosition: 0.1, index });\n    this.setState({ activeComment: this.comments[index], activeIndex: index });\n  }\n\n  scrollToTop() {\n    if (!this.scrollView) return;\n    this.scrollView.scrollToOffset({ offset: 0 });\n  }\n\n  scrollToBottom() {\n    if (!this.scrollView) return;\n    this.scrollTimeout = setTimeout(() => {\n      if (!this.scrollView) return;\n      if (this.comments && this.comments.length) {\n        this.scrollView.scrollToEnd();\n      } else if (!this.comments || this.comments.length === 0) {\n        const offset = Math.max(0, this.headerHeight - this.scrollHeight);\n        this.scrollView.scrollToOffset({ offset });\n      }\n    }, 60);\n  }\n\n  reloadComments() {\n    this.props.actions.getComments(this.id, 0, 10);\n  }\n\n  reload() {\n    this.reloading = true;\n    this.props.actions.getComments(this.id, 0, 10);\n    this.props.actions.getSelectedPost(this.id);\n  }\n\n  renderRelated() {\n    const relatedEl = this.props.related.map(r => {\n      const post = { _id: r.commentary[0], title: r.title };\n      return (\n        <View key={r._id} style={{ paddingHorizontal: 15 }}>\n          <UrlPreview\n            size={'small'}\n            urlPreview={r}\n            onPress={() => this.props.actions.goToPost(post)}\n            domain={r.domain}\n            actions={this.props.actions}\n          />\n        </View>\n      );\n    });\n    return relatedEl;\n  }\n\n  renderHeader() {\n    const { post, link, actions } = this.props;\n    return (\n      <View\n        onLayout={e => {\n          this.headerHeight = e.nativeEvent.layout.height;\n        }}\n      >\n        <Post\n          singlePost\n          key={0}\n          post={post}\n          link={link}\n          actions={actions}\n          focusInput={() => {\n            this.setState({ activeComment: post });\n            this.input.textInput.focus();\n          }}\n        />\n        {this.renderRelated()}\n\n        {/* link && <TouchableOpacity onPress={this.repostUrl} style={{\n          height: 54,\n          alignItems: 'center',\n          paddingHorizontal: 16,\n          flexDirection: 'row'\n        }}>\n          <Avatar user={auth.user} />\n          <Text style={{ color: greyText, marginLeft: 8 }}>Add your comment...</Text>\n        </TouchableOpacity>\n        */}\n      </View>\n    );\n  }\n\n  renderRow({ item, index }) {\n    if (!this.state.loaded) return null;\n    const comment = item;\n    if (!comment) return null;\n\n    const { post, auth, actions, users } = this.props;\n\n    const setupReply = _comment =>\n      this.setState({ activeComment: _comment, activeIndex: index });\n\n    const focusInput = () => this.input.textInput.focus();\n\n    const user = users.users[comment.user] || comment.embeddedUser;\n    const nestingLevel = this.nestingLevel[comment._id];\n\n    return (\n      <View fdirection={'column'}>\n        {nestingLevel ? (\n          <View ml={nestingLevel * 3 - 1} mr={2}>\n            <Divider />\n          </View>\n        ) : (\n          <MobileDivider />\n        )}\n        <Comment\n          singlePost\n          actions={actions}\n          auth={auth}\n          parentEditing={this.toggleEditing}\n          scrollToComment={() => this.scrollToComment(index)}\n          comment={comment}\n          nestingLevel={nestingLevel}\n          user={user}\n          renderButtons={() => (\n            <View m={'2 0'}>\n              <ButtonContainer\n                horizontal\n                isComment\n                parentPost={post}\n                post={comment}\n                actions={actions}\n                auth={auth}\n                singlePost\n                setupReply={setupReply}\n                focusInput={focusInput}\n              />\n            </View>\n          )}\n        />\n      </View>\n    );\n  }\n\n  renderUserSuggestions() {\n    let parentEl = null;\n    if (this.props.users.search) {\n      if (this.props.users.search.length) {\n        parentEl = (\n          <View\n            style={{\n              position: 'absolute',\n              top: this.state.top - this.state.suggestionHeight,\n              left: 0,\n              right: 0,\n              flex: 1,\n              maxHeight: this.state.top,\n              backgroundColor: 'white',\n              borderTopWidth: 1,\n              borderTopColor: '#F0F0F0'\n            }}\n            onLayout={e => {\n              this.setState({ suggestionHeight: e.nativeEvent.layout.height });\n            }}\n          >\n            <UserSearchComponent\n              style={{ paddingTop: INPUT_OFFSET }}\n              setSelected={this.input.setMention}\n              users={this.props.users.search}\n            />\n          </View>\n        );\n      }\n    }\n    return parentEl;\n  }\n\n  render() {\n    const { post } = this.props;\n    if (!post) return null;\n    const { editing } = this.state;\n    let { activeComment } = this.state;\n\n    // TODO this is hacky;\n    this.getChildren();\n\n    let commentIndex =\n      activeComment && this.comments.findIndex(c => c && c._id === activeComment._id);\n\n    if (activeComment && activeComment._id === post._id) {\n      commentIndex = -1;\n    } else {\n      commentIndex = commentIndex > -1 ? commentIndex : this.comments.length - 1;\n      activeComment = this.comments[commentIndex];\n    }\n\n    return (\n      <KeyboardAvoidingView\n        behavior={'padding'}\n        style={{ flex: 1, backgroundColor: 'white' }}\n        keyboardVerticalOffset={\n          INPUT_OFFSET + (Platform.OS === 'android' ? StatusBar.currentHeight : 0)\n        }\n      >\n        <FlatList\n          ref={c => (this.scrollView = c)}\n          data={this.comments}\n          renderItem={this.renderRow}\n          keyExtractor={(item, i) => {\n            return item ? item._id : 'x' + i;\n          }}\n          removeClippedSubviews\n          pageSize={1}\n          initialListSize={4}\n          keyboardShouldPersistTaps={'always'}\n          keyboardDismissMode={'interactive'}\n          onScrollBeginDrag={Keyboard.dismiss}\n          onEndReachedThreshold={100}\n          overScrollMode={'always'}\n          scrollToOverflowEnabled={true}\n          style={{ flex: 1 }}\n          ListHeaderComponent={this.renderHeader}\n          onScrollToIndexFailed={() => {}}\n          onLayout={e => {\n            this.scrollHeight = e.nativeEvent.layout.height;\n          }}\n          refreshControl={\n            <RefreshControl\n              refreshing={this.state.reloading}\n              onRefresh={this.reload}\n              tintColor=\"#000000\"\n              colors={['#000000', '#000000', '#000000']}\n              progressBackgroundColor=\"#ffffff\"\n            />\n          }\n        />\n\n        {this.renderUserSuggestions()}\n\n        <CommentInput\n          position=\"fixed\"\n          parentPost={post}\n          parentComment={activeComment}\n          ref={c => (this.input = c)}\n          postId={this.id}\n          placeholder={\n            activeComment ? `Reply to @${activeComment.embeddedUser.handle}` : null\n          }\n          editing={editing}\n          {...this.props}\n          scrollView={this.scrollView}\n          scrollToBottom={this.scrollToBottom}\n          updatePosition={params => this.setState(params)}\n          onBlur={() => this.setState({ comment: null, index: null })}\n          onFocus={() => {\n            if (commentIndex > -1) this.scrollToComment(commentIndex);\n            else this.scrollToTop();\n          }}\n        />\n      </KeyboardAvoidingView>\n    );\n  }\n}\n\nexport default SinglePostComponent;\n"],"file":"singlePost.component.js"}