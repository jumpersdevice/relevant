{"version":3,"sources":["../../../../src/modules/post/bet/bet.js"],"names":["BetContainer","props","user","state","auth","post","posts","navigation","modalData","postId","Bet","propTypes","PropTypes","object","close","func","dispatch","earning","earnings","pending","map","e","entities","find","ee","_id","processingBet","setProcessingBet","title","totalBalance","balance","tokenBalance","maxBet","lockedTokens","defaultAmount","Math","max","VOTE_COST_RATIO","amount","setAmount","data","payoutTime","time","setTimer","id","setInterval","clearInterval","plusAmount","a","largeStep","smallStep","err","min","minusAmount","placeBet","stakedTokens","exchageUrl","power","tooltipData","text","colors","black","blue","lightBorder"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useSelector, useDispatch } from 'react-redux';\nimport {\n  View,\n  HoverButton,\n  SecondaryText,\n  SmallText,\n  Header\n  // Divider\n} from 'modules/styled/uni';\nimport { timeLeftTick, abbreviateNumber as toFixed } from 'utils/numbers';\nimport { colors } from 'styles';\nimport { VOTE_COST_RATIO } from '@r3l/common';\nimport CoinStat from 'modules/stats/coinStat.component';\nimport { bet } from 'modules/post/invest.actions';\nimport { goToUrl } from 'modules/navigation/navigation.actions';\nimport Tooltip from 'modules/tooltip/tooltip.component';\nimport { exchangeLink, tokenEnabled } from 'modules/wallet/price.context';\nimport ULink from 'modules/navigation/ULink.component';\n// import { NotificationToggle } from 'modules/profile/settings/settings.toggle';\nimport BetStats from './betstats';\nimport CircleButton from './circlebutton';\nimport SmallCoinStat from './smallcoinstat';\n\nexport function BetContainer({ ...props }) {\n  const user = useSelector(state => state.auth.user) || {};\n  const post = useSelector(state => state.posts.posts[state.navigation.modalData.postId]);\n  if (!user || !post) return null;\n  return <Bet user={user} post={post} {...props} />;\n}\n\nBet.propTypes = {\n  user: PropTypes.object,\n  post: PropTypes.object,\n  close: PropTypes.func\n};\n\nfunction Bet({ user, post, close }) {\n  const dispatch = useDispatch();\n  const earning = useSelector(state =>\n    state.earnings.pending\n      .map(e => state.earnings.entities[e])\n      .find(ee => ee.post === post._id)\n  );\n  const [processingBet, setProcessingBet] = useState(false);\n\n  const title = earning ? 'Increase Your Bet' : 'Bet on the Relevance of this Post';\n\n  const totalBalance = user.balance + user.tokenBalance;\n  const maxBet = totalBalance - user.lockedTokens;\n  const defaultAmount = Math.max(maxBet * VOTE_COST_RATIO, 0);\n  const [amount, setAmount] = useState(defaultAmount);\n\n  // const time = getTimestamp(post.data.payoutTime).toLowerCase();\n  const [time, setTimer] = useState(timeLeftTick(post.data.payoutTime));\n\n  useEffect(() => {\n    const id = setInterval(() => setTimer(timeLeftTick(post.data.payoutTime)), 1000);\n    return () => clearInterval(id);\n  }, [post.data.payoutTime, time]);\n\n  if (!user || !post) return null;\n\n  const plusAmount = () =>\n    setAmount(a => {\n      const largeStep = (maxBet - defaultAmount) / 5;\n      const smallStep = defaultAmount / 5;\n      const err = defaultAmount / 100;\n      return a + smallStep <= defaultAmount + err\n        ? a + smallStep\n        : Math.min(a + largeStep, maxBet);\n    });\n\n  const minusAmount = () =>\n    setAmount(a => {\n      const largeStep = (totalBalance - user.lockedTokens - defaultAmount) / 5;\n      const smallStep = defaultAmount / 5;\n      const err = defaultAmount / 100;\n      if (a - smallStep <= 0 + err) return a;\n      return a - largeStep >= defaultAmount - err\n        ? a - largeStep\n        : Math.max(0, a - smallStep);\n    });\n\n  const placeBet = async () => {\n    try {\n      setProcessingBet(true);\n      await dispatch(bet({ postId: post._id, stakedTokens: amount }));\n      setProcessingBet(false);\n      close();\n    } catch (err) {\n      setProcessingBet(false);\n      // console.log(err);\n    }\n  };\n\n  const exchageUrl = exchangeLink();\n\n  const power = (100 * amount) / maxBet;\n\n  const tooltipData = {\n    text:\n      'Posts that get upvoted by lots of users with high Reputation get payouts.\\n\\nBet more coins and bet early in order to win the biggest portion of the payout.'\n  };\n\n  // const renderNoCoin = () => (\n  //   <Overlay flex={1} align={'center'} justify={'center'} bc={'hsla(0,0%, 100%, .9)'}>\n  //     <BodyText>You don't have any Relevant Coins</BodyText>\n  //     <BodyText mt={2}>\n  //       You can get some{' '}\n  //       <ULink to={exchangeLink()} external target=\"_blank\">\n  //         here\n  //       </ULink>\n  //     </BodyText>\n  //   </Overlay>\n  // );\n\n  return (\n    <View>\n      <Header inline={1} mr={2}>\n        {title} <Tooltip inline={1} name={'betInfo'} data={tooltipData} info />\n      </Header>\n\n      <View fdirection={'row'} align={'baseline'}>\n        <SmallText mt={1} mr={1}>\n          Time until payout: {time}\n        </SmallText>\n      </View>\n\n      <View mt={4} fdirection=\"row\" justify=\"space-between\" align={'center'}>\n        <CircleButton onPress={minusAmount}>–</CircleButton>\n        <View pr={1}>\n          <CoinStat\n            align={'center'}\n            fs={4.5}\n            lh={4.5}\n            spaceBetween={1}\n            c={colors.black}\n            amount={amount}\n          />\n        </View>\n        <CircleButton onPress={plusAmount}>+</CircleButton>\n      </View>\n      <View mt={2}>\n        <View h={0.5} fdirection={'row'}>\n          <View w={`${power}%`} bg={colors.blue} />\n          <View w={`${100 - power}%`} bg={colors.lightBorder} />\n        </View>\n        <View fdirection=\"row\" justify=\"space-between\">\n          <SecondaryText mt={0.5}>\n            Available Coins: <SmallCoinStat amount={maxBet - amount} />\n          </SecondaryText>\n          {tokenEnabled() && (\n            <ULink inline={1} to={exchageUrl} external target=\"_blank\">\n              <SecondaryText\n                mt={0.5}\n                c={colors.blue}\n                onPress={() => {\n                  dispatch(goToUrl(exchageUrl));\n                }}\n              >\n                Get more coins\n              </SecondaryText>\n            </ULink>\n          )}\n        </View>\n      </View>\n\n      <View mt={3}>\n        <BetStats maxBet={maxBet} post={post} amount={amount} earning={earning} />\n      </View>\n\n      <HoverButton mt={3} onPress={placeBet} disabled={processingBet || !amount}>\n        Bet {toFixed(amount)} Coins\n      </HoverButton>\n\n      {/*      <Divider mt={2} />\n       */}\n\n      <SmallText mt={2}>\n        *You always get your coins back once the betting round ends.\n      </SmallText>\n\n      {/*      <NotificationToggle\n        notification={user.notificationSettings.bet.manual}\n        parent={'bet'}\n        label={'manual'}\n        togglePosition={'right'}\n        DescriptionComponent={SmallText}\n        text={{\n          description: \"Don't like betting? Disable manual bet mode.\"\n        }}\n      /> */}\n    </View>\n  );\n}\n\nexport default BetContainer;\n"],"file":"bet.js"}