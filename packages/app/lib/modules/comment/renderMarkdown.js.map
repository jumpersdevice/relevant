{"version":3,"sources":["../../../src/modules/comment/renderMarkdown.js"],"names":["MarkdownNative","ReactMarkdown","process","env","WEB","require","default","MD","propTypes","markdown","PropTypes","string","noLink","bool","className","processNativeLink","useNativeLink","MarkdownLink","getMDLink","RENDERERS","link","linkReference","isNative","nativeStyles","dispatch","url","test","replace","href","children","node","onPress","func","rest","regex","isAbsolute","e","preventDefault","stopPropagation"],"mappings":"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","sourcesContent":["import React, { useCallback, memo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { isNative } from 'app/styles';\nimport { goToProfile, goToUrl, goToTopic } from 'modules/navigation/navigation.actions';\nimport ULink from 'modules/navigation/ULink.component';\nimport nativeStyles from 'styles/markdown.native';\n\nlet MarkdownNative;\nlet ReactMarkdown;\n\nif (process.env.WEB === 'true') {\n  ReactMarkdown = require('react-markdown');\n} else {\n  MarkdownNative = require('react-native-markdown-display').default;\n}\n\nMD.propTypes = {\n  markdown: PropTypes.string,\n  noLink: PropTypes.bool,\n  className: PropTypes.string\n};\n\nexport default function MD({ markdown, noLink, className }) {\n  const processNativeLink = useNativeLink(noLink);\n  const MarkdownLink = getMDLink(noLink);\n  const RENDERERS = {\n    link: MarkdownLink,\n    linkReference: MarkdownLink\n  };\n\n  return isNative ? (\n    <MarkdownNative\n      mergeStyle={true}\n      onLinkPress={processNativeLink}\n      style={nativeStyles}\n    >\n      {markdown}\n    </MarkdownNative>\n  ) : (\n    <ReactMarkdown renderers={RENDERERS} className={className} source={markdown} />\n  );\n}\n\nfunction useNativeLink(noLink) {\n  const dispatch = useDispatch();\n  return useCallback(\n    url => {\n      if (noLink) return null;\n      switch (true) {\n        case url === '':\n          return true;\n        case /__user_profile__/.test(url):\n          return dispatch(goToProfile(url.replace('__user_profile__', '')));\n        case /__tag_link__/.test(url):\n          return dispatch(goToTopic(url.replace('__tag_link__', '')));\n        default:\n          return dispatch(goToUrl(url));\n      }\n    },\n    [dispatch, noLink]\n  );\n}\n\nfunction getMDLink(noLink) {\n  MarkdownLink.propTypes = {\n    href: PropTypes.string,\n    children: PropTypes.node,\n    onPress: PropTypes.func\n  };\n  function MarkdownLink({ href, children, onPress, ...rest }) {\n    if (href === '') return children;\n    const regex = /^(https?|file|ftps?|mailto|javascript|data:image\\/[^;]{2,9};):/i;\n    const isAbsolute = regex.test(href);\n    return (\n      <ULink\n        to={href}\n        {...rest}\n        children={children}\n        onClick={e => (noLink ? e.preventDefault() : e.stopPropagation())}\n        onPress={e => (noLink ? e.preventDefault() : onPress(e))}\n        external={isAbsolute}\n        target={isAbsolute ? '_blank' : null}\n      />\n    );\n  }\n  return memo(MarkdownLink);\n}\n"],"file":"renderMarkdown.js"}