{"version":3,"sources":["../../../../src/modules/comment/mobile/comment.component.js"],"names":["ActionSheet","ActionSheetIOS","Platform","OS","RNBottomSheet","showActionSheetWithOptions","showBottomSheetWithOptions","Comment","props","context","state","buttons","destructiveIndex","cancelIndex","editedText","editing","height","deleteComment","bind","showActionSheet","editComment","saveEdit","body","comment","setState","words","textUtil","getWords","mentions","getMentions","originalText","actions","updateComment","then","results","Alert","alert","options","cancelButtonIndex","destructiveButtonIndex","buttonIndex","nextProps","nextState","parentEditing","_id","scrollToComment","auth","nestingLevel","renderButtons","user","singlePost","preview","editingEl","color","colors","black","fontSize","lineHeight","e","h","nativeEvent","contentSize","textBody","c","singleComment","require","Component","PropTypes","object","func","bool","number"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { ActionSheetIOS, Platform, Alert } from 'react-native';\nimport PropTypes from 'prop-types';\nimport RNBottomSheet from 'react-native-bottomsheet';\nimport TextEdit from 'modules/text/mobile/textEdit.component';\nimport { text as textUtil } from 'app/utils';\nimport CommentBody from 'modules/comment/commentBody';\nimport { colors } from 'styles';\n\nimport PostInfo from 'modules/post/mobile/postInfo.component';\nimport { View, Image, Box } from 'modules/styled/uni';\n\nlet ActionSheet = ActionSheetIOS;\n\nif (Platform.OS === 'android') {\n  ActionSheet = RNBottomSheet;\n  ActionSheet.showActionSheetWithOptions = RNBottomSheet.showBottomSheetWithOptions;\n}\n\nclass Comment extends Component {\n  static propTypes = {\n    comment: PropTypes.object,\n    actions: PropTypes.object,\n    parentEditing: PropTypes.func,\n    scrollToComment: PropTypes.func,\n    auth: PropTypes.object,\n    singlePost: PropTypes.bool,\n    user: PropTypes.object,\n    nestingLevel: PropTypes.number,\n    renderButtons: PropTypes.func,\n    preview: PropTypes.bool\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      buttons: ['Edit', 'Delete', 'Cancel'],\n      destructiveIndex: 1,\n      cancelIndex: 2,\n      editedText: null,\n      editing: false,\n      height: 0\n    };\n    this.deleteComment = this.deleteComment.bind(this);\n    this.showActionSheet = this.showActionSheet.bind(this);\n    this.editComment = this.editComment.bind(this);\n    this.saveEdit = this.saveEdit.bind(this);\n  }\n\n  componentDidMount() {\n    const { body } = this.props.comment;\n    if (body) this.setState({ editedText: body });\n  }\n\n  saveEdit(body) {\n    const { comment } = this.props;\n    if (comment.body === body) return this.editComment();\n    const words = textUtil.getWords(body);\n    const mentions = textUtil.getMentions(words);\n    const originalText = comment.body;\n    comment.body = body;\n    comment.mentions = mentions;\n    this.setState({ editing: false, editedText: body });\n    return this.props.actions.updateComment(comment).then(results => {\n      if (results) {\n        this.setState({ editedText: null });\n        Alert.alert('Comment updated');\n      } else {\n        comment.body = originalText;\n        this.setState({ editing: true });\n      }\n    });\n  }\n\n  showActionSheet() {\n    ActionSheet.showActionSheetWithOptions(\n      {\n        options: this.state.buttons,\n        cancelButtonIndex: this.state.cancelIndex,\n        destructiveButtonIndex: this.state.destructiveIndex\n      },\n      buttonIndex => {\n        switch (buttonIndex) {\n          case 0:\n            this.editComment();\n            break;\n          case 1:\n            this.deleteComment();\n            break;\n          default:\n        }\n      }\n    );\n  }\n\n  componentWillUpdate(nextProps, nextState) {\n    if (nextState.editing !== this.state.editing) {\n      this.props.parentEditing(nextState.editing);\n    }\n  }\n\n  deleteComment() {\n    this.props.actions.deleteComment(this.props.comment._id);\n  }\n\n  editComment() {\n    if (!this.state.editing) {\n      this.props.scrollToComment();\n    }\n    this.setState({\n      editedText: this.props.comment.body,\n      editing: !this.state.editing\n    });\n  }\n\n  render() {\n    const {\n      comment,\n      auth,\n      nestingLevel,\n      renderButtons,\n      user,\n      actions,\n      singlePost,\n      preview\n    } = this.props;\n\n    if (!comment) return null;\n    const { editing } = this.state;\n\n    const editingEl = editing && (\n      <TextEdit\n        style={{ color: colors.black, fontSize: 16, lineHeight: 22 }}\n        text={this.state.editedText || comment.body}\n        toggleFunction={this.editComment}\n        saveEditFunction={this.saveEdit}\n        onChange={e => {\n          const h = e.nativeEvent.contentSize.height;\n          if (h !== this.height) {\n            this.height = h;\n          }\n        }}\n      />\n    );\n\n    const textBody = <CommentBody preview={preview} comment={comment} />;\n\n    return (\n      <View\n        ref={c => {\n          this.singleComment = c;\n        }}\n        onLayout={() => null}\n        mr={2}\n        mb={2}\n        ml={nestingLevel ? 2 + nestingLevel * 3 - 3 : 2}\n        fdirection={'row'}\n      >\n        {nestingLevel ? (\n          <Image\n            h={2}\n            w={2}\n            mt={5}\n            mr={1}\n            resizeMode={'contain'}\n            source={require('public/img/reply.png')}\n          />\n        ) : null}\n        <View flex={1}>\n          <Box mt={2} />\n          <PostInfo\n            post={comment}\n            actions={actions}\n            auth={auth}\n            singlePost={singlePost}\n            delete={this.deleteComment}\n            edit={this.editComment}\n            user={user}\n          />\n\n          <Box mt={2}>{this.state.editing ? editingEl : textBody}</Box>\n          {renderButtons()}\n        </View>\n      </View>\n    );\n  }\n}\n\nexport default Comment;\n"],"file":"comment.component.js"}