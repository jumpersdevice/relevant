{"version":3,"sources":["../../../../src/modules/comment/mobile/commentInput.component.js"],"names":["styles","DEFAULT_INPUT_HEIGHT","CommentInput","props","context","setMention","bind","createComment","processInput","state","inputHeight","actions","setUserSearch","user","comment","replace","mention","handle","setState","parentPost","parentComment","auth","onFocus","scrollToBottom","length","Alert","alert","trim","commentObj","_id","linkParent","type","text","tags","commentTags","mentions","commentMentions","textInput","blur","then","success","focus","words","utils","getWords","lastWord","match","searchUser","getTags","getMentions","updatePosition","top","editing","placeholder","inputImage","image","uri","e","nativeEvent","layout","y","commentInputParent","c","commentInput","greyText","event","h","contentSize","height","Math","max","okToSubmit","flex","commentSubmit","fontSize","fontWeight","color","Component","PropTypes","object","func","bool","string","localStyles","StyleSheet","create","minHeight","maxHeight","paddingTop","paddingBottom","paddingLeft","lineHeight","flexDirection","justifyContent","alignItems","borderTopWidth","borderTopColor","backgroundColor","width","borderRadius","marginLeft","mainPadding","marginRight","paddingHorizontal","globalStyles"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {\n  StyleSheet,\n  Text,\n  View,\n  TextInput,\n  Image,\n  Alert,\n  TouchableHighlight\n} from 'react-native';\nimport PropTypes from 'prop-types';\nimport { globalStyles, greyText, mainPadding } from 'app/styles/global';\nimport * as utils from 'app/utils';\nimport TextBody from 'modules/text/mobile/textBody.component';\n\nlet styles;\nconst DEFAULT_INPUT_HEIGHT = 25;\n\nclass CommentInput extends Component {\n  static propTypes = {\n    actions: PropTypes.object,\n    parentPost: PropTypes.object,\n    parentComment: PropTypes.object,\n    auth: PropTypes.object,\n    onFocus: PropTypes.func,\n    scrollToBottom: PropTypes.func,\n    updatePosition: PropTypes.func,\n    editing: PropTypes.bool,\n    placeholder: PropTypes.string\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.setMention = this.setMention.bind(this);\n    this.createComment = this.createComment.bind(this);\n    this.processInput = this.processInput.bind(this);\n    this.state = {\n      inputHeight: DEFAULT_INPUT_HEIGHT\n    };\n  }\n\n  componentWillUnmount() {\n    this.props.actions.setUserSearch([]);\n  }\n\n  setMention(user) {\n    const comment = this.state.comment.replace(this.mention, '@' + user.handle);\n    this.setState({ comment });\n    this.props.actions.setUserSearch([]);\n  }\n\n  createComment() {\n    const {\n      parentPost,\n      parentComment,\n      auth,\n      actions,\n      onFocus,\n      scrollToBottom\n    } = this.props;\n    if (!this.state.comment || !this.state.comment.length) {\n      return Alert.alert('no comment');\n    }\n\n    const comment = this.state.comment.trim();\n    const commentObj = {\n      parentPost: parentPost._id,\n      parentComment: parentComment ? parentComment._id : null,\n      linkParent: parentPost.type === 'link' ? parentPost._id : null,\n      text: comment,\n      tags: this.commentTags,\n      mentions: this.commentMentions,\n      user: auth.user._id\n    };\n\n    this.setState({ comment: '', inputHeight: DEFAULT_INPUT_HEIGHT });\n    this.textInput.blur();\n    onFocus('new');\n    actions.setUserSearch([]);\n\n    return this.props.actions.createComment(commentObj).then(success => {\n      if (!success) {\n        this.setState({ comment, inputHeight: DEFAULT_INPUT_HEIGHT });\n        this.textInput.focus();\n        return;\n      }\n      scrollToBottom();\n    });\n  }\n\n  processInput(comment) {\n    const words = utils.text.getWords(comment);\n\n    const lastWord = words[words.length - 1];\n    if (lastWord.match(/@\\S+/g) && lastWord.length > 1) {\n      this.mention = lastWord;\n      this.props.actions.searchUser(lastWord.replace('@', ''));\n    } else this.props.actions.setUserSearch([]);\n\n    this.commentTags = utils.text.getTags(words);\n    this.commentMentions = utils.text.getMentions(words);\n    this.props.updatePosition({\n      inputHeight: this.state.inputHeight,\n      top: this.top\n    });\n  }\n\n  render() {\n    const { auth, editing, placeholder } = this.props;\n    const { user } = auth;\n    const { inputHeight } = this.state;\n\n    if (editing) return null;\n\n    const inputImage = user && user.image && (\n      <Image style={styles.inputImage} source={{ uri: user.image }} />\n    );\n\n    // let inputImage = null;\n    // if (user && user.image) {\n    //   const imageUrl = user.image;\n    //   inputImage = <Image style={styles.inputImage} source={{ uri: imageUrl }} />;\n    // }\n    return (\n      <View\n        onLayout={e => {\n          this.top = e.nativeEvent.layout.y;\n          this.props.updatePosition({\n            inputHeight,\n            top: this.top\n          });\n        }}\n        style={styles.commentInputParent}\n      >\n        {inputImage}\n        <TextInput\n          ref={c => {\n            this.textInput = c;\n          }}\n          underlineColorAndroid={'transparent'}\n          textAlignVertical={'top'}\n          style={[styles.commentInput]}\n          placeholder={placeholder || 'Enter reply...'}\n          placeholderTextColor={greyText}\n          multiline\n          onChangeText={comment => {\n            this.processInput(comment, false);\n            this.setState({ comment });\n          }}\n          onContentSizeChange={event => {\n            const h = event.nativeEvent.contentSize.height;\n            this.setState({\n              inputHeight: Math.max(DEFAULT_INPUT_HEIGHT, h)\n            });\n          }}\n          returnKeyType=\"default\"\n          onFocus={this.props.onFocus}\n          onSubmitEditing={() => {\n            if (this.okToSubmit) {\n              let { comment } = this.state;\n              comment += '\\n';\n              this.processInput(comment, false);\n              this.setState({ comment });\n              return (this.okToSubmit = false);\n            }\n            return (this.okToSubmit = true);\n          }}\n        >\n          <TextBody style={{ flex: 1 }} showAllMentions>\n            {this.state.comment}\n          </TextBody>\n        </TextInput>\n        <TouchableHighlight\n          underlayColor={'transparent'}\n          style={[styles.commentSubmit]}\n          onPress={() => this.createComment()}\n        >\n          <Text style={[{ fontSize: 18, fontWeight: 'bold', color: 'white' }]}>\n            {'\\u2191'}\n          </Text>\n        </TouchableHighlight>\n      </View>\n    );\n  }\n}\n\nexport default CommentInput;\n\nconst localStyles = StyleSheet.create({\n  commentInput: {\n    minHeight: 50,\n    maxHeight: 200,\n    paddingTop: 14,\n    paddingBottom: 10,\n    paddingLeft: 10,\n    flex: 5,\n    lineHeight: 20,\n    flexDirection: 'row',\n    justifyContent: 'center',\n    fontSize: 16\n  },\n  commentInputParent: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    borderTopWidth: 1,\n    borderTopColor: 'lightgrey',\n    backgroundColor: 'white'\n  },\n  inputImage: {\n    height: 25,\n    width: 25,\n    borderRadius: 12.5,\n    marginLeft: mainPadding\n  },\n  commentSubmit: {\n    backgroundColor: '#0000FF',\n    marginRight: 16,\n    flex: 0,\n    width: 25,\n    height: 25,\n    paddingHorizontal: 4,\n    borderRadius: 12.5,\n    justifyContent: 'center',\n    alignItems: 'center'\n  }\n});\n\nstyles = { ...localStyles, ...globalStyles };\n"],"file":"commentInput.component.js"}