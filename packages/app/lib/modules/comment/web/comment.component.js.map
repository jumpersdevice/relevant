{"version":3,"sources":["../../../../src/modules/comment/web/comment.component.js"],"names":["Comment","propTypes","comment","PropTypes","object","user","activeComment","string","setActiveComment","func","parentPost","childComments","posts","nestingLevel","number","hidePostButtons","bool","hideReplyButtons","condensedView","hideBorder","post","hideAvatar","noLink","avatarText","focusedComment","oneOfType","scrollTo","preview","inMainFeed","additionalNesting","defaultProps","props","dispatch","editing","setEditing","users","state","screenSize","navigation","auth","embeddedUser","userId","handleToId","handle","el","scrollIfFocused","_id","current","measureInWindow","x","y","deletePost","okToDelete","confirm","cancel","isActive","id","body","commentChildren","borderMargin","layout","POST_BUTTONS_WIDTH","popup","text","action","require","POST_BUTTONS_NESTING_UNITS","map","childId"],"mappings":"ibAAA,qDACA,uCACA,qCACA,uDACA,6DACA,iEACA,kGACA,4EACA,mEACA,uCACA,qFACA,2CACA,mE,0GAEAA,OAAO,CAACC,SAAR,CAAoB,CAClBC,OAAO,CAAEC,mBAAUC,MADD,CAElBC,IAAI,CAAEF,mBAAUC,MAFE,CAGlBE,aAAa,CAAEH,mBAAUI,MAHP,CAIlBC,gBAAgB,CAAEL,mBAAUM,IAJV,CAKlBC,UAAU,CAAEP,mBAAUC,MALJ,CAMlBO,aAAa,CAAER,mBAAUC,MANP,CAOlBQ,KAAK,CAAET,mBAAUC,MAPC,CAQlBS,YAAY,CAAEV,mBAAUW,MARN,CASlBC,eAAe,CAAEZ,mBAAUa,IATT,CAUlBC,gBAAgB,CAAEd,mBAAUa,IAVV,CAWlBE,aAAa,CAAEf,mBAAUa,IAXP,CAYlBG,UAAU,CAAEhB,mBAAUa,IAZJ,CAalBI,IAAI,CAAEjB,mBAAUC,MAbE,CAclBiB,UAAU,CAAElB,mBAAUa,IAdJ,CAelBM,MAAM,CAAEnB,mBAAUa,IAfA,CAgBlBO,UAAU,CAAEpB,mBAAUM,IAhBJ,CAiBlBe,cAAc,CAAErB,mBAAUsB,SAAV,CAAoB,CAACtB,mBAAUI,MAAX,CAAmBJ,mBAAUW,MAA7B,CAApB,CAjBE,CAkBlBY,QAAQ,CAAEvB,mBAAUM,IAlBF,CAmBlBkB,OAAO,CAAExB,mBAAUa,IAnBD,CAoBlBY,UAAU,CAAEzB,mBAAUa,IApBJ,CAqBlBa,iBAAiB,CAAE1B,mBAAUW,MArBX,CAApB,CAwBAd,OAAO,CAAC8B,YAAR,CAAuB,CACrBD,iBAAiB,CAAE,CADE,CAAvB,CAIA,QAAS7B,CAAAA,OAAT,CAAiB+B,KAAjB,CAAwB,IAEpB7B,CAAAA,OAFoB,CAoBlB6B,KApBkB,CAEpB7B,OAFoB,CAGpBI,aAHoB,CAoBlByB,KApBkB,CAGpBzB,aAHoB,CAIpBK,aAJoB,CAoBlBoB,KApBkB,CAIpBpB,aAJoB,CAKpBC,KALoB,CAoBlBmB,KApBkB,CAKpBnB,KALoB,CAMpBC,YANoB,CAoBlBkB,KApBkB,CAMpBlB,YANoB,CAOpBE,eAPoB,CAoBlBgB,KApBkB,CAOpBhB,eAPoB,CAQpBE,gBARoB,CAoBlBc,KApBkB,CAQpBd,gBARoB,CASpBE,UAToB,CAoBlBY,KApBkB,CASpBZ,UAToB,CAUpBE,UAVoB,CAoBlBU,KApBkB,CAUpBV,UAVoB,CAWpBC,MAXoB,CAoBlBS,KApBkB,CAWpBT,MAXoB,CAYpBC,UAZoB,CAoBlBQ,KApBkB,CAYpBR,UAZoB,CAapBI,OAboB,CAoBlBI,KApBkB,CAapBJ,OAboB,CAcpBC,UAdoB,CAoBlBG,KApBkB,CAcpBH,UAdoB,CAepBC,iBAfoB,CAoBlBE,KApBkB,CAepBF,iBAfoB,CAgBpBnB,UAhBoB,CAoBlBqB,KApBkB,CAgBpBrB,UAhBoB,CAiBpBgB,QAjBoB,CAoBlBK,KApBkB,CAiBpBL,QAjBoB,CAkBpBF,cAlBoB,CAoBlBO,KApBkB,CAkBpBP,cAlBoB,CAmBpBhB,gBAnBoB,CAoBlBuB,KApBkB,CAmBpBvB,gBAnBoB,CAqBtB,GAAMwB,CAAAA,QAAQ,CAAG,6BAAjB,CArBsB,cAsBQ,oBAAS,KAAT,CAtBR,qDAsBfC,OAtBe,eAsBNC,UAtBM,eAwBtB,GAAMC,CAAAA,KAAK,CAAG,4BAAY,SAAAC,KAAK,QAAIA,CAAAA,KAAK,CAAC/B,IAAV,EAAjB,CAAd,CACA,GAAMgC,CAAAA,UAAU,CAAG,4BAAY,SAAAD,KAAK,QAAIA,CAAAA,KAAK,CAACE,UAAN,CAAiBD,UAArB,EAAjB,CAAnB,CACA,GAAME,CAAAA,IAAI,CAAG,4BAAY,SAAAH,KAAK,QAAIA,CAAAA,KAAK,CAACG,IAAV,EAAjB,CAAb,CAEA,GAAMC,CAAAA,YAAY,CAAG,iBAAItC,OAAJ,CAAa,cAAb,CAA6B,EAA7B,CAArB,CACA,GAAMuC,CAAAA,MAAM,CAAGN,KAAK,CAACO,UAAN,CAAiBF,YAAY,CAACG,MAA9B,CAAf,CACA,GAAMtC,CAAAA,IAAI,CAAG8B,KAAK,CAACA,KAAN,CAAYM,MAAZ,GAAuBD,YAApC,CAEA,GAAMI,CAAAA,EAAE,CAAG,sBAAX,CAEA,qBAAU,UAAM,CACd,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CAC5B,GAAI3C,OAAO,EAAIsB,cAAc,GAAKtB,OAAO,CAAC4C,GAA1C,CAA+C,CAC7CF,EAAE,CAACG,OAAH,CAAWC,eAAX,CAA2B,SAACC,CAAD,CAAIC,CAAJ,CAAU,CACnCxB,QAAQ,EAAIA,QAAQ,CAAC,CAAD,CAAIwB,CAAJ,CAApB,CACD,CAFD,EAGD,CACF,CAND,CAOAL,eAAe,GAChB,CATD,CASG,CAACrB,cAAD,CATH,EAWA,GAAM2B,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CAGvB,GAAMC,CAAAA,UAAU,CAAGC,OAAO,CAAC,4CAAD,CAA1B,CACA,GAAI,CAACD,UAAL,CAAiB,OACjBpB,QAAQ,CAAC,2BAAc9B,OAAO,CAAC4C,GAAtB,CAAD,CAAR,CACD,CAND,CAQA,GAAMQ,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACnB9C,gBAAgB,CAAC,IAAD,CAAhB,CACA0B,UAAU,CAAC,KAAD,CAAV,CACD,CAHD,CAKA,GAAI,CAAChC,OAAL,CAAc,MAAO,KAAP,CACd,GAAMqD,CAAAA,QAAQ,CAAGjD,aAAa,GAAKJ,OAAO,CAACsD,EAA3C,CAEA,GAAMC,CAAAA,IAAI,CACR,6BAAC,oBAAD,EACE,OAAO,CAAEvD,OADX,CAEE,UAAU,CAAE0B,UAFd,CAGE,OAAO,CAAED,OAHX,CAIE,UAAU,CAAEJ,UAJd,CAKE,MAAM,CAAED,MALV,iEADF,CAUA,GAAMoC,CAAAA,eAAe,CAAG,iBAAI/C,aAAJ,CAAmBT,OAAO,CAACsD,EAA3B,GAAkC,EAA1D,CACA,GAAMG,CAAAA,YAAY,CAChB5C,eAAe,EAAIsB,UAAnB,CACKxB,YAAY,EAAI,CAAC,CAAlB,EAAwB,CAD5B,CAEI+C,eAAOC,kBAAP,CAA4B,CAHlC,CAKA,GAAMC,CAAAA,KAAK,CAAGvB,IAAI,CAAClC,IAAL,EAAakC,IAAI,CAAClC,IAAL,CAAUyC,GAAV,GAAkB5C,OAAO,CAACG,IAAvC,EACZ,6BAAC,cAAD,EACE,OAAO,CAAE,CACP,CAAE0D,IAAI,CAAE,WAAR,CAAqBC,MAAM,CAAE,wBAAM9B,CAAAA,UAAU,CAAC,IAAD,CAAhB,EAA7B,CADO,CAEP,CAAE6B,IAAI,CAAE,aAAR,CAAuBC,MAAM,CAAE,wBAAMb,CAAAA,UAAU,EAAhB,EAA/B,CAFO,CADX,iEAME,qCAAM,SAAS,CAAE,YAAjB,uEANF,CADF,CAWA,MACE,8BAAC,QAAD,EAAK,GAAG,CAAEP,EAAV,iEACE,6BAAC,WAAD,EACE,YAAY,CAAE/B,YADhB,CAEE,iBAAiB,CAAEgB,iBAFrB,CAGE,UAAU,CAAEQ,UAHd,CAIE,UAAU,CAAC,QAJb,iEAME,6BAAC,QAAD,EAAK,CAAC,CAAE,CAAC,SAAD,WAAeV,OAAO,CAAG,SAAH,CAAe,SAArC,EAAR,iEACG,CAACR,UAAD,GAAgBN,YAAY,CAAG,CAAf,EAAoBe,UAApC,GACC,6BAAC,YAAD,EAAS,EAAE,CAAE+B,YAAb,kEAFJ,CAIE,6BAAC,SAAD,EAAM,UAAU,CAAC,KAAjB,CAAuB,EAAE,CAAE,CAA3B,kEACG,CAAC5C,eAAD,EAAoB,CAACsB,UAArB,CACC,6BAAC,SAAD,EAAM,CAAC,CAAEuB,eAAOC,kBAAhB,kEACE,6BAAC,oBAAD,EAAa,IAAI,CAAE3D,OAAnB,kEADF,CADD,CAIG,IALN,CAMGW,YAAY,CAAG,CAAf,CACC,6BAAC,UAAD,EACE,CAAC,CAAE,CADL,CAEE,CAAC,CAAE,CAFL,CAGE,EAAE,CAAE,CAAC,CAAC,CAAF,CAAK,CAAL,CAHN,CAIE,EAAE,CAAE,CAJN,CAKE,UAAU,CAAE,SALd,CAME,MAAM,CAAEoD,OAAO,oCANjB,kEADD,CASG,IAfN,CAiBE,6BAAC,SAAD,EAAM,UAAU,CAAC,QAAjB,CAA0B,IAAI,CAAE,CAAhC,CAAmC,MAAM,CAAE,CAA3C,kEACE,6BAAC,iBAAD,EACE,IAAI,CAAE5D,IADR,CAEE,OAAO,CAAEH,OAFX,CAGE,UAAU,CAAEmB,UAHd,CAIE,UAAU,CAAEE,UAJd,CAKE,MAAM,CAAED,MALV,CAME,KAAK,CAAE,CAACK,OAAD,EAAYmC,KANrB,CAOE,OAAO,CAAEnC,OAPX,kEADF,CAUE,6BAAC,QAAD,EAAK,EAAE,CAAE,CAAT,kEAVF,CAWGM,OAAO,CACN,6BAAC,QAAD,EAAK,EAAE,CAAE,CAAT,kEACE,6BAAC,oBAAD,EACE,IAAI,KADN,CAEE,CAAC,CAAE,CAAC,SAAD,CAAY,CAAZ,CAFL,CAGE,UAAU,CAAEvB,UAHd,CAIE,OAAO,CAAER,OAJX,CAKE,UAAU,CAAE,QALd,CAME,MAAM,CAAEoD,MANV,CAOE,YAAY,CAAEzC,YAPhB,CAQE,SAAS,KARX,kEADF,CADM,CAcN4C,IAzBJ,CA2BGxB,OAAO,EAAIhB,gBAAX,EAAgCF,eAAe,EAAIY,OAAnD,CAA8D,IAA9D,CACC,6BAAC,QAAD,EAAK,EAAE,CAAE,CAAT,CAAY,EAAE,CAAE,CAAC,CAAD,CAAI,CAAJ,CAAhB,kEACE,6BAAC,kBAAD,0BAAeI,KAAf,EAAsB,IAAI,CAAE7B,OAA5B,mEADF,CA5BJ,CAjBF,CAJF,CANF,CADF,CAiEGqD,QAAQ,EAAI,CAACtB,OAAb,EACC,6BAAC,oBAAD,EACE,UAAU,CAAEvB,UADd,CAEE,YAAY,CAAEG,YAFhB,CAGE,CAAC,CAAE,CAAC,CAAD,CAAI,CAAJ,CAHL,CAIE,UAAU,CAAE,SAJd,CAKE,iBAAiB,CACfgB,iBAAiB,EAAId,eAAe,CAAG,CAAH,CAAO6C,eAAOM,0BAAjC,CANrB,CAQE,aAAa,CAAEhE,OARjB,CASE,MAAM,CAAEoD,MATV,CAUE,SAAS,KAVX,iEAlEJ,CA+EGI,eAAe,CAACS,GAAhB,CAAoB,SAAAC,OAAO,QAC1B,8BAAC,OAAD,0BACMrC,KADN,EAEE,OAAO,CAAEnB,KAAK,CAACA,KAAN,CAAYwD,OAAZ,CAFX,CAGE,GAAG,CAAEA,OAHP,CAIE,YAAY,CAAEvD,YAAY,CAAG,CAJ/B,kEAD0B,EAA3B,CA/EH,CADF,CA0FD,C,aAEcb,O","sourcesContent":["import React, { useEffect, createRef, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { View, Divider, Spacer, Image, Box } from 'modules/styled/uni';\nimport get from 'lodash/get';\nimport PropTypes from 'prop-types';\nimport Popup from 'modules/ui/web/popup';\nimport PostButtons from 'modules/post/vote-buttons/postbuttons.container';\nimport CommentForm from 'modules/comment/web/commentForm.component';\nimport CommentBody from 'modules/comment/commentBody';\nimport { layout } from 'app/styles';\nimport ButtonRow from 'modules/post/web/buttonRow.component';\nimport { deleteComment } from 'modules/comment/comment.actions';\nimport CommentAuthor from 'modules/comment/comment.author';\n\nComment.propTypes = {\n  comment: PropTypes.object,\n  user: PropTypes.object,\n  activeComment: PropTypes.string,\n  setActiveComment: PropTypes.func,\n  parentPost: PropTypes.object,\n  childComments: PropTypes.object,\n  posts: PropTypes.object,\n  nestingLevel: PropTypes.number,\n  hidePostButtons: PropTypes.bool,\n  hideReplyButtons: PropTypes.bool,\n  condensedView: PropTypes.bool,\n  hideBorder: PropTypes.bool,\n  post: PropTypes.object,\n  hideAvatar: PropTypes.bool,\n  noLink: PropTypes.bool,\n  avatarText: PropTypes.func,\n  focusedComment: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  scrollTo: PropTypes.func,\n  preview: PropTypes.bool,\n  inMainFeed: PropTypes.bool,\n  additionalNesting: PropTypes.number\n};\n\nComment.defaultProps = {\n  additionalNesting: 0\n};\n\nfunction Comment(props) {\n  const {\n    comment,\n    activeComment,\n    childComments,\n    posts,\n    nestingLevel,\n    hidePostButtons,\n    hideReplyButtons,\n    hideBorder,\n    hideAvatar,\n    noLink,\n    avatarText,\n    preview,\n    inMainFeed,\n    additionalNesting,\n    parentPost,\n    scrollTo,\n    focusedComment,\n    setActiveComment\n  } = props;\n  const dispatch = useDispatch();\n  const [editing, setEditing] = useState(false);\n\n  const users = useSelector(state => state.user);\n  const screenSize = useSelector(state => state.navigation.screenSize);\n  const auth = useSelector(state => state.auth);\n\n  const embeddedUser = get(comment, 'embeddedUser', {});\n  const userId = users.handleToId[embeddedUser.handle];\n  const user = users.users[userId] || embeddedUser;\n\n  const el = createRef();\n\n  useEffect(() => {\n    const scrollIfFocused = () => {\n      if (comment && focusedComment === comment._id) {\n        el.current.measureInWindow((x, y) => {\n          scrollTo && scrollTo(0, y);\n        });\n      }\n    };\n    scrollIfFocused();\n  }, [focusedComment]); // eslint-disable-line\n\n  const deletePost = () => {\n    // TODO custom confirm\n    // eslint-disable-next-line\n    const okToDelete = confirm('Are you sure you want to delete this post?');\n    if (!okToDelete) return;\n    dispatch(deleteComment(comment._id));\n  };\n\n  const cancel = () => {\n    setActiveComment(null);\n    setEditing(false);\n  };\n\n  if (!comment) return null;\n  const isActive = activeComment === comment.id;\n\n  const body = (\n    <CommentBody\n      comment={comment}\n      inMainFeed={inMainFeed}\n      preview={preview}\n      avatarText={avatarText}\n      noLink={noLink}\n    />\n  );\n\n  const commentChildren = get(childComments, comment.id) || [];\n  const borderMargin =\n    hidePostButtons || screenSize\n      ? (nestingLevel && -3) || 0\n      : layout.POST_BUTTONS_WIDTH / 3;\n\n  const popup = auth.user && auth.user._id === comment.user && (\n    <Popup\n      options={[\n        { text: 'Edit Post', action: () => setEditing(true) },\n        { text: 'Delete Post', action: () => deletePost() }\n      ]}\n    >\n      <span className={'optionDots'}>...</span>\n    </Popup>\n  );\n\n  return (\n    <Box ref={el}>\n      <Spacer\n        nestingLevel={nestingLevel}\n        additionalNesting={additionalNesting}\n        screenSize={screenSize}\n        fdirection=\"column\"\n      >\n        <Box m={['0 3 0 0', `${preview ? '0 2 0 0' : '0 2 2 2'}`]}>\n          {!hideBorder && (nestingLevel > 0 || inMainFeed) && (\n            <Divider ml={borderMargin} />\n          )}\n          <View fdirection=\"row\" mt={4}>\n            {!hidePostButtons && !screenSize ? (\n              <View w={layout.POST_BUTTONS_WIDTH}>\n                <PostButtons post={comment} />\n              </View>\n            ) : null}\n            {nestingLevel > 0 ? (\n              <Image\n                h={3}\n                w={2}\n                ml={[-3, 0]}\n                mr={1}\n                resizeMode={'contain'}\n                source={require('public/img/reply.png')}\n              />\n            ) : null}\n\n            <View fdirection=\"column\" grow={1} shrink={1}>\n              <CommentAuthor\n                user={user}\n                comment={comment}\n                hideAvatar={hideAvatar}\n                avatarText={avatarText}\n                noLink={noLink}\n                popup={!preview && popup}\n                preview={preview}\n              />\n              <Box mt={1} />\n              {editing ? (\n                <Box mt={2}>\n                  <CommentForm\n                    edit\n                    p={['0 0 4 0', 2]}\n                    parentPost={parentPost}\n                    comment={comment}\n                    buttonText={'Update'}\n                    cancel={cancel}\n                    nestingLevel={nestingLevel}\n                    autoFocus\n                  />\n                </Box>\n              ) : (\n                body\n              )}\n              {editing || hideReplyButtons || (hidePostButtons && preview) ? null : (\n                <Box mt={1} mb={[4, 2]}>\n                  <ButtonRow {...props} post={comment} />\n                </Box>\n              )}\n            </View>\n          </View>\n        </Box>\n      </Spacer>\n\n      {isActive && !editing && (\n        <CommentForm\n          parentPost={parentPost}\n          nestingLevel={nestingLevel}\n          p={[4, 2]}\n          buttonText={'Comment'}\n          additionalNesting={\n            additionalNesting + (hidePostButtons ? 0 : layout.POST_BUTTONS_NESTING_UNITS)\n          }\n          parentComment={comment}\n          cancel={cancel}\n          autoFocus\n        />\n      )}\n      {commentChildren.map(childId => (\n        <Comment\n          {...props}\n          comment={posts.posts[childId]}\n          key={childId}\n          nestingLevel={nestingLevel + 1}\n        />\n      ))}\n    </Box>\n  );\n}\n\nexport default Comment;\n"],"file":"comment.component.js"}