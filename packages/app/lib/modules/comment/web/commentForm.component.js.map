{"version":3,"sources":["../../../../src/modules/comment/web/commentForm.component.js"],"names":["AvatarContainer","View","CommentFormComponent","propTypes","edit","PropTypes","bool","comment","object","cancel","func","buttonText","string","parentPost","parentComment","nestingLevel","number","additionalNesting","autoFocus","screenSize","styleProps","auth","state","navigation","focused","setFocused","dispatch","initalText","body","commentText","setCommentText","textArea","handleChange","e","target","value","authError","_createComment","isAuthenticated","alert","browserAlerts","length","getMentionsAndTags","mentions","tags","commentObj","_id","linkParent","type","text","trim","metaPost","newComment","current","focus","_cancel","history","push","community","_updateComment","originalText","words","getWords","getTags","getMentions","handleSubmit","backgroundColor","colors","secondaryBG","paddingTop","component","position","user","secondaryText"],"mappings":"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","sourcesContent":["import React, { useState, useRef, memo } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { Button, View } from 'modules/styled/web';\nimport { alert, text } from 'app/utils';\nimport { colors, sizing } from 'app/styles';\nimport UAvatar from 'modules/user/UAvatar.component';\nimport styled from 'styled-components';\nimport { Spacer } from 'modules/styled/uni';\nimport { createComment, updateComment } from 'modules/comment/comment.actions';\nimport history from 'modules/navigation/history';\nimport TextAreaWithMention from 'modules/text/web/textAreaWithMention';\nimport { useCommunityAuth } from 'modules/createPost/hooks';\n\nconst AvatarContainer = styled(View)`\n  position: absolute;\n  left: ${sizing(0)};\n  top: ${sizing(0)};\n  z-index: 10;\n`;\n\nCommentFormComponent.propTypes = {\n  edit: PropTypes.bool,\n  comment: PropTypes.object,\n  cancel: PropTypes.func,\n  buttonText: PropTypes.string,\n  parentPost: PropTypes.object,\n  parentComment: PropTypes.object,\n  nestingLevel: PropTypes.number,\n  additionalNesting: PropTypes.number,\n  autoFocus: PropTypes.bool,\n  screenSize: PropTypes.number\n};\n\nexport function CommentFormComponent({\n  comment,\n  edit,\n  cancel,\n  nestingLevel,\n  additionalNesting,\n  autoFocus,\n  parentComment,\n  parentPost,\n  buttonText,\n  ...styleProps\n}) {\n  const auth = useSelector(state => state.auth);\n  const screenSize = useSelector(state => state.navigation.screenSize);\n\n  const [focused, setFocused] = useState(false);\n  const dispatch = useDispatch();\n\n  const initalText = edit ? comment.body : '';\n  const [commentText, setCommentText] = useState(initalText);\n\n  const textArea = useRef();\n\n  const handleChange = e => setCommentText(e.target.value);\n\n  const authError = useCommunityAuth();\n\n  // TODO - non-shift enter?\n  // handleKeydown(e) {\n  //  if (e.keyCode == 13 && e.shiftKey == false) {\n  //  }\n  // }\n\n  async function _createComment() {\n    if (!auth.isAuthenticated) {\n      return alert.browserAlerts.alert('Please log in to post comments');\n    }\n    if (!commentText || !commentText.length) {\n      return alert.browserAlerts.alert('no comment');\n    }\n\n    const { mentions, tags } = getMentionsAndTags();\n\n    const commentObj = {\n      parentPost: parentPost._id,\n      parentComment: parentComment ? parentComment._id : null,\n      linkParent: parentPost.type === 'link' ? parentPost._id : null,\n      text: commentText.trim(),\n      tags,\n      mentions,\n      metaPost: parentPost.metaPost\n    };\n\n    setCommentText('');\n    const newComment = await dispatch(createComment(commentObj));\n    if (!newComment) {\n      setCommentText(commentText);\n      if (textArea.current) textArea.current.focus();\n      return null;\n    }\n    _cancel();\n    return history.push(\n      `/${newComment.community}/post/${newComment.parentPost}/${newComment._id}`\n    );\n  }\n\n  async function _updateComment() {\n    if (comment.body === commentText) {\n      return _cancel();\n    }\n    const { mentions } = getMentionsAndTags();\n    const originalText = comment.body;\n    comment.body = commentText;\n    comment.mentions = mentions;\n\n    const newComment = await dispatch(updateComment(comment));\n    if (newComment) return _cancel();\n\n    comment.body = originalText;\n    alert.browserAlerts.alert('Error updating comment');\n    return null;\n  }\n\n  function getMentionsAndTags() {\n    const words = text.getWords(commentText);\n    const tags = text.getTags(words);\n    const mentions = text.getMentions(words);\n    return { mentions, tags };\n  }\n\n  function _cancel() {\n    setCommentText('');\n    cancel && cancel();\n  }\n\n  const handleSubmit = () => {\n    // e.preventDefault();\n    if (edit) return _updateComment();\n    return _createComment();\n  };\n\n  if (!auth.isAuthenticated) return null;\n\n  const backgroundColor = !edit && focused ? colors.secondaryBG : 'transparent';\n  const paddingTop = !edit && focused ? 4 : 0;\n\n  return (\n    <Spacer\n      fdirection=\"row\"\n      grow={1}\n      {...styleProps}\n      pt={paddingTop}\n      bg={backgroundColor}\n      nestingLevel={screenSize ? 0 : nestingLevel}\n      additionalNesting={screenSize ? 0 : additionalNesting}\n      screenSize={screenSize}\n    >\n      {authError && focused ? (\n        authError.component\n      ) : (\n        <View fdirection=\"column\" flex={1} style={{ position: 'relative' }}>\n          <TextAreaWithMention\n            textArea={textArea}\n            value={commentText}\n            autoFocus={autoFocus}\n            leftPadding={focused ? 2 : 6}\n            onChange={handleChange}\n            setFocused={setFocused}\n            // withPreview\n            placeholder={'Enter comment...'}\n            minheight={focused ? sizing(8) : null}\n          >\n            {focused ? null : (\n              <AvatarContainer p={2}>\n                <UAvatar user={auth.user} size={3} noLink />\n              </AvatarContainer>\n            )}\n          </TextAreaWithMention>\n          {focused || commentText ? (\n            <View justify=\"flex-end\" fdirection=\"row\">\n              <Button\n                onMouseDown={_cancel}\n                onTouchStart={_cancel}\n                bg=\"transparent\"\n                c={colors.secondaryText}\n                disabled={!auth.isAuthenticated}\n                p={[null, '0 4']}\n                minwidth={1}\n                mr={1}\n              >\n                Cancel\n              </Button>\n              <Button\n                onMouseDown={handleSubmit}\n                onTouchStart={handleSubmit}\n                disabled={!auth.isAuthenticated}\n                p={[null, '0 4']}\n                minwidth={1}\n              >\n                {buttonText}\n              </Button>\n            </View>\n          ) : null}\n        </View>\n      )}\n    </Spacer>\n  );\n}\n\nexport default memo(CommentFormComponent);\n"],"file":"commentForm.component.js"}