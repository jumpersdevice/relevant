{"version":3,"sources":["../../../../src/modules/text/mobile/textBody.component.js"],"names":["styles","TextBody","props","context","user","actions","goToProfile","post","_id","goToPost","bind","goToTopic","tag","selectTag","replace","changeTab","resetRoutes","topic","trim","categoryName","next","body","children","expanded","singlePost","maxTextLength","showAllMentions","bodyEl","bodyObj","extraTags","tags","textArr","utils","text","getWords","forEach","section","word","match","type","ind","indexOf","splice","m","mentions","find","mention","URL_REGEX","test","push","breakText","tagsOnEnd","reduced","currentText","i","length","map","space","style","active","setSelected","link","Linking","openURL","greyText","numberOfLines","Component","PropTypes","object","string","node","bool","number","Text","propTypes","localStyles","StyleSheet","create","globalStyles"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { StyleSheet, Text, Linking } from 'react-native';\nimport PropTypes from 'prop-types';\nimport { globalStyles } from 'app/styles/global';\nimport * as utils from 'app/utils';\n\nlet styles;\n\nclass TextBody extends Component {\n  static propTypes = {\n    actions: PropTypes.object,\n    post: PropTypes.object,\n    body: PropTypes.string,\n    children: PropTypes.node,\n    singlePost: PropTypes.bool,\n    maxTextLength: PropTypes.number,\n    showAllMentions: PropTypes.bool,\n    numberOfLines: PropTypes.number,\n    style: Text.propTypes.style\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.goToPost = this.goToPost.bind(this);\n    this.goToTopic = this.goToTopic.bind(this);\n  }\n\n  setTag(tag) {\n    if (!this.props.actions) return;\n    this.props.actions.selectTag({ _id: tag.replace('#', '') });\n    this.props.actions.changeTab('discover');\n    this.props.actions.resetRoutes('discover');\n  }\n\n  setSelected = user => this.props.actions && this.props.actions.goToProfile(user);\n\n  goToTopic(tag) {\n    const topic = {\n      _id: tag.replace('#', '').trim(),\n      categoryName: tag\n    };\n    this.props.actions.goToTopic(topic);\n  }\n\n  goToPost = () => {\n    const { actions, post } = this.props;\n    actions && post && post._id && actions.goToPost(this.props.post);\n  };\n\n  shouldComponentUpdate(next) {\n    if (this.props.body !== next.body || this.props.children !== next.children) {\n      return true;\n    }\n    return false;\n  }\n\n  render() {\n    const expanded = this.props.singlePost;\n    const maxTextLength = this.props.maxTextLength || 100 ** 10;\n    const body = this.props.body || this.props.children || '';\n    const post = this.props.post || {};\n    const { showAllMentions } = this.props;\n\n    let bodyEl = null;\n    const bodyObj = [];\n    const extraTags = post.tags || [];\n    const textArr = utils.text.getWords(body);\n\n    textArr.forEach(section => {\n      const word = {};\n      word.text = section;\n      if (section.match(/^#/) && section.replace(/#/g, '') !== '') {\n        word.type = 'hashtag';\n        const ind = extraTags.indexOf(word.text.replace('#', '').trim());\n        if (ind > -1) extraTags.splice(ind, 1);\n      } else if (section.match(/^@/) && section.replace(/@/g, '') !== '') {\n        const m = section.replace('@', '');\n        if (post.mentions && post.mentions.find(mention => mention === m)) {\n          word.type = 'mention';\n        }\n        if (showAllMentions) word.type = 'mention';\n      } else if (utils.post.URL_REGEX.test(section)) {\n        word.type = 'url';\n      } else word.type = 'text';\n      bodyObj.push(word);\n    });\n\n    let breakText;\n\n    let tagsOnEnd = false;\n\n    extraTags.forEach(tag => {\n      bodyObj.push({ type: 'hashtag', text: ' #' + tag });\n    });\n\n    const reduced = [];\n    let currentText = '';\n    bodyObj.forEach((word, i) => {\n      if (word.type === 'text' && i <= maxTextLength) {\n        currentText += word.text;\n      } else {\n        if (currentText.length) {\n          reduced.push({ type: 'text', text: currentText });\n        }\n        reduced.push(word);\n        currentText = '';\n      }\n    });\n    if (currentText.length) {\n      reduced.push({ type: 'text', text: currentText });\n    }\n\n    bodyEl = reduced.map((word, i) => {\n      let space = '';\n      if (breakText) space = ' ';\n\n      if (word.type === 'hashtag') {\n        if (i >= maxTextLength) tagsOnEnd = true;\n        return (\n          <Text\n            key={i}\n            onPress={() => this.goToTopic(word.text)}\n            style={[this.props.style, styles.active]}\n          >\n            {word.text + space}\n          </Text>\n        );\n      }\n      if (word.type === 'mention') {\n        if (i >= maxTextLength) tagsOnEnd = true;\n        return (\n          <Text\n            key={i}\n            onPress={() => this.setSelected(word.text)}\n            style={[this.props.style, styles.active]}\n          >\n            {word.text + space}\n          </Text>\n        );\n      }\n      if (word.type === 'url') {\n        return (\n          <Text\n            key={i}\n            onPress={() => {\n              const link = word.text;\n              if (!link.match(/http:\\/\\//i) && !link.match(/https:\\/\\//i)) {\n                word.text = 'http://' + word.text;\n              }\n              return Linking.openURL(word.text);\n            }}\n            style={[this.props.style, styles.active]}\n          >\n            {word.text + space}\n          </Text>\n        );\n      }\n      if (i < maxTextLength || expanded) {\n        return (\n          <Text style={this.props.style} key={i}>\n            {word.text}\n          </Text>\n        );\n      }\n      if (!breakText) {\n        breakText = i;\n        return (\n          <Text style={this.props.style} key={'break'}>\n            ...{' '}\n          </Text>\n        );\n      }\n      return null;\n    });\n\n    if (breakText) {\n      bodyEl.push(\n        <Text style={[this.props.style, styles.greyText]} key={'readmore'}>\n          {tagsOnEnd ? '...' : ''}read more\n        </Text>\n      );\n    }\n\n    return (\n      <Text\n        numberOfLines={this.props.numberOfLines}\n        ellipsizeMode={'tail'}\n        style={[this.props.style]}\n      >\n        {bodyEl}\n      </Text>\n    );\n  }\n}\n\nexport default TextBody;\n\nconst localStyles = StyleSheet.create({});\n\nstyles = { ...globalStyles, ...localStyles };\n"],"file":"textBody.component.js"}