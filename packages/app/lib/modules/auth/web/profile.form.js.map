{"version":3,"sources":["../../../../src/modules/auth/web/profile.form.js"],"names":["Alert","alert","ProfileForm","propTypes","initialValues","PropTypes","object","additionalFields","close","func","ethLogin","signupCallback","signup","useSignUp","onSubmit","useOnSubmit","showEmailField","email","showPass","password","showConfirmPass","confirmPassword","FORM_FIELDS","image","username","filter","f","passwordsShouldMatch","handleSubmit","map","field","name","vals","allVals","preview","fileName","s3","toS3Advanced","img","url","message","auth","state","dispatch","invitecode","data","user"],"mappings":"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","sourcesContent":["import React, { useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport { LinkFont } from 'modules/styled/uni';\nimport ULink from 'modules/navigation/ULink.component';\nimport { s3, alert } from 'app/utils';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { createUser } from 'modules/auth/auth.actions';\nimport { Form, Field } from 'react-final-form';\nimport { Form as StyledForm, View, Button } from 'modules/styled/web';\nimport {\n  image,\n  email,\n  username,\n  password,\n  confirmPassword\n} from 'modules/auth/form.fields';\nimport { passwordsShouldMatch } from 'modules/form/validators';\n\nconst Alert = alert.Alert();\n\nProfileForm.propTypes = {\n  initialValues: PropTypes.object,\n  additionalFields: PropTypes.object,\n  close: PropTypes.func\n};\n\nexport default function ProfileForm({\n  initialValues = {},\n  additionalFields = {},\n  close\n}) {\n  const { ethLogin, signupCallback } = additionalFields;\n  const signup = useSignUp(additionalFields, close, signupCallback);\n  const onSubmit = useOnSubmit(signup);\n\n  const showEmailField = initialValues.email ? null : email;\n  const showPass = ethLogin ? null : password;\n  const showConfirmPass = showPass ? confirmPassword : null;\n\n  const FORM_FIELDS = [image, username, showEmailField, showPass, showConfirmPass].filter(\n    f => f\n  );\n\n  return (\n    <Form\n      onSubmit={onSubmit}\n      validate={passwordsShouldMatch}\n      initialValues={initialValues}\n      render={({ handleSubmit }) => (\n        <StyledForm fdirection=\"column\" onSubmit={handleSubmit}>\n          {FORM_FIELDS.map(field => (\n            <Field {...field} key={field.name} />\n          ))}\n          <View display=\"flex\" fdirection=\"row\" justify=\"flex-end\" mt={6} align=\"center\">\n            <LinkFont inline={1}>\n              By signing up, you agree to our{' '}\n              <ULink\n                to=\"//relevant.community/eula.html\"\n                external\n                target=\"_blank\"\n                inline={1}\n              >\n                Terms of Use\n              </ULink>\n            </LinkFont>\n            <Button type=\"submit\" ml={2.5}>\n              Sign Up\n            </Button>\n          </View>\n        </StyledForm>\n      )}\n    />\n  );\n}\n\nfunction useOnSubmit(signup) {\n  return useCallback(\n    async vals => {\n      try {\n        const allVals = { ...vals };\n        if (allVals.image && allVals.image.preview && allVals.image.fileName) {\n          const img = await s3.toS3Advanced(\n            allVals.image.preview,\n            allVals.image.fileName\n          );\n          allVals.image = img.url;\n        }\n        signup(allVals);\n      } catch (err) {\n        Alert.alert(err.message, 'error');\n      }\n    },\n    [signup]\n  );\n}\n\nfunction useSignUp(additionalFields, close, signupCallback) {\n  const auth = useSelector(state => state.auth);\n  const dispatch = useDispatch();\n  const { invitecode } = auth;\n\n  return useCallback(\n    async data => {\n      try {\n        const user = {\n          name: data.username,\n          email: data.email,\n          password: data.password,\n          image: data.image,\n          ...additionalFields\n        };\n        await dispatch(createUser(user, invitecode));\n        signupCallback && signupCallback(user);\n        close();\n      } catch (err) {\n        Alert.alert(err.message, 'error');\n      }\n    },\n    [additionalFields, dispatch, invitecode, close, signupCallback]\n  );\n}\n"],"file":"profile.form.js"}