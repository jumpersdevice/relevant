{"version":3,"sources":["../../../../src/modules/discover/mobile/discoverTabs.component.js"],"names":["styles","DiscoverTabs","props","context","React","createRef","Animated","Value","event","header","current","onScroll","height","setState","headerHeight","index","actions","navigation","setScrollTab","tab","setParams","state","routes","key","title","renderHeader","bind","renderScene","params","topic","topicId","id","loaded","needsReload","Date","getTime","requestAnimationFrame","prev","prevState","tabId","auth","newSortUrlParam","oldSortUrlParam","console","log","prevIndex","isActive","showHeader","route","currentRoute","setPostTop","gesture","community","flex","tabView","ref","simultaneousHandlers","waitFor","position","handleChangeTab","width","Dimensions","get","Component","PropTypes","object","number","topics","bool","tags","routeName","disabled","isLocked","gesturesEnabled","drawerLockMode","localStyles","StyleSheet","create","container","globalStyles","mapStateToProps","discover","showTopics","feedUnread","posts","mapDispatchToProps","dispatch","getParentTags","goToTopic","goToPage","lockDrawer"],"mappings":"y/BACA,qDACA,gDACA,uCACA,sFAEA,6DAEA,4BACA,sGACA,8CACA,0CACA,+DAMA,wFACA,8FACA,uDACA,yDACA,8DACA,wDACA,wDACA,sEACA,kFACA,8F,+mDAEA,GAAIA,CAAAA,MAAJ,C,GAEMC,CAAAA,Y,4GAyBJ,sBAAYC,KAAZ,CAAmBC,OAAnB,CAA4B,2DAC1B,uBAAMD,KAAN,CAAaC,OAAb,EAD0B,kFAJlBC,eAAMC,SAAN,EAIkB,mFAHnBD,eAAMC,SAAN,EAGmB,qFAFjB,GAAIC,gCAASC,KAAb,CAAmB,CAAnB,CAEiB,qFA6DjB,SAAAC,KAAK,QAAI,OAAKC,MAAL,CAAYC,OAAZ,CAAoBC,QAApB,CAA6BH,KAA7B,CAAJ,EA7DY,uFA+Df,SAAAI,MAAM,QAAI,OAAKC,QAAL,CAAc,CAAEC,YAAY,CAAEF,MAAhB,CAAd,CAAJ,EA/DS,4FAiEV,SAAAG,KAAK,CAAI,iBACO,MAAKb,KADZ,CACjBc,OADiB,aACjBA,OADiB,CACRC,UADQ,aACRA,UADQ,CAEzB,MAAKJ,QAAL,CAAc,CAAEE,KAAK,CAALA,KAAF,CAAd,EACAC,OAAO,CAACE,YAAR,CAAqB,UAArB,CAAiC,CAAEC,GAAG,CAAEJ,KAAP,CAAjC,EACAE,UAAU,CAACG,SAAX,CAAqB,CAAED,GAAG,CAAEJ,KAAP,CAArB,EACD,CAtE2B,EAE1B,MAAKM,KAAL,CAAa,CACXN,KAAK,CAAE,CADI,CAEXO,MAAM,CAAE,CACN,CAAEC,GAAG,CAAE,KAAP,CAAcC,KAAK,CAAE,KAArB,CADM,CAEN,CAAED,GAAG,CAAE,KAAP,CAAcC,KAAK,CAAE,KAArB,CAFM,CAFG,CAMXV,YAAY,CAAE,EANH,CAAb,CAQA,MAAKW,YAAL,CAAoB,MAAKA,YAAL,CAAkBC,IAAlB,4CAApB,CACA,MAAKC,WAAL,CAAmB,MAAKA,WAAL,CAAiBD,IAAjB,4CAAnB,CAX0B,GAalBE,CAAAA,MAbkB,CAaP,MAAK1B,KAAL,CAAWe,UAAX,CAAsBI,KAbf,CAalBO,MAbkB,CAc1B,GAAIA,MAAM,EAAIA,MAAM,CAACC,KAArB,CAA4B,CAC1B,MAAKC,OAAL,CAAeF,MAAM,CAACG,EAAtB,CACA,MAAKV,KAAL,CAAWC,MAAX,CAAoB,CAClB,CAAEC,GAAG,CAAE,KAAP,CAAcC,KAAK,CAAE,KAArB,CADkB,CAElB,CAAED,GAAG,CAAE,KAAP,CAAcC,KAAK,CAAE,KAArB,CAFkB,CAApB,CAID,CACD,MAAKQ,MAAL,CAAc,KAAd,CArB0B,aAsB3B,C,mGAEmB,oBACVf,CAAAA,UADU,CACK,KAAKf,KADV,CACVe,UADU,IAEVF,CAAAA,KAFU,CAEA,KAAKM,KAFL,CAEVN,KAFU,CAGlB,GAAI,KAAKe,OAAT,CAAkB,CAChB,KAAKG,WAAL,CAAmB,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAAnB,CACAC,qBAAqB,CAAC,UAAM,CAC1B,MAAI,CAACJ,MAAL,CAAc,IAAd,CACA,MAAI,CAACnB,QAAL,CAAc,EAAd,EACD,CAHoB,CAArB,CAID,CAND,IAMO,CACL,KAAKmB,MAAL,CAAc,IAAd,CACD,CACDf,UAAU,CAACG,SAAX,CAAqB,CAAED,GAAG,CAAEJ,KAAP,CAArB,EACD,C,8DAEkBsB,I,CAAMC,S,CAAW,kBACW,KAAKpC,KADhB,CAC1Be,UAD0B,cAC1BA,UAD0B,CACdsB,KADc,cACdA,KADc,CACPvB,OADO,cACPA,OADO,CACEwB,IADF,cACEA,IADF,CAElC,GAAMC,CAAAA,eAAe,CAAG,iBAAIxB,UAAJ,CAAgB,mBAAhB,CAAxB,CACA,GAAMyB,CAAAA,eAAe,CAAG,iBAAIL,IAAI,CAACpB,UAAT,CAAqB,mBAArB,CAAxB,CAEA,GAAIwB,eAAe,EAAIA,eAAe,GAAKC,eAA3C,CAA4D,CAC1DC,OAAO,CAACC,GAAR,CAAY,aAAZ,CAA2B3B,UAAU,CAACI,KAAX,CAAiBO,MAA5C,EAED,CACD,GAAIW,KAAK,CAAG,CAAC,CAAT,EAAcA,KAAK,GAAKF,IAAI,CAACE,KAA7B,EAAsCA,KAAK,GAAK,KAAKlB,KAAL,CAAWN,KAA/D,CAAsE,CACpE,KAAKF,QAAL,CAAc,CAAEE,KAAK,CAAEwB,KAAT,CAAd,EACD,CAXiC,GAa1BxB,CAAAA,KAb0B,CAahB,KAAKM,KAbW,CAa1BN,KAb0B,CAclC,GAAM8B,CAAAA,SAAS,CAAGP,SAAS,CAACvB,KAA5B,CAEA,GAAIA,KAAK,GAAK8B,SAAd,CAAyB,uCACvB,GAAMC,CAAAA,QAAQ,CAAG/B,KAAK,GAAK,CAA3B,CACA,mBAAKN,MAAL,0EAAaC,OAAb,oEAAsBqC,UAAtB,GACD,CACF,C,qDAasB,IAATC,CAAAA,KAAS,MAATA,KAAS,iBACW,KAAK3B,KADhB,CACbN,KADa,aACbA,KADa,CACND,YADM,aACNA,YADM,IAEbG,CAAAA,UAFa,CAEE,KAAKf,KAFP,CAEbe,UAFa,CAGrB,GAAMgC,CAAAA,YAAY,CAAG,KAAK5B,KAAL,CAAWC,MAAX,CAAkBP,KAAlB,GAA4B,EAAjD,CACA,GAAI,CAAC,KAAKiB,MAAV,CAAkB,MAAO,8BAAC,oBAAD,EAAM,GAAG,CAAEgB,KAAK,CAACzB,GAAjB,kEAAP,CAClB,OAAQyB,KAAK,CAACzB,GAAd,EACE,IAAK,KAAL,CACE,MACE,8BAAC,iBAAD,EACE,MAAM,CAAE0B,YAAY,CAAC1B,GAAb,GAAqByB,KAAK,CAACzB,GADrC,CAEE,IAAI,CAAE,KAFR,CAGE,GAAG,CAAE,KAHP,CAIE,UAAU,CAAEN,UAJd,CAKE,QAAQ,CAAE,KAAKN,QALjB,CAME,OAAO,CAAEG,YANX,CAOE,QAAQ,CAAEkC,KAAK,CAACxB,KAPlB,kEADF,CAWF,IAAK,KAAL,CACE,MACE,8BAAC,iBAAD,EACE,MAAM,CAAEyB,YAAY,CAAC1B,GAAb,GAAqByB,KAAK,CAACzB,GADrC,CAEE,IAAI,CAAE,KAFR,CAGE,GAAG,CAAE,KAHP,CAIE,UAAU,CAAEN,UAJd,CAKE,QAAQ,CAAE,KAAKN,QALjB,CAME,OAAO,CAAEG,YANX,CAOE,QAAQ,CAAEkC,KAAK,CAACxB,KAPlB,kEADF,CAWF,QACE,MAAO,KAAP,CA1BJ,CA4BD,C,kDAEYtB,K,CAAO,iBAClB,MACE,8BAAC,uBAAD,EAAgB,GAAG,CAAE,KAAKO,MAA1B,CAAkC,UAAU,CAAE,KAAKyC,UAAnD,iEACE,6BAAC,eAAD,wBAAQ,MAAM,CAAE,gBAAAnC,KAAK,QAAI,CAAA,MAAI,CAACF,QAAL,CAAc,CAAEE,KAAK,CAALA,KAAF,CAAd,CAAJ,EAArB,EAAuDb,KAAvD,mEADF,CADF,CAKD,C,uCAEQ,oBACCa,CAAAA,KADD,CACW,KAAKM,KADhB,CACCN,KADD,kBAEsB,KAAKb,KAF3B,CAECc,OAFD,cAECA,OAFD,CAEUmC,OAFV,cAEUA,OAFV,IAICX,CAAAA,IAJD,CAIU,KAAKtC,KAJf,CAICsC,IAJD,IAKCY,CAAAA,SALD,CAKeZ,IALf,CAKCY,SALD,CAOP,GAAI,CAACA,SAAL,CAAgB,MAAO,8BAAC,sBAAD,mEAAP,CAEhB,MACE,8BAAC,oBAAD,EAAM,KAAK,CAAE,CAAEC,IAAI,CAAE,CAAR,CAAb,iEACE,6BAAC,kCAAD,CAAgB,QAAhB,EAAyB,KAAK,CAAE,KAAKC,OAArC,iEACE,6BAAC,2CAAD,CAAsB,QAAtB,mEACG,SAAAC,GAAG,QACF,8BAAC,oBAAD,EAAM,KAAK,CAAE,CAAEF,IAAI,CAAE,CAAR,CAAb,kEACE,6BAAC,2BAAD,EACE,mBAAmB,CAAE,CACnBE,GAAG,CAAE,MAAI,CAACD,OADS,CAEnBE,oBAAoB,CAAE,CAACD,GAAD,CAAMJ,OAAO,EAAI,EAAjB,CAFH,CAGnBM,OAAO,CAAE,CAACN,OAAO,EAAI,EAAZ,CAHU,CADvB,CAME,YAAY,CAAE,sBAAAjD,KAAK,QAAI,CAAA,MAAI,CAACuB,YAAL,CAAkBvB,KAAlB,CAAJ,EANrB,CAOE,QAAQ,CAAE,MAAI,CAACwD,QAPjB,CAQE,eAAe,CAAE,MAAI,CAACrC,KARxB,CASE,WAAW,CAAE,MAAI,CAACM,WATpB,CAUE,aAAa,CAAE,MAAI,CAACgC,eAVtB,CAWE,aAAa,CAAE,CAAEC,KAAK,CAAEC,2BAAWC,GAAX,CAAe,QAAf,EAAyBF,KAAlC,CAXjB,kEADF,CADE,EADN,CADF,CADF,CADF,CAyBD,C,0BA9KwBG,gB,+BAArB9D,Y,aACe,CACjBgB,UAAU,CAAE+C,mBAAUC,MADL,CAEjB1B,KAAK,CAAEyB,mBAAUE,MAFA,CAGjBlD,OAAO,CAAEgD,mBAAUC,MAHF,CAIjBE,MAAM,CAAEH,mBAAUI,IAJD,CAKjBC,IAAI,CAAEL,mBAAUC,MALC,C,+BADfhE,Y,qBASuB,eAAoB,IAAjBgB,CAAAA,UAAiB,OAAjBA,UAAiB,IACrCqD,CAAAA,SADqC,CACvBrD,UAAU,CAACI,KADY,CACrCiD,SADqC,CAE7C,GAAMnD,CAAAA,GAAG,CAAG,iBAAIF,UAAJ,CAAgB,kBAAhB,CAAoC,IAApC,CAAZ,CACA,GAAMsD,CAAAA,QAAQ,CAAGD,SAAS,GAAK,aAAd,EAA+BnD,GAAG,CAAG,CAAtD,CACA,GAAMqD,CAAAA,QAAQ,CAAGrD,GAAG,CAAG,CAAvB,CACA,MAAO,CACLK,KAAK,CAAE,cADF,CAELiD,eAAe,CAAE,CAACF,QAFb,CAGLG,cAAc,CAAEF,QAAQ,CAAG,eAAH,CAAqB,UAHxC,CAAP,CAKD,C,EA8JH,GAAMG,CAAAA,WAAW,CAAGC,2BAAWC,MAAX,CAAkB,CACpCC,SAAS,CAAE,CACTzB,IAAI,CAAE,CADG,CADyB,CAAlB,CAApB,CAMArD,MAAM,gCAAQ+E,oBAAR,EAAyBJ,WAAzB,CAAN,CAEA,QAASK,CAAAA,eAAT,CAAyB3D,KAAzB,CAAgC,CAC9B,MAAO,CACLmB,IAAI,CAAEnB,KAAK,CAACmB,IADP,CAEL6B,IAAI,CAAEhD,KAAK,CAACgD,IAFP,CAGL9B,KAAK,CAAElB,KAAK,CAACJ,UAAN,CAAiBgE,QAAjB,CAA0B9D,GAH5B,CAILgD,MAAM,CAAE9C,KAAK,CAACJ,UAAN,CAAiBiE,UAJpB,CAKLC,UAAU,CAAE9D,KAAK,CAAC+D,KAAN,CAAYD,UALnB,CAMLhC,OAAO,CAAE9B,KAAK,CAACJ,UAAN,CAAiBkC,OANrB,CAAP,CAQD,CAED,QAASkC,CAAAA,kBAAT,CAA4BC,QAA5B,CAAsC,CACpC,MAAO,CACLtE,OAAO,CAAE,8BACP,CACEuE,aAAa,CAAbA,kBADF,CAEEC,SAAS,CAATA,qBAFF,CAGEtE,YAAY,CAAZA,wBAHF,CAIEuE,QAAQ,CAARA,oBAJF,CAKEC,UAAU,CAAVA,sBALF,CADO,CAQPJ,QARO,CADJ,CAAP,CAYD,C,aAEc,wBAAQN,eAAR,CAAyBK,kBAAzB,EAA6CpF,YAA7C,C","sourcesContent":["/* eslint-disable */\nimport React, { Component } from 'react';\nimport { StyleSheet, View, Platform, StatusBar, Dimensions } from 'react-native';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Animated from 'react-native-reanimated';\n\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport ScrollableTabView from 'react-native-scrollable-tab-view';\nimport { globalStyles, fullWidth, fullHeight, blue } from 'app/styles/global';\nimport { getParentTags } from 'modules/tag/tag.actions';\nimport {\n  goToTopic,\n  lockDrawer,\n  setScrollTab,\n  goToPage\n} from 'modules/navigation/navigation.actions';\nimport Topics from 'modules/createPost/mobile/topics.component';\nimport CustomSpinner from 'modules/ui/mobile/CustomSpinner.component';\nimport get from 'lodash/get';\nimport { TabView, SceneMap } from 'react-native-tab-view';\nimport { DrawerGestureContext } from 'react-navigation-drawer';\nimport { TabViewContext } from './discoverTabContext';\nimport TabBar from './TabBar';\nimport Discover from './discover.container';\nimport DiscoverHeader from './discoverHeader.component';\nimport CommunityList from 'modules/community/communityList.container';\n\nlet styles;\n\nclass DiscoverTabs extends Component {\n  static propTypes = {\n    navigation: PropTypes.object,\n    tabId: PropTypes.number,\n    actions: PropTypes.object,\n    topics: PropTypes.bool,\n    tags: PropTypes.object\n  };\n\n  static navigationOptions = ({ navigation }) => {\n    const { routeName } = navigation.state;\n    const tab = get(navigation, 'state.params.tab', null);\n    const disabled = routeName === 'discoverTag' && tab > 0;\n    const isLocked = tab > 0;\n    return {\n      title: 'Communitites',\n      gesturesEnabled: !disabled,\n      drawerLockMode: isLocked ? 'locked-closed' : 'unlocked'\n    };\n  };\n\n  tabView = React.createRef();\n  header = React.createRef();\n  position = new Animated.Value(0);\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      index: 0,\n      routes: [\n        { key: 'new', title: 'New' },\n        { key: 'top', title: 'Top' }\n      ],\n      headerHeight: 50\n    };\n    this.renderHeader = this.renderHeader.bind(this);\n    this.renderScene = this.renderScene.bind(this);\n\n    const { params } = this.props.navigation.state;\n    if (params && params.topic) {\n      this.topicId = params.id;\n      this.state.routes = [\n        { key: 'new', title: 'New' },\n        { key: 'top', title: 'Top' }\n      ];\n    }\n    this.loaded = false;\n  }\n\n  componentDidMount() {\n    const { navigation } = this.props;\n    const { index } = this.state;\n    if (this.topicId) {\n      this.needsReload = new Date().getTime();\n      requestAnimationFrame(() => {\n        this.loaded = true;\n        this.setState({});\n      });\n    } else {\n      this.loaded = true;\n    }\n    navigation.setParams({ tab: index });\n  }\n\n  componentDidUpdate(prev, prevState) {\n    const { navigation, tabId, actions, auth } = this.props;\n    const newSortUrlParam = get(navigation, 'state.params.sort');\n    const oldSortUrlParam = get(prev.navigation, 'state.params.sort');\n\n    if (newSortUrlParam && newSortUrlParam !== oldSortUrlParam) {\n      console.log('change sort', navigation.state.params);\n      // tabId = this.state.routes.findIndex(r => r.key === newSortUrlParam);\n    }\n    if (tabId > -1 && tabId !== prev.tabId && tabId !== this.state.index) {\n      this.setState({ index: tabId });\n    }\n\n    const { index } = this.state;\n    const prevIndex = prevState.index;\n\n    if (index !== prevIndex) {\n      const isActive = index !== 0;\n      this.header?.current?.showHeader();\n    }\n  }\n\n  onScroll = event => this.header.current.onScroll(event);\n\n  setPostTop = height => this.setState({ headerHeight: height });\n\n  handleChangeTab = index => {\n    const { actions, navigation } = this.props;\n    this.setState({ index });\n    actions.setScrollTab('discover', { tab: index });\n    navigation.setParams({ tab: index });\n  };\n\n  renderScene({ route }) {\n    const { index, headerHeight } = this.state;\n    const { navigation } = this.props;\n    const currentRoute = this.state.routes[index] || {};\n    if (!this.loaded) return <View key={route.key} />;\n    switch (route.key) {\n      case 'new':\n        return (\n          <Discover\n            active={currentRoute.key === route.key}\n            type={'new'}\n            key={'new'}\n            navigation={navigation}\n            onScroll={this.onScroll}\n            offsetY={headerHeight}\n            tabLabel={route.title}\n          />\n        );\n      case 'top':\n        return (\n          <Discover\n            active={currentRoute.key === route.key}\n            type={'top'}\n            key={'top'}\n            navigation={navigation}\n            onScroll={this.onScroll}\n            offsetY={headerHeight}\n            tabLabel={route.title}\n          />\n        );\n      default:\n        return null;\n    }\n  }\n\n  renderHeader(props) {\n    return (\n      <DiscoverHeader ref={this.header} setPostTop={this.setPostTop}>\n        <TabBar setTab={index => this.setState({ index })} {...props} />\n      </DiscoverHeader>\n    );\n  }\n\n  render() {\n    const { index } = this.state;\n    const { actions, gesture } = this.props;\n\n    const { auth } = this.props;\n    const { community } = auth;\n\n    if (!community) return <CommunityList />;\n\n    return (\n      <View style={{ flex: 1 }}>\n        <TabViewContext.Provider value={this.tabView}>\n          <DrawerGestureContext.Consumer>\n            {ref => (\n              <View style={{ flex: 1 }}>\n                <TabView\n                  gestureHandlerProps={{\n                    ref: this.tabView,\n                    simultaneousHandlers: [ref, gesture || {}],\n                    waitFor: [gesture || {}]\n                  }}\n                  renderTabBar={props => this.renderHeader(props)}\n                  position={this.position}\n                  navigationState={this.state}\n                  renderScene={this.renderScene}\n                  onIndexChange={this.handleChangeTab}\n                  initialLayout={{ width: Dimensions.get('window').width }}\n                />\n              </View>\n            )}\n          </DrawerGestureContext.Consumer>\n        </TabViewContext.Provider>\n      </View>\n    );\n  }\n}\n\nconst localStyles = StyleSheet.create({\n  container: {\n    flex: 1\n  }\n});\n\nstyles = { ...globalStyles, ...localStyles };\n\nfunction mapStateToProps(state) {\n  return {\n    auth: state.auth,\n    tags: state.tags,\n    tabId: state.navigation.discover.tab,\n    topics: state.navigation.showTopics,\n    feedUnread: state.posts.feedUnread,\n    gesture: state.navigation.gesture\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        getParentTags,\n        goToTopic,\n        setScrollTab,\n        goToPage,\n        lockDrawer\n      },\n      dispatch\n    )\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(DiscoverTabs);\n"],"file":"discoverTabs.component.js"}