{"version":3,"sources":["../../../../src/modules/discover/web/discover.container.js"],"names":["Wrapper","styled","View","POST_PAGE_SIZE","Discover","dispatch","params","sort","tag","community","length","tags","postActions","getPosts","props","context","match","state","tabIndex","routes","discoverHelper","tagRoutes","standardRoutes","findIndex","tab","key","load","bind","lastRefresh","actions","setScrollTab","prevProps","alreadyLoading","prevTag","undefined","prevSort","prevCommunity","refresh","userId","auth","user","_id","prevUserId","reload","loadLookup","posts","loaded","topics","_length","nextProps","prevState","getDiscoverState","Component","PropTypes","object","number","mapStateToProps","investments","myPostInv","navigation","discover","mapDispatchToProps","authActions","userActions","navigationActions"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport get from 'lodash/get';\nimport * as authActions from 'modules/auth/auth.actions';\nimport * as postActions from 'modules/post/post.actions';\nimport * as userActions from 'modules/user/user.actions';\nimport * as navigationActions from 'modules/navigation/navigation.actions';\nimport { sizing } from 'app/styles';\nimport styled from 'styled-components/primitives';\nimport DiscoverPosts from './discoverPosts.component';\nimport * as discoverHelper from './discoverHelper';\n\nconst Wrapper = styled.View`\n  display: flex;\n  flex-direction: column;\n  padding: 0 0 ${sizing(4)} 0;\n`;\n\nconst POST_PAGE_SIZE = 15;\n\nexport class Discover extends Component {\n  static propTypes = {\n    match: PropTypes.object,\n    refresh: PropTypes.number,\n    auth: PropTypes.object,\n    posts: PropTypes.object,\n    user: PropTypes.object,\n    actions: PropTypes.object,\n    reload: PropTypes.number\n  };\n\n  static fetchData(dispatch, params) {\n    const { sort, tag, community } = params;\n    const length = 0; // TODO: ssr multi-page?\n    const tags = tag ? [tag] : [];\n\n    switch (sort) {\n      case 'new':\n        return dispatch(\n          postActions.getPosts(length, tags, null, POST_PAGE_SIZE, community)\n        );\n      case 'top':\n        return dispatch(\n          postActions.getPosts(length, tags, 'rank', POST_PAGE_SIZE, community)\n        );\n      default:\n        return null;\n    }\n  }\n\n  constructor(props, context) {\n    super(props, context);\n    const { params } = this.props.match;\n    this.state = {\n      tabIndex: 1,\n      routes: params.tag ? discoverHelper.tagRoutes : discoverHelper.standardRoutes\n    };\n    const { sort } = params;\n    if (sort) {\n      this.state.tabIndex = this.state.routes.findIndex(tab => tab.key === sort);\n    }\n    this.load = this.load.bind(this);\n    this.lastRefresh = 0;\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    return discoverHelper.getDiscoverState(nextProps, prevState);\n  }\n\n  componentDidMount() {\n    this.props.actions.setScrollTab('discover', this.props.match.params);\n  }\n\n  componentDidUpdate(prevProps) {\n    let alreadyLoading;\n    const { tag, sort, community } = this.props.match.params;\n    const prevTag = get(prevProps, 'match.params.tag', undefined);\n    const prevSort = get(prevProps, 'match.params.sort', undefined);\n    const prevCommunity = get(prevProps, 'match.params.community', undefined);\n    if (tag !== prevTag || sort !== prevSort || community !== prevCommunity) {\n      this.props.actions.setScrollTab('discover', this.props.match.params);\n    }\n\n    if (this.props.refresh && this.props.refresh > this.lastRefresh) {\n      this.lastRefresh = this.props.refresh;\n      this.load(sort, this.props);\n      alreadyLoading = true;\n      return;\n    }\n\n    const userId = this.props.auth.user ? this.props.auth.user._id : null;\n    const prevUserId = prevProps.auth.user ? prevProps.auth.user._id : null;\n\n    // TODO should we do this w refresh instead? when we log in / out?\n    if (userId !== prevUserId && !alreadyLoading) {\n      this.load(sort, this.props);\n      alreadyLoading = true;\n      return;\n    }\n\n    if (tag !== prevProps.match.params.tag) {\n      this.load(sort, this.props);\n      alreadyLoading = true;\n    }\n\n    if (this.props.reload !== prevProps.reload) {\n      this.load(sort, this.props);\n      alreadyLoading = true;\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.actions.setScrollTab('discover', {});\n  }\n\n  getLoadedState() {\n    const sort = this.state.routes[this.state.tabIndex].key;\n    const { tag } = this.props.match.params;\n    const loadLookup = tag\n      ? this.props.posts.loaded.topics[tag]\n      : this.props.posts.loaded;\n    return loadLookup && loadLookup[sort];\n  }\n\n  load(sort, props, _length) {\n    const { actions, auth } = this.props;\n    if (!this.state.routes[this.state.tabIndex]) return;\n    const { community } = auth;\n    sort = sort || this.state.routes[this.state.tabIndex].key;\n    props = props || this.props;\n    const tags = props.match.params.tag ? [props.match.params.tag] : [];\n    const length = _length || 0;\n    switch (sort) {\n      case 'new':\n        actions.getPosts(length, tags, null, POST_PAGE_SIZE, community);\n        break;\n      case 'top':\n        actions.getPosts(length, tags, 'rank', POST_PAGE_SIZE, community);\n        break;\n      default:\n        break;\n    }\n  }\n\n  render() {\n    if (!this.state.routes[this.state.tabIndex]) return null;\n    const sort = this.state.routes[this.state.tabIndex].key;\n    const { tag } = this.props.match.params;\n    return (\n      <Wrapper>\n        <div>\n          <DiscoverPosts\n            key={'posts' + sort + tag}\n            sort={sort}\n            load={this.load}\n            tag={tag}\n            pageSize={POST_PAGE_SIZE}\n            {...this.props}\n          />\n        </div>\n      </Wrapper>\n    );\n  }\n}\n\nfunction mapStateToProps(state) {\n  return {\n    auth: state.auth,\n    user: state.user,\n    posts: state.posts,\n    tags: state.tags,\n    investments: state.investments,\n    myPostInv: state.investments.myPostInv,\n    refresh: state.navigation.discover.refresh,\n    reload: state.navigation.reload\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        ...authActions,\n        ...postActions,\n        ...userActions,\n        ...navigationActions\n      },\n      dispatch\n    )\n  };\n}\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Discover));\n"],"file":"discover.container.js"}