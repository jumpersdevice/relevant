{"version":3,"sources":["../../../../src/modules/navigation/mobile/headerRight.component.js"],"names":["styles","ActionSheet","ActionSheetIOS","Platform","OS","RNBottomSheet","showActionSheetWithOptions","showBottomSheetWithOptions","HeaderRight","newName","options","cancelButtonIndex","destructiveButtonIndex","buttonIndex","changeName","initImage","props","actions","push","viewBlocked","goToUrl","logoutRedirect","user","auth","promptTitle","setState","promptVisible","Alert","prompt","name","text","style","onPress","updateUser","chooseImage","err","data","token","then","results","success","newUser","image","url","alert","callback","ImagePicker","showImagePicker","pickerOptions","res","didCancel","error","customButton","uri","removeDeviceToken","logoutAction","resetAction","StackActions","reset","index","key","NavigationActions","navigate","routeName","navigation","dispatch","state","gear","showActionSheet","paddingBottom","fontSize","darkGrey","rightButton","paddingRight","renderElement","Component","PropTypes","object","localStyles","StyleSheet","create","flex","marginRight","mainPadding","justifyContent","flexDirection","alignItems","globalStyles","mapStateToProps","mapDispatchToProps","navigationActions","userActions","authActions"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport {\n  StyleSheet,\n  TouchableHighlight,\n  Text,\n  View,\n  Platform,\n  ActionSheetIOS,\n  Alert\n} from 'react-native';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport Icon from 'react-native-vector-icons/Ionicons';\nimport Prompt from 'rn-prompt';\nimport { StackActions, NavigationActions } from 'react-navigation';\nimport { globalStyles, darkGrey, mainPadding } from 'app/styles/global';\nimport Stats from 'modules/stats/mobile/stats.component';\nimport RNBottomSheet from 'react-native-bottomsheet';\n\nimport { pickerOptions } from 'app/utils/pickerOptions';\nimport { toS3Advanced } from 'app/utils/s3';\nimport ImagePicker from 'react-native-image-picker';\n\nimport * as userActions from 'modules/user/user.actions';\nimport * as navigationActions from 'modules/navigation/navigation.actions';\nimport * as authActions from 'modules/auth/auth.actions';\n\nlet styles;\n\nlet ActionSheet = ActionSheetIOS;\n\nif (Platform.OS === 'android') {\n  ActionSheet = RNBottomSheet;\n  ActionSheet.showActionSheetWithOptions = RNBottomSheet.showBottomSheetWithOptions;\n}\n\nclass HeaderRight extends Component {\n  static propTypes = {\n    auth: PropTypes.object,\n    actions: PropTypes.object,\n    navigation: PropTypes.object\n  };\n\n  state = {\n    newName: ''\n  };\n\n  changeName() {\n    const { user } = this.props.auth;\n    // ANDROID\n    if (Platform.OS === 'android') {\n      this.promptTitle = 'Enter new name';\n      this.setState({ promptVisible: true });\n      return;\n    }\n\n    // IOS\n    Alert.prompt('Enter new name', user.name, [\n      { text: 'Cancel', style: 'cancel' },\n      {\n        text: 'OK',\n        onPress: newName => {\n          user.name = newName;\n          this.props.actions.updateUser(user);\n          this.setState({ newName });\n        }\n      }\n    ]);\n  }\n\n  initImage() {\n    this.chooseImage((err, data) => {\n      if (data) {\n        toS3Advanced(data, this.props.auth.token).then(results => {\n          if (results.success) {\n            const newUser = this.props.auth.user;\n            newUser.image = results.url;\n            this.props.actions.updateUser(newUser);\n          } else {\n            Alert.alert('Error uploading image');\n          }\n        });\n      }\n    });\n  }\n\n  chooseImage(callback) {\n    ImagePicker.showImagePicker(pickerOptions, res => {\n      if (res.didCancel) return callback('Cancelled');\n      if (res.error || res.customButton) return callback('There was an error');\n      return callback(null, res.uri);\n    });\n  }\n\n  showActionSheet = () => {\n    ActionSheet.showActionSheetWithOptions(\n      {\n        options: [\n          'Change display name',\n          'Add new photo',\n          'Notifications',\n          'Invite Friends',\n          'Blocked Users',\n          'FAQ',\n          'Logout',\n          'Cancel'\n        ],\n        cancelButtonIndex: 7,\n        destructiveButtonIndex: 6\n      },\n      buttonIndex => {\n        switch (buttonIndex) {\n          case 0:\n            this.changeName();\n            break;\n          case 1:\n            this.initImage();\n            break;\n          case 2:\n            this.props.actions.push('notifications');\n            break;\n          case 3:\n            this.props.actions.push('invites');\n            break;\n          case 4:\n            this.props.actions.viewBlocked();\n            break;\n          case 5:\n            this.props.actions.goToUrl('https://relevant.community/info/faq');\n            break;\n          case 6:\n            this.logoutRedirect();\n            break;\n          default:\n        }\n      }\n    );\n  };\n\n  logoutRedirect() {\n    const { actions, auth } = this.props;\n    actions.removeDeviceToken(this.props.auth);\n    actions.logoutAction(auth.user);\n    const resetAction = StackActions.reset({\n      index: 0,\n      key: null,\n      actions: [\n        NavigationActions.navigate({\n          routeName: 'main'\n        })\n      ]\n    });\n    this.props.navigation.dispatch(resetAction);\n    this.props.navigation.navigate('auth');\n  }\n\n  renderElement() {\n    const { navigation, auth } = this.props;\n    const { state } = navigation;\n\n    if (state.routeName === 'myProfileView') {\n      return (\n        <TouchableHighlight\n          style={styles.gear}\n          underlayColor={'transparent'}\n          onPress={() => this.showActionSheet()}\n        >\n          {Platform.OS === 'ios' ? (\n            <Text style={{ paddingBottom: 5, fontSize: 17 }}>⚙️</Text>\n          ) : (\n            <Icon name=\"ios-settings\" size={24} color={darkGrey} />\n          )}\n        </TouchableHighlight>\n      );\n    }\n\n    if (auth.user) {\n      return (\n        <Stats\n          type={'nav'}\n          discover={state.routeName === 'discoverView'}\n          parent={this}\n          entity={auth.user}\n        />\n      );\n    }\n    return null;\n  }\n\n  render() {\n    const { auth, actions } = this.props;\n    return (\n      <View style={styles.rightButton}>\n        <View style={{ paddingRight: 10 }}>{this.renderElement()}</View>\n        <Prompt\n          title={this.promptTitle || ''}\n          visible={this.state.promptVisible}\n          onCancel={() => this.setState({ promptVisible: false })}\n          onSubmit={newName => {\n            auth.user.name = newName;\n            actions.updateUser(auth.user);\n            this.setState({\n              promptVisible: false,\n              newName\n            });\n          }}\n        />\n      </View>\n    );\n  }\n}\n\nconst localStyles = StyleSheet.create({\n  rightButton: {\n    flex: 1,\n    marginRight: mainPadding - 10,\n    justifyContent: 'center'\n  },\n  gear: {\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    alignItems: 'center'\n  }\n});\n\nstyles = { ...localStyles, ...globalStyles };\n\nfunction mapStateToProps(state) {\n  return {\n    auth: state.auth\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        ...navigationActions,\n        ...userActions,\n        ...authActions\n      },\n      dispatch\n    )\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(HeaderRight);\n"],"file":"headerRight.component.js"}