{"version":3,"sources":["../../../src/auth/web3/index.js"],"names":["express","require","passport","auth","router","Router","post","currentUser","req","res","next","authenticate","err","user","info","error","status","json","message","token","signToken","_id","role","universalCookies","set"],"mappings":";;;;;;;;;;;AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,IAAMC,QAAQ,GAAGD,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAME,IAAI,GAAGF,OAAO,mBAApB;;AACAA,OAAO,cAAP;;AAEA,IAAMG,MAAM,GAAGJ,OAAO,CAACK,MAAR,EAAf;AAEAD,MAAM,CAACE,IAAP,CAAY,GAAZ,EAAiBH,IAAI,CAACI,WAAL,EAAjB,EAAqC,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACvDR,EAAAA,QAAQ,CAACS,YAAT,CAAsB,MAAtB;AAAA,+CAA8B,WAAOC,GAAP,EAAYC,IAAZ,EAAkBC,IAAlB,EAA2B;AACvD,UAAMC,KAAK,GAAGH,GAAG,IAAIE,IAArB;AACA,UAAIC,KAAJ,EAAW,OAAOL,IAAI,CAACK,KAAD,CAAX;AACX,UAAI,CAACF,IAAL,EACE,OAAOJ,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,OAAO,EAAE;AAAX,OAArB,CAAP;AAEF,UAAMC,KAAK,GAAGhB,IAAI,CAACiB,SAAL,CAAeP,IAAI,CAACQ,GAApB,EAAyBR,IAAI,CAACS,IAA9B,CAAd;AACAd,MAAAA,GAAG,CAACe,gBAAJ,CAAqBC,GAArB,CAAyB,OAAzB,EAAkCL,KAAlC;AAEA,aAAOV,GAAG,CAACQ,IAAJ,CAAS;AAAEE,QAAAA;AAAF,OAAT,CAAP;AACD,KAVD;;AAAA;AAAA;AAAA;AAAA,OAUGX,GAVH,EAUQC,GAVR,EAUaC,IAVb;AAWD,CAZD;eAceN,M","sourcesContent":["const express = require('express');\nconst passport = require('passport');\nconst auth = require('../auth.service');\nrequire('./passport');\n\nconst router = express.Router();\n\nrouter.post('/', auth.currentUser(), (req, res, next) => {\n  passport.authenticate('web3', async (err, user, info) => {\n    const error = err || info;\n    if (error) return next(error);\n    if (!user)\n      return res.status(404).json({ message: 'Something went wrong, please try again.' });\n\n    const token = auth.signToken(user._id, user.role);\n    req.universalCookies.set('token', token);\n\n    return res.json({ token });\n  })(req, res, next);\n});\n\nexport default router;\n"],"file":"index.js"}