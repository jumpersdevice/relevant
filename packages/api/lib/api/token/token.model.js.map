{"version":3,"sources":["../../../src/api/token/token.model.js"],"names":["mongoose","require","Schema","AuthTokenSchema","user","type","Types","ObjectId","ref","index","revokeBefore","Number","timestamps","statics","revoke","_id","now","Date","Math","floor","getTime","revokeToken","save","checkRevoked","iat","findOne","$gte","module","exports","model"],"mappings":";;;;;;AAAA,IAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AAEA,IAAM;AAAEC,EAAAA;AAAF,IAAaF,QAAnB;AAEA,IAAMG,eAAe,GAAG,IAAID,MAAJ,CACtB;AACEE,EAAAA,IAAI,EAAE;AAAEC,IAAAA,IAAI,EAAEH,MAAM,CAACI,KAAP,CAAaC,QAArB;AAA+BC,IAAAA,GAAG,EAAE,MAApC;AAA4CC,IAAAA,KAAK,EAAE;AAAnD,GADR;AAEEC,EAAAA,YAAY,EAAEC;AAFhB,CADsB,EAKtB;AACEC,EAAAA,UAAU,EAAE;AADd,CALsB,CAAxB;;AAUAT,eAAe,CAACU,OAAhB,CAAwBC,MAAxB;AAAA,gDAAiC,WAAsBC,GAAtB,EAA2B;AAC1D,QAAMC,GAAG,GAAG,IAAIC,IAAJ,EAAZ;AACA,QAAMP,YAAY,GAAGQ,IAAI,CAACC,KAAL,CAAWH,GAAG,CAACI,OAAJ,KAAgB,IAA3B,CAArB;AACA,QAAMC,WAAW,GAAG,IAAI,IAAJ,CAAS;AAAEjB,MAAAA,IAAI,EAAEW,GAAR;AAAaL,MAAAA;AAAb,KAAT,CAApB;AACA,WAAOW,WAAW,CAACC,IAAZ,EAAP;AACD,GALD;;AAAA,WAAgDR,MAAhD;AAAA;AAAA;;AAAA,SAAgDA,MAAhD;AAAA;;AAOAX,eAAe,CAACU,OAAhB,CAAwBU,YAAxB;AAAA,sDAAuC,iBAA0C;AAAA,QAAd;AAAER,MAAAA,GAAF;AAAOS,MAAAA;AAAP,KAAc;AAC/E,WAAO,KAAKC,OAAL,CAAa;AAAErB,MAAAA,IAAI,EAAEW,GAAR;AAAaL,MAAAA,YAAY,EAAE;AAAEgB,QAAAA,IAAI,EAAEF;AAAR;AAA3B,KAAb,CAAP;AACD,GAFD;;AAAA,WAAsDD,YAAtD;AAAA;AAAA;;AAAA,SAAsDA,YAAtD;AAAA;;AAIAI,MAAM,CAACC,OAAP,GAAiB5B,QAAQ,CAAC6B,KAAT,CAAe,WAAf,EAA4B1B,eAA5B,CAAjB","sourcesContent":["const mongoose = require('mongoose');\n\nconst { Schema } = mongoose;\n\nconst AuthTokenSchema = new Schema(\n  {\n    user: { type: Schema.Types.ObjectId, ref: 'User', index: true },\n    revokeBefore: Number\n  },\n  {\n    timestamps: true\n  }\n);\n\nAuthTokenSchema.statics.revoke = async function revoke(_id) {\n  const now = new Date();\n  const revokeBefore = Math.floor(now.getTime() / 1000);\n  const revokeToken = new this({ user: _id, revokeBefore });\n  return revokeToken.save();\n};\n\nAuthTokenSchema.statics.checkRevoked = async function checkRevoked({ _id, iat }) {\n  return this.findOne({ user: _id, revokeBefore: { $gte: iat } });\n};\n\nmodule.exports = mongoose.model('AuthToken', AuthTokenSchema);\n"],"file":"token.model.js"}