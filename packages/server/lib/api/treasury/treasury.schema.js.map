{"version":3,"sources":["../../../src/api/treasury/treasury.schema.js"],"names":["customizationOptions","TreasuryTC","Treasury","treasuryQuery","distributedTokens","type","resolve","ag","User","aggregate","$match","$group","_id","balance","$sum","legacyTokens","airdropTokens","legacyAirdrop","cashedOut","tokenBalance","earnigns","Earnings","status","earned","rewards","Community","rewardFund","curationRewards","airdrop","treasuryOne","getResolver","treasuryById","treasuryByIds","treasuryMany","treasuryCount","treasuryConnection","treasuryPagination"],"mappings":"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","sourcesContent":["import { composeWithMongoose } from 'graphql-compose-mongoose';\nimport User from 'server/api/user/user.model';\nimport Earnings from 'server/api/earnings/earnings.model';\nimport Community from 'server/api/community/community.model';\nimport Treasury from './treasury.model';\n\nconst customizationOptions = {}; // left it empty for simplicity, described below\nconst TreasuryTC = composeWithMongoose(Treasury, customizationOptions);\n\n// STEP 3: Add needed CRUD User operations to the GraphQL Schema\n// via graphql-compose it will be much much easier, with less typing\nexport const treasuryQuery = {\n  distributedTokens: {\n    type: `type Aggregate {\n      _id: String,\n      balance: Float,\n      legacyTokens: Float,\n      legacyAirdrop: Float,\n      airdropTokens: Float,\n      cashedOut: Float,\n      tokenBalance: Float,\n      curationRewards: Float,\n      airdrop: Float,\n      earned: Float,\n      rewardFund: Float,\n    }`,\n    resolve: async () => {\n      const ag = await User.aggregate([\n        { $match: {} },\n        {\n          $group: {\n            _id: '',\n            balance: { $sum: '$balance' },\n            legacyTokens: { $sum: '$legacyTokens' },\n            airdropTokens: { $sum: '$airdropTokens' },\n            legacyAirdrop: { $sum: '$legacyAirdrop' },\n            cashedOut: { $sum: '$cashedOut' },\n            tokenBalance: { $sum: '$tokenBalance' }\n          }\n        }\n      ]);\n      const earnigns = await Earnings.aggregate([\n        { $match: { status: 'paidout' } },\n        {\n          $group: {\n            _id: '',\n            earned: { $sum: '$earned' }\n          }\n        }\n      ]);\n      const rewards = await Community.aggregate([\n        { $match: {} },\n        {\n          $group: {\n            _id: '',\n            rewardFund: { $sum: '$rewardFund' }\n          }\n        }\n      ]);\n      const { earned } = earnigns[0];\n      const rewardFund = rewards[0].rewardFund / 1e18;\n      const { balance, legacyTokens, airdropTokens, legacyAirdrop, cashedOut } = ag[0];\n      const curationRewards =\n        balance - legacyTokens - airdropTokens - legacyAirdrop + cashedOut;\n      const airdrop = legacyTokens + airdropTokens + legacyAirdrop;\n      return { ...ag[0], curationRewards, airdrop, earned, rewardFund };\n    }\n  },\n  treasuryOne: TreasuryTC.getResolver('findOne'),\n  treasuryById: TreasuryTC.getResolver('findById'),\n  treasuryByIds: TreasuryTC.getResolver('findByIds'),\n  treasuryMany: TreasuryTC.getResolver('findMany'),\n  treasuryCount: TreasuryTC.getResolver('count'),\n  treasuryConnection: TreasuryTC.getResolver('connection'),\n  treasuryPagination: TreasuryTC.getResolver('pagination')\n};\n\n// schemaComposer.Mutation.addFields({\n//   //   userCreateOne: UserTC.getResolver('createOne'),\n//   //   userCreateMany: UserTC.getResolver('createMany'),\n//   //   userUpdateById: UserTC.getResolver('updateById'),\n//   //   userUpdateOne: UserTC.getResolver('updateOne'),\n//   //   userUpdateMany: UserTC.getResolver('updateMany'),\n//   //   userRemoveById: UserTC.getResolver('removeById'),\n//   //   userRemoveOne: UserTC.getResolver('removeOne'),\n//   //   userRemoveMany: UserTC.getResolver('removeMany'),\n// });\n"],"file":"treasury.schema.js"}