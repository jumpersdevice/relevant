{"version":3,"sources":["../../../src/auth/facebook/passport.js"],"names":["passport","require","FacebookStrategy","Strategy","exports","setup","User","config","use","clientID","facebook","clientSecret","callbackURL","accessToken","refreshToken","profile","done","findOne","id","err","user","name","displayName","role","username","provider","_json","save","_err"],"mappings":";;AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,MAAMC,gBAAgB,GAAGD,OAAO,CAAC,mBAAD,CAAP,CAA6BE,QAAtD;;AAEAC,OAAO,CAACC,KAAR,GAAgB,CAACC,IAAD,EAAOC,MAAP,KAAkB;AAChCP,EAAAA,QAAQ,CAACQ,GAAT,CACE,IAAIN,gBAAJ,CACE;AACEO,IAAAA,QAAQ,EAAEF,MAAM,CAACG,QAAP,CAAgBD,QAD5B;AAEEE,IAAAA,YAAY,EAAEJ,MAAM,CAACG,QAAP,CAAgBC,YAFhC;AAGEC,IAAAA,WAAW,EAAEL,MAAM,CAACG,QAAP,CAAgBE;AAH/B,GADF,EAME,CAACC,WAAD,EAAcC,YAAd,EAA4BC,OAA5B,EAAqCC,IAArC,KAA8C;AAC5CV,IAAAA,IAAI,CAACW,OAAL,CACE;AACE,qBAAeF,OAAO,CAACG;AADzB,KADF,EAIE,CAACC,GAAD,EAAMC,IAAN,KAAe;AACb,UAAID,GAAJ,EAAS,OAAOH,IAAI,CAACG,GAAD,CAAX;;AACT,UAAI,CAACC,IAAL,EAAW;AACTA,QAAAA,IAAI,GAAG,IAAId,IAAJ,CAAS;AACde,UAAAA,IAAI,EAAEN,OAAO,CAACO,WADA;AAEd;AACAC,UAAAA,IAAI,EAAE,MAHQ;AAIdC,UAAAA,QAAQ,EAAET,OAAO,CAACS,QAJJ;AAKdC,UAAAA,QAAQ,EAAE,UALI;AAMdf,UAAAA,QAAQ,EAAEK,OAAO,CAACW;AANJ,SAAT,CAAP;AAQA,eAAON,IAAI,CAACO,IAAL,CAAUC,IAAI,IAAI;AACvB,cAAIA,IAAJ,EAAU,OAAOZ,IAAI,CAACY,IAAD,CAAX;AACV,iBAAOZ,IAAI,CAACY,IAAD,EAAOR,IAAP,CAAX;AACD,SAHM,CAAP;AAID;;AACD,aAAOJ,IAAI,CAACG,GAAD,EAAMC,IAAN,CAAX;AACD,KArBH;AAuBD,GA9BH,CADF;AAkCD,CAnCD","sourcesContent":["const passport = require('passport');\nconst FacebookStrategy = require('passport-facebook').Strategy;\n\nexports.setup = (User, config) => {\n  passport.use(\n    new FacebookStrategy(\n      {\n        clientID: config.facebook.clientID,\n        clientSecret: config.facebook.clientSecret,\n        callbackURL: config.facebook.callbackURL\n      },\n      (accessToken, refreshToken, profile, done) => {\n        User.findOne(\n          {\n            'facebook.id': profile.id\n          },\n          (err, user) => {\n            if (err) return done(err);\n            if (!user) {\n              user = new User({\n                name: profile.displayName,\n                // email: profile.emails[0].value,\n                role: 'user',\n                username: profile.username,\n                provider: 'facebook',\n                facebook: profile._json\n              });\n              return user.save(_err => {\n                if (_err) return done(_err);\n                return done(_err, user);\n              });\n            }\n            return done(err, user);\n          }\n        );\n      }\n    )\n  );\n};\n"],"file":"passport.js"}