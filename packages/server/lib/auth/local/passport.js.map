{"version":3,"sources":["../../../src/auth/local/passport.js"],"names":["passport","require","LocalStrategy","Strategy","exports","setup","User","use","usernameField","passwordField","name","password","done","email","test","formatted","quareyParam","$regex","$options","query","handle","findOne","select","exec","err","user","message","authenticate"],"mappings":";;AAAA,IAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAMC,aAAa,GAAGD,OAAO,CAAC,gBAAD,CAAP,CAA0BE,QAAhD;;AAEAC,OAAO,CAACC,KAAR,GAAgB,SAASA,KAAT,CAAeC,IAAf,EAAqB;AACnCN,EAAAA,QAAQ,CAACO,GAAT,CACE,IAAIL,aAAJ,CACE;AACEM,IAAAA,aAAa,EAAE,MADjB;AAEEC,IAAAA,aAAa,EAAE,UAFjB,CAE4B;;AAF5B,GADF,EAKE,CAACC,IAAD,EAAOC,QAAP,EAAiBC,IAAjB,KAA0B;AACxB,QAAMC,KAAK,GAAG,cAAcC,IAAd,CAAmBJ,IAAnB,CAAd;AACA,QAAMK,SAAS,GAAG,MAAML,IAAN,GAAa,GAA/B;AACA,QAAMM,WAAW,GAAG;AAAEC,MAAAA,MAAM,EAAEF,SAAV;AAAqBG,MAAAA,QAAQ,EAAE;AAA/B,KAApB;AACA,QAAMC,KAAK,GAAGN,KAAK,GAAG;AAAEA,MAAAA,KAAK,EAAEG;AAAT,KAAH,GAA4B;AAAEI,MAAAA,MAAM,EAAEJ;AAAV,KAA/C;AACAV,IAAAA,IAAI,CAACe,OAAL,CAAaF,KAAb,EACGG,MADH,CACU,uBADV,EAEGC,IAFH,CAEQ,CAACC,GAAD,EAAMC,IAAN,KAAe;AACnB,UAAID,GAAJ,EAAS,OAAOZ,IAAI,CAACY,GAAD,CAAX;;AACT,UAAI,CAACC,IAAL,EAAW;AACT,eAAOb,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;AACvBc,UAAAA,OAAO,EAAE;AADc,SAAd,CAAX;AAGD;;AACD,UAAI,CAACD,IAAI,CAACE,YAAL,CAAkBhB,QAAlB,CAAL,EAAkC;AAChC,eAAOC,IAAI,CAAC,IAAD,EAAO,KAAP,EAAc;AAAEc,UAAAA,OAAO,EAAE;AAAX,SAAd,CAAX;AACD;;AACD,aAAOd,IAAI,CAAC,IAAD,EAAOa,IAAP,CAAX;AACD,KAbH;AAcD,GAxBH,CADF;AA4BD,CA7BD","sourcesContent":["const passport = require('passport');\nconst LocalStrategy = require('passport-local').Strategy;\n\nexports.setup = function setup(User) {\n  passport.use(\n    new LocalStrategy(\n      {\n        usernameField: 'name',\n        passwordField: 'password' // this is the virtual field on the model\n      },\n      (name, password, done) => {\n        const email = /^.+@.+\\..+$/.test(name);\n        const formatted = '^' + name + '$';\n        const quareyParam = { $regex: formatted, $options: 'i' };\n        const query = email ? { email: quareyParam } : { handle: quareyParam };\n        User.findOne(query)\n          .select('+hashedPassword +salt')\n          .exec((err, user) => {\n            if (err) return done(err);\n            if (!user) {\n              return done(null, false, {\n                message: 'This username or email is not registered.'\n              });\n            }\n            if (!user.authenticate(password)) {\n              return done(null, false, { message: 'This password is not correct.' });\n            }\n            return done(null, user);\n          });\n      }\n    )\n  );\n};\n"],"file":"passport.js"}