{"version":3,"sources":["../../../src/auth/local/index.js"],"names":["express","require","passport","auth","twitter","router","Router","post","req","res","next","authenticate","err","user","info","error","status","json","message","body","profile","getProfile","addTwitterProfile","twitterAuth","toObject","twitterAuthToken","hashedPassword","salt","token","signToken","_id","role","universalCookies","set","module","exports"],"mappings":";;;;;;AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,IAAMC,QAAQ,GAAGD,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAME,IAAI,GAAGF,OAAO,mBAApB;;AACA,IAAMG,OAAO,GAAGH,OAAO,uBAAvB;;AAEA,IAAMI,MAAM,GAAGL,OAAO,CAACM,MAAR,EAAf;AAEAD,MAAM,CAACE,IAAP,CAAY,GAAZ,EAAiB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AACnCR,EAAAA,QAAQ,CAACS,YAAT,CAAsB,OAAtB;AAAA,+CAA+B,WAAOC,GAAP,EAAYC,IAAZ,EAAkBC,IAAlB,EAA2B;AACxD,UAAI;AACF,YAAMC,KAAK,GAAGH,GAAG,IAAIE,IAArB;AACA,YAAIC,KAAJ,EAAW,OAAON,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB,CAAP;;AACX,YAAI,CAACF,IAAL,EAAW;AACT,iBAAOJ,GAAG,CACPO,MADI,CACG,GADH,EAEJC,IAFI,CAEC;AAAEC,YAAAA,OAAO,EAAE;AAAX,WAFD,CAAP;AAGD;;AAED,YAAIV,GAAG,CAACW,IAAJ,CAASf,OAAb,EAAsB;AACpB,cAAMgB,OAAO,SAAShB,OAAO,CAACiB,UAAR,CAAmBb,GAAG,CAACW,IAAJ,CAASf,OAA5B,CAAtB;AACA,gBAAMA,OAAO,CAACkB,iBAAR,CAA0B;AAC9BT,YAAAA,IAD8B;AAE9BO,YAAAA,OAF8B;AAG9BG,YAAAA,WAAW,EAAEf,GAAG,CAACW,IAAJ,CAASf;AAHQ,WAA1B,CAAN;AAKD;;AAEDS,QAAAA,IAAI,GAAGA,IAAI,CAACW,QAAL,EAAP;AACA,eAAOX,IAAI,CAACY,gBAAZ;AACA,eAAOZ,IAAI,CAACa,cAAZ;AACA,eAAOb,IAAI,CAACc,IAAZ;AACA,eAAOd,IAAI,CAACT,OAAZ;AAEA,YAAMwB,KAAK,GAAGzB,IAAI,CAAC0B,SAAL,CAAehB,IAAI,CAACiB,GAApB,EAAyBjB,IAAI,CAACkB,IAA9B,CAAd;AACAvB,QAAAA,GAAG,CAACwB,gBAAJ,CAAqBC,GAArB,CAAyB,OAAzB,EAAkCL,KAAlC;AAEA,eAAOnB,GAAG,CAACQ,IAAJ,CAAS;AAAEW,UAAAA;AAAF,SAAT,CAAP;AACD,OA5BD,CA4BE,OAAOb,KAAP,EAAc;AACd,eAAON,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,UAAAA,OAAO,EAAE;AAAX,SAArB,CAAP;AACD;AACF,KAhCD;;AAAA;AAAA;AAAA;AAAA,OAgCGV,GAhCH,EAgCQC,GAhCR,EAgCaC,IAhCb;AAiCD,CAlCD;AAoCAwB,MAAM,CAACC,OAAP,GAAiB9B,MAAjB","sourcesContent":["const express = require('express');\nconst passport = require('passport');\nconst auth = require('../auth.service');\nconst twitter = require('../twitter/passport');\n\nconst router = express.Router();\n\nrouter.post('/', (req, res, next) => {\n  passport.authenticate('local', async (err, user, info) => {\n    try {\n      const error = err || info;\n      if (error) return res.status(401).json(error);\n      if (!user) {\n        return res\n          .status(404)\n          .json({ message: 'Something went wrong, please try again.' });\n      }\n\n      if (req.body.twitter) {\n        const profile = await twitter.getProfile(req.body.twitter);\n        await twitter.addTwitterProfile({\n          user,\n          profile,\n          twitterAuth: req.body.twitter\n        });\n      }\n\n      user = user.toObject();\n      delete user.twitterAuthToken;\n      delete user.hashedPassword;\n      delete user.salt;\n      delete user.twitter;\n\n      const token = auth.signToken(user._id, user.role);\n      req.universalCookies.set('token', token);\n\n      return res.json({ token });\n    } catch (error) {\n      return res.status(404).json({ message: 'Something went wrong, please try again.' });\n    }\n  })(req, res, next);\n});\n\nmodule.exports = router;\n"],"file":"index.js"}